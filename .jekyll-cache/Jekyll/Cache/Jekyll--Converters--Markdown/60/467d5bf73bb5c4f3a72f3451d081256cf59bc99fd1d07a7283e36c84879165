I"Ò<h2 id="ä¸€redis-çš„æ•°æ®æ“ä½œ">ä¸€ã€Redis çš„æ•°æ®æ“ä½œ</h2>

<h3 id="11-redis-çš„-key">1.1 Redis çš„ key</h3>

<p><strong>redis çš„ Key æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä½†æ˜¯ Key ä¸­ä¸èƒ½åŒ…å«è¾¹ç•Œå­—ç¬¦</strong>ï¼Œç”±äº key ä¸æ˜¯ binary safe çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æƒ³â€œmy keyâ€å’Œâ€œmykey\nâ€è¿™æ ·çš„åŒ…å«ç©ºæ ¼å’Œæ¢è¡Œçš„ key æ˜¯ä¸å…è®¸çš„ã€‚</p>

<h3 id="12-redis-çš„-value">1.2 Redis çš„ value</h3>

<p>redis æä¾›äº”ç§æ•°æ®ç±»å‹ï¼š<code class="highlighter-rouge">Stringç±»å‹</code>ã€<code class="highlighter-rouge">hashç±»å‹</code>ã€<code class="highlighter-rouge">listç±»å‹</code>ã€<code class="highlighter-rouge">setç±»å‹</code> åŠ <code class="highlighter-rouge">sorted setç±»å‹</code>ã€‚</p>

<h4 id="121-string-ç±»å‹">1.2.1 <code class="highlighter-rouge">String ç±»å‹</code></h4>

<p>Redis ä¸­æ²¡æœ‰ä½¿ç”¨ C è¯­è¨€çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œè€Œæ˜¯è‡ªå®šä¹‰ä¸€ä¸ªæ•°æ®ç»“æ„å« <strong>SDS(simple dynamic stringï¼Œç®€å•åŠ¨æ€å­—ç¬¦)</strong>ã€‚Redis çš„å­—ç¬¦ä¸²æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œå­˜å…¥ä»€ä¹ˆæ•°æ®å–å‡ºçš„è¿˜æ˜¯ä»€ä¹ˆæ•°æ®ã€‚String ç±»å‹çš„å¸¸ç”¨å‘½ä»¤æœ‰ï¼š</p>

<ul>
  <li>
    <p>èµ‹å€¼å‘½ä»¤</p>

    <ul>
      <li>
        <p>redis ä¸­èµ‹å€¼æ“ä½œä½¿ç”¨ set å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">set key value</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379&gt; <span class="k">select </span>1
OK
127.0.0.1:6379[1]&gt; keys <span class="k">*</span>
<span class="o">(</span>empty list or <span class="nb">set</span><span class="o">)</span>
127.0.0.1:6379[1]&gt; <span class="nb">set </span>name tom 
OK
127.0.0.1:6379[1]&gt; keys <span class="k">*</span>
1<span class="o">)</span> <span class="s2">"name"</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>å¦‚æœå¸Œæœ›ä¸€æ¬¡æ€§æ’å…¥å¤šæ¡æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ mset å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">mset key1 value1 key2 value2 ...</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; mset age 18 score 100 sex male
OK
127.0.0.1:6379[1]&gt; keys <span class="k">*</span>
1<span class="o">)</span> <span class="s2">"score"</span>
2<span class="o">)</span> <span class="s2">"age"</span>
3<span class="o">)</span> <span class="s2">"name"</span>
4<span class="o">)</span> <span class="s2">"sex"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>å–å€¼å‘½ä»¤</p>

    <ul>
      <li>
        <p>redis ä¸­è¿›è¡Œå–å€¼æ“ä½œä½¿ç”¨ get å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">get key</code>ã€‚å¦‚æœç»™å®šçš„é”®ä¸å­˜åœ¨åˆ™è¿”å›ï¼ˆ<strong>nil</strong>ï¼‰ï¼Œè¡¨ç¤ºæŸ¥è¯¢ç»“æœä¸ºç©ºã€‚</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; get name
<span class="s2">"tom"</span>
127.0.0.1:6379[1]&gt; get names
<span class="o">(</span>nil<span class="o">)</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>å¦‚æœå¸Œæœ›ä¸€æ¬¡æ€§ä»redis ä¸­è·å–å¤šä¸ªé”®å¯¹åº”çš„æ•°æ®çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨mget å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">mget key1 key2 ...</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; mget name sex score
1<span class="o">)</span> <span class="s2">"tom"</span>
2<span class="o">)</span> <span class="s2">"male"</span>
3<span class="o">)</span> <span class="s2">"100"</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>åœ¨è·å–å¯¹åº”é”®çš„æ•°æ®æ—¶ï¼Œæƒ³ä¸ºè¯¥é”®æŒ‡å®šæ–°çš„å€¼å¯ä»¥ä½¿ç”¨ getset å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">getset key newValue</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; getset score 99
<span class="s2">"100"</span>
127.0.0.1:6379[1]&gt; get score
<span class="s2">"99"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>åˆ é™¤å‘½ä»¤</p>

    <ul>
      <li>
        <p>åœ¨redis ä¸­åˆ é™¤æ•°æ®ä½¿ç”¨ del å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">del key</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; del score
<span class="o">(</span>integer<span class="o">)</span> 1
127.0.0.1:6379[1]&gt; get score
<span class="o">(</span>nil<span class="o">)</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>å¦‚æœéœ€è¦ç›´æ¥æ¸…ç©ºè¯¥åº“ä¸­æ‰€æœ‰æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ flushdb å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">flushdb</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; flushdb
OK
127.0.0.1:6379[1]&gt; keys <span class="k">*</span>
<span class="o">(</span>empty list or <span class="nb">set</span><span class="o">)</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>å¦‚æœè¦æ¸…ç©ºæ‰€æœ‰åº“ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ flushall å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">flushall</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; flushall
OK
127.0.0.1:6379[1]&gt; <span class="k">select </span>0
OK
127.0.0.1:6379&gt; keys <span class="k">*</span>
<span class="o">(</span>empty list or <span class="nb">set</span><span class="o">)</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>æ•°æ®é€’å¢</p>

    <ul>
      <li>
        <p>å½“å­˜å‚¨çš„å­—ç¬¦ä¸²æ˜¯æ•´æ•°æ—¶ï¼ŒRedis æä¾›äº†ä¸€ä¸ªå®ç”¨çš„å‘½ä»¤ incr ï¼Œå…¶ä½œç”¨æ˜¯è®©å½“å‰é”®å€¼é€’å¢ï¼Œå¹¶è¿”å›é€’å¢åçš„å€¼ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">incr key</code>ã€‚</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379&gt; <span class="nb">set </span>num 1
OK
127.0.0.1:6379&gt; incr num
<span class="o">(</span>integer<span class="o">)</span> 2
127.0.0.1:6379&gt; get num 
<span class="s2">"2"</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>ä¸Šè¿°è‡ªå¢è¡¨ç¤ºæ¯æ¬¡ä½¿ç”¨è¯¥æŒ‡ä»¤ï¼ŒæŒ‡å®šé”®å€¼éƒ½ä¼šåŠ 1ï¼Œå¦‚æœéœ€è¦æŒ‰ç…§æŒ‡å®šçš„é¢æ•°æ®æ¥è¿›è¡Œå¢é•¿ï¼Œå¯ä»¥ä½¿ç”¨ incrby å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">incrby key increment</code>ã€‚</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379&gt; incrby num 10
<span class="o">(</span>integer<span class="o">)</span> 12
127.0.0.1:6379&gt; get num
<span class="s2">"12"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>æ•°å€¼é€’å‡</p>

    <ul>
      <li>
        <p>å½“éœ€è¦å¯¹æ•°æ®è¿›è¡Œé€’å‡æ“ä½œæ—¶ï¼Œä½¿ç”¨ decr å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">decr key</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379&gt; get num
<span class="s2">"12"</span>
127.0.0.1:6379&gt; decr num
<span class="o">(</span>integer<span class="o">)</span> 11
</code></pre></div>        </div>
      </li>
      <li>
        <p>å¦‚æœå¸Œæœ›é€’å‡æŒ‡å®šçš„æ•°å€¼ï¼Œå¯ä»¥ä½¿ç”¨ decrby å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">decrby key decrement</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379&gt; decrby num 10
<span class="o">(</span>integer<span class="o">)</span> 1
127.0.0.1:6379&gt; get num
<span class="s2">"1"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>è¿½åŠ æ•°æ®</p>

    <ul>
      <li>
        <p>åœ¨ Redis ä¸­å¯ä»¥ä½¿ç”¨ append å‘½ä»¤å‘æŒ‡å®šæ•°æ®çš„æœ«å°¾è¿½åŠ å†…å®¹ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">append key value</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379&gt; <span class="nb">set </span>name silhouette
OK
127.0.0.1:6379&gt; append name <span class="s2">" liu"</span>
<span class="o">(</span>integer<span class="o">)</span> 14
127.0.0.1:6379&gt; get name
<span class="s2">"silhouette liu"</span>
</code></pre></div>        </div>

        <blockquote>
          <p>æ³¨æ„ï¼šåœ¨æ’å…¥æ•°æ®æ—¶ï¼Œå­—ç¬¦ä¸²çš„åŒå¼•å·å¯ä»¥çœç•¥ï¼Œä½†æ˜¯å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«ç©ºæ ¼çš„æƒ…å†µï¼Œéœ€è¦åŠ ä¸ŠåŒå¼•å·ï¼Œå¦åˆ™ç©ºæ ¼ä¼šè¢«å¿½ç•¥ã€‚</p>
        </blockquote>
      </li>
    </ul>
  </li>
  <li>
    <p>è·å–é•¿åº¦</p>

    <ul>
      <li>
        <p>ä½¿ç”¨ strlen å‘½ä»¤å¯ä»¥è¿”å›æŒ‡å®šé”®å¯¹åº”çš„å€¼çš„é•¿åº¦ï¼Œå¦‚æœé”®ä¸å­˜åœ¨åˆ™è¿”å› 0ã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">strlen key</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379&gt; get name
<span class="s2">"silhouette liu"</span>
127.0.0.1:6379&gt; strlen key
<span class="o">(</span>integer<span class="o">)</span> 0
127.0.0.1:6379&gt; get name
<span class="s2">"silhouette liu"</span>
127.0.0.1:6379&gt; strlen name
<span class="o">(</span>integer<span class="o">)</span> 14
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h4 id="122--hash-ç±»å‹">1.2.2  <code class="highlighter-rouge">Hash ç±»å‹</code></h4>

<p>hash å«æ•£åˆ—ç±»å‹ï¼Œå®ƒæä¾›äº†å­—æ®µå’Œå­—æ®µå€¼çš„æ˜ å°„ã€‚å­—æ®µå€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸æ”¯æŒæ•£åˆ—ç±»å‹ã€é›†åˆç±»å‹ç­‰å…¶ä»–ç±»å‹ã€‚hash ç±»å‹çš„å¸¸ç”¨å‘½ä»¤æœ‰ï¼š</p>

<ul>
  <li>
    <p>èµ‹å€¼å‘½ä»¤</p>

    <ul>
      <li>
        <p>å‘ hash ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ hset å‘½ä»¤ã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">hset key field value</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; hset user name silhouette
<span class="o">(</span>integer<span class="o">)</span> 1
</code></pre></div>        </div>
      </li>
      <li>
        <p>å¦‚æœå¸Œæœ›ä» redis ä¸­ä¸€æ¬¡æ€§è®¾ç½®å¤šä¸ªå­—æ®µçš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ hmset å‘½ä»¤ã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">kmset key field1 value1 field2 value2 ...</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; hmset user stuNo 1 age 18 score 99
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>å–å€¼å‘½ä»¤</p>

    <ul>
      <li>
        <p>ä» hash ä¸­è·å–æ•°æ®ä½¿ç”¨ hget å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">hget key field</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; hget user name
<span class="s2">"silhouette"</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>ä½¿ç”¨hmget å¯ä»¥ä¸€æ¬¡æ€§è·å–å¤šä¸ªå­—æ®µçš„å€¼ã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">hmget key field1 field2 field3 ....</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; hmget user stuNo age score
1<span class="o">)</span> <span class="s2">"1"</span>
2<span class="o">)</span> <span class="s2">"18"</span>
3<span class="o">)</span> <span class="s2">"99"</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>å¯ä»¥ä½¿ç”¨ hgetall å‘½ä»¤ï¼Œæˆ–è€…æŒ‡å®šé”®çš„æ‰€æœ‰å­—æ®µå’Œå­—æ®µçš„å€¼ã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">hgetall key</code></p>

        <pre><code class="language-sheel">127.0.0.1:6379[1]&gt; hgetall user
1) "name"
2) "silhouette"
3) "stuNo"
4) "1"
5) "age"
6) "18"
7) "score"
8) "99"
</code></pre>
      </li>
      <li>
        <p>ä½¿ç”¨ HKEYS å’Œ HVALS å‘½ä»¤å¯ä»¥åˆ†åˆ«ç”¨æ¥è·å–æŒ‡å®šé”®çš„æ‰€æœ‰é”®å’Œæ‰€æœ‰å€¼ã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">hkeys key</code> å’Œ<code class="highlighter-rouge">hvals key</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; hkeys user
1<span class="o">)</span> <span class="s2">"name"</span>
2<span class="o">)</span> <span class="s2">"stuNo"</span>
3<span class="o">)</span> <span class="s2">"age"</span>
4<span class="o">)</span> <span class="s2">"score"</span>
127.0.0.1:6379[1]&gt; hvals user
1<span class="o">)</span> <span class="s2">"silhouette"</span>
2<span class="o">)</span> <span class="s2">"1"</span>
3<span class="o">)</span> <span class="s2">"18"</span>
4<span class="o">)</span> <span class="s2">"99"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨</p>

    <ul>
      <li>
        <p>åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨ä½¿ç”¨ HEXISTS å‘½ä»¤ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å› 1ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› 0ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">hexists key field</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; hexists user name
<span class="o">(</span>integer<span class="o">)</span> 1
127.0.0.1:6379[1]&gt; hexists user sex
<span class="o">(</span>integer<span class="o">)</span> 0
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>è·å–å­—æ®µæ•°é‡</p>

    <ul>
      <li>
        <p>è·å–å­—æ®µæ•°é‡ä½¿ç”¨ HLEN å‘½ä»¤ï¼Œå¦‚æœé”®ä¸å­˜åœ¨åˆ™è¿”å›0ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">hlen key</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; hlen user 
<span class="o">(</span>integer<span class="o">)</span> 4
127.0.0.1:6379[1]&gt; hlen key
<span class="o">(</span>integer<span class="o">)</span> 0
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>åˆ é™¤å‘½ä»¤</p>

    <ul>
      <li>
        <p>è¦åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µï¼Œä½¿ç”¨ hdel å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">hdel key field [field ...]</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; hgetall user
1<span class="o">)</span> <span class="s2">"name"</span>
2<span class="o">)</span> <span class="s2">"silhouette"</span>
3<span class="o">)</span> <span class="s2">"stuNo"</span>
4<span class="o">)</span> <span class="s2">"1"</span>
5<span class="o">)</span> <span class="s2">"age"</span>
6<span class="o">)</span> <span class="s2">"18"</span>
7<span class="o">)</span> <span class="s2">"score"</span>
8<span class="o">)</span> <span class="s2">"99"</span>
127.0.0.1:6379[1]&gt; hdel user score age
<span class="o">(</span>integer<span class="o">)</span> 2
127.0.0.1:6379[1]&gt; hgetall user
1<span class="o">)</span> <span class="s2">"name"</span>
2<span class="o">)</span> <span class="s2">"silhouette"</span>
3<span class="o">)</span> <span class="s2">"stuNo"</span>
4<span class="o">)</span> <span class="s2">"1"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>å¢åŠ æ•°å­—</p>

    <ul>
      <li>
        <p>å¦‚æœ hash ä¸­çš„å­—æ®µå­˜å‚¨çš„æ˜¯å€¼æ˜¯æ•°å€¼ç±»å‹ï¼Œå¯ä»¥è¿›è¡Œè‡ªå¢æ“ä½œã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">hincrby key field increment</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; hget user stuNo
<span class="s2">"1"</span>
127.0.0.1:6379[1]&gt; hincrby user stuNo 1
<span class="o">(</span>integer<span class="o">)</span> 2
127.0.0.1:6379[1]&gt; hget user stuNo
<span class="s2">"2"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h4 id="123-listç±»å‹">1.2.3 <code class="highlighter-rouge">listç±»å‹</code></h4>

<p>åˆ—è¡¨ç±»å‹ï¼ˆlistï¼‰å¯ä»¥å­˜å‚¨ä¸€ä¸ªæœ‰åºçš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå¸¸ç”¨çš„æ“ä½œæ˜¯å‘åˆ—è¡¨ä¸¤ç«¯æ·»åŠ å…ƒç´ ï¼Œæˆ–è€…è·å¾—åˆ—è¡¨çš„æŸä¸ªç‰‡æ®µã€‚åˆ—è¡¨ç±»å‹å†…éƒ¨æ˜¯ä½¿ç”¨<code class="highlighter-rouge">åŒå‘é“¾è¡¨(double linked list)</code>å®ç°çš„ï¼Œæ‰€ä»¥å‘åˆ—è¡¨ä¸¤ç«¯æ·»åŠ å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œè·å–è¶Šæ¥è¿‘ä¸¤ç«¯çš„å…ƒç´ é€Ÿåº¦å°±è¶Šå¿«ï¼Œè¿™æ„å‘³ç€å³ä½¿æ˜¯ä¸€ä¸ªå‡ åƒä¸‡ä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼Œè·å–å¤´éƒ¨æˆ–å°¾éƒ¨çš„10æ¡è®°å½•ä¹Ÿæ˜¯æå¿«çš„ï¼Œlist ç±»å‹çš„å¸¸ç”¨å‘½ä»¤æœ‰ï¼›</p>

<ul>
  <li>
    <p>æ·»åŠ å…ƒç´ </p>

    <ul>
      <li>
        <p>Redis åˆ—è¡¨é‡‡ç”¨åŒå‘é“¾è¡¨å®ç°ï¼Œå› æ­¤åœ¨æ’å…¥æ•°æ®æ—¶å¯ä»¥ä»ä¸¤ç«¯åˆ†åˆ«æ“ä½œï¼Œæƒ³åˆ—è¡¨å·¦è¾¹å¢åŠ å…ƒç´ ä½¿ç”¨ lpush å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">lpush key value</code>ã€‚å‘åˆ—è¡¨å³è¾¹æ·»åŠ å…ƒç´ ä½¿ç”¨ rpush å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">rpush key value</code>ã€‚</p>
      </li>
      <li>
        <p><code class="highlighter-rouge">lpush å‘½ä»¤æ˜¯ä»å·¦å‘å³æ’å…¥ï¼Œä»å³å‘å·¦å¼¹å‡ºï¼Œæ»¡è¶³å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—æ¨¡å¼</code></p>
      </li>
      <li>
        <p><code class="highlighter-rouge">rpush å‘½ä»¤æ˜¯ä»å³å‘å·¦æ’å…¥ï¼Œä»å·¦å‘å³å¼¹å‡ºï¼Œæ»¡è¶³å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—æ¨¡å¼</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[1]&gt; <span class="k">select </span>2
OK
127.0.0.1:6379[2]&gt; lpush nums 1
<span class="o">(</span>integer<span class="o">)</span> 1
127.0.0.1:6379[2]&gt; lpush nums 2
<span class="o">(</span>integer<span class="o">)</span> 2
127.0.0.1:6379[2]&gt; lpush nums 3
<span class="o">(</span>integer<span class="o">)</span> 3
127.0.0.1:6379[2]&gt; lpush nums 4
<span class="o">(</span>integer<span class="o">)</span> 4
127.0.0.1:6379[2]&gt; lpush n  ums 5
<span class="o">(</span>integer<span class="o">)</span> 5
127.0.0.1:6379[2]&gt; rpush str a
<span class="o">(</span>integer<span class="o">)</span> 1
127.0.0.1:6379[2]&gt; rpush str b
<span class="o">(</span>integer<span class="o">)</span> 2
127.0.0.1:6379[2]&gt; rpush str c
<span class="o">(</span>integer<span class="o">)</span> 3
127.0.0.1:6379[2]&gt; rpush str d
<span class="o">(</span>integer<span class="o">)</span> 4
127.0.0.1:6379[2]&gt; rpush str e
<span class="o">(</span>integer<span class="o">)</span> 5
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>æŸ¥çœ‹åˆ—è¡¨</p>

    <ul>
      <li>
        <p>LRANGE å‘½ä»¤æ˜¯åˆ—è¡¨ç±»å‹æœ€å¸¸ç”¨çš„å‘½ä»¤ä¹‹ä¸€ï¼Œè·å–åˆ—è¡¨ä¸­çš„æŸä¸€ç‰‡æ®µï¼Œå°†è¿”å› startã€stop ä¹‹é—´çš„æ‰€æœ‰å…ƒç´ (åŒ…æ‹¬ä¸¤ç«¯çš„å…ƒç´ )ï¼Œç´¢å¼•ä» 0 å¼€å§‹ã€‚ç´¢å¼•å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œå¦‚ï¼šâ€œ-1â€ä»£è¡¨æœ€å³è¾¹çš„ä¸€ä¸ªå…ƒç´ ã€‚</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[2]&gt; lrange nums 0 4
1<span class="o">)</span> <span class="s2">"5"</span>
2<span class="o">)</span> <span class="s2">"4"</span>
3<span class="o">)</span> <span class="s2">"3"</span>
4<span class="o">)</span> <span class="s2">"2"</span>
5<span class="o">)</span> <span class="s2">"1"</span>
127.0.0.1:6379[2]&gt; lrange str 0 4
1<span class="o">)</span> <span class="s2">"a"</span>
2<span class="o">)</span> <span class="s2">"b"</span>
3<span class="o">)</span> <span class="s2">"c"</span>
4<span class="o">)</span> <span class="s2">"d"</span>
5<span class="o">)</span> <span class="s2">"e"</span>
</code></pre></div>        </div>

        <blockquote>
          <p>Tipsï¼šä»ä»¥ä¸Šè·å–çš„æ•°æ®ç±»å‹ç»“æ„æ¥çœ‹ï¼Œæˆ‘ä»¬å‘ç°ä»åˆ—è¡¨çš„å·¦ä¾§æ’å…¥æ•°æ®ï¼Œåœ¨åˆ—è¡¨ä¸­æ•°æ®ä»¥å€’å™å­˜æ”¾ï¼Œä»åˆ—è¡¨çš„å³ä¾§é‡Œæ’å…¥æ•°æ®åˆ™æ˜¯æ­£åºå­˜æ”¾</p>
        </blockquote>
      </li>
    </ul>
  </li>
  <li>
    <p>è·å–æ•°æ®</p>

    <ul>
      <li>
        <p>åœ¨åˆ—è¡¨ä¸­å¯ä»¥ä½¿ç”¨ lpop å’Œ rpop åˆ†åˆ«åˆ—è¡¨çš„å·¦ä¾§å’Œå³ä¾§å¼¹å‡ºä¸€ä¸ªæ•°æ®ï¼Œè¯¥æ•°æ®ä¼šé¦–å…ˆè¿”å›ï¼Œç„¶åå†ä»åŸåˆ—è¡¨ä¸­åˆ é™¤ã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">lpop key</code>æˆ–<code class="highlighter-rouge">rpop key</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[2]&gt; lpop nums
<span class="s2">"5"</span>
127.0.0.1:6379[2]&gt; lrange nums 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"4"</span>
2<span class="o">)</span> <span class="s2">"3"</span>
3<span class="o">)</span> <span class="s2">"2"</span>
4<span class="o">)</span> <span class="s2">"1"</span>
127.0.0.1:6379[2]&gt; rpop nums
<span class="s2">"1"</span>
127.0.0.1:6379[2]&gt; lrange nums 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"4"</span>
2<span class="o">)</span> <span class="s2">"3"</span>
3<span class="o">)</span> <span class="s2">"2"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>è·å–åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°</p>

    <ul>
      <li>
        <p>ä½¿ç”¨ LLEN å‘½ä»¤å¯ä»¥è·å–åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">LLEN key</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[2]&gt; llen str
<span class="o">(</span>integer<span class="o">)</span> 5
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>åˆ é™¤åˆ—è¡¨ä¸­æŒ‡å®šçš„å€¼</p>

    <ul>
      <li>
        <p>LREM å‘½ä»¤ä¼šåˆ é™¤åˆ—è¡¨ä¸­å‰ count ä¸ªå€¼ä¸º value çš„å…ƒç´ ï¼Œè¿”å›å®é™…åˆ é™¤çš„å…ƒç´ ä¸ªæ•°ã€‚æ ¹æ®count å€¼çš„ä¸åŒï¼Œè¯¥å‘½ä»¤çš„æ‰§è¡Œæ–¹å¼ä¼šæœ‰æ‰€ä¸åŒï¼šè¯­æ³•ï¼š<code class="highlighter-rouge">LREM key count value</code></p>

        <ul>
          <li>å½“ count &gt; 0 æ—¶ï¼ŒLREM ä¼šä»åˆ—è¡¨å·¦è¾¹å¼€å§‹åˆ é™¤</li>
          <li>å½“ count &lt; 0 æ—¶ï¼ŒLREM ä¼šä»åˆ—è¡¨å³è¾¹å¼€å§‹åˆ é™¤</li>
          <li>å½“ count = 0 æ—¶ï¼ŒLREM åˆ é™¤æ‰€æœ‰å€¼ä¸º value çš„å…ƒç´ </li>
        </ul>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[2]&gt; lrange str 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"a"</span>
2<span class="o">)</span> <span class="s2">"b"</span>
3<span class="o">)</span> <span class="s2">"c"</span>
4<span class="o">)</span> <span class="s2">"d"</span>
5<span class="o">)</span> <span class="s2">"e"</span>
127.0.0.1:6379[2]&gt; lrem str 0 a
<span class="o">(</span>integer<span class="o">)</span> 1
127.0.0.1:6379[2]&gt; lrange str 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"b"</span>
2<span class="o">)</span> <span class="s2">"c"</span>
3<span class="o">)</span> <span class="s2">"d"</span>
4<span class="o">)</span> <span class="s2">"e"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>è·å–/è®¾ç½®æŒ‡å®šç´¢å¼•çš„å…ƒç´ å€¼</p>

    <ul>
      <li>
        <p>è·å–æŒ‡å®šç´¢å¼•çš„å…ƒç´ å€¼ä½¿ç”¨ lindex å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">lindex key index</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[2]&gt; lrange nums 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"4"</span>
2<span class="o">)</span> <span class="s2">"3"</span>
3<span class="o">)</span> <span class="s2">"2"</span>
127.0.0.1:6379[2]&gt; lindex nums 2
<span class="s2">"2"</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>è®¾ç½®æŒ‡å®šç´¢å¼•çš„å…ƒç´ å€¼ä½¿ç”¨ lset å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">lset key index value</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[2]&gt; lset nums 2 x
OK
127.0.0.1:6379[2]&gt; lrange nums 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"4"</span>
2<span class="o">)</span> <span class="s2">"3"</span>
3<span class="o">)</span> <span class="s2">"x"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>åªä¿ç•™åˆ—è¡¨æŒ‡å®šç‰‡æ®µ</p>

    <ul>
      <li>
        <p>List ä¸­ä½¿ç”¨ ltrim å‘½ä»¤å¯¹åˆ—è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæˆªå–æ“ä½œï¼Œåªä¿ç•™æŒ‡å®šæ•°æ®ç‰‡æ®µã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">ltrim key start stop</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[2]&gt; ltrim nums 1 2
OK
127.0.0.1:6379[2]&gt; lrange nums 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"3"</span>
2<span class="o">)</span> <span class="s2">"x"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>å‘åˆ—è¡¨ä¸­æ’å…¥å…ƒç´ </p>

    <ul>
      <li>
        <p>å‘åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ å¯ä»¥ä½¿ç”¨ linsert å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">LINAERT key BEFORE|AFTER pivot value</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[2]&gt; lrange nums 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"4"</span>
2<span class="o">)</span> <span class="s2">"x"</span>
127.0.0.1:6379[2]&gt; linsert nums after 4 3
<span class="o">(</span>integer<span class="o">)</span> 3
127.0.0.1:6379[2]&gt; lrange nums 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"4"</span>
2<span class="o">)</span> <span class="s2">"3"</span>
3<span class="o">)</span> <span class="s2">"x"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>å°†å…ƒç´ ä»ä¸€ä¸ªåˆ—è¡¨è½¬ç§»åˆ°å¦ä¸€ä¸ªåˆ—è¡¨ä¸­</p>

    <ul>
      <li>
        <p>ä½¿ç”¨ RPOPLPUSH å‘½ä»¤å¯ä»¥å°†å…ƒç´ ä»ä¸€ä¸ªåˆ—è¡¨è½¬ç§»åˆ°å¦ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">RPOPLPUSH source destination</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[2]&gt; lrange nums 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"4"</span>
2<span class="o">)</span> <span class="s2">"3"</span>
3<span class="o">)</span> <span class="s2">"x"</span>
127.0.0.1:6379[2]&gt; lrange num1 0 <span class="nt">-1</span>
<span class="o">(</span>empty list or <span class="nb">set</span><span class="o">)</span>
127.0.0.1:6379[2]&gt; rpoplpush nums num1
<span class="s2">"x"</span>
127.0.0.1:6379[2]&gt; lrange num1 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"x"</span>
127.0.0.1:6379[2]&gt; lrange nums 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"4"</span>
2<span class="o">)</span> <span class="s2">"3"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h4 id="124-set-ç±»å‹">1.2.4 <code class="highlighter-rouge">set ç±»å‹</code></h4>

<p>é›†åˆç±»å‹çš„å¸¸ç”¨æ“ä½œæ˜¯å‘é›†åˆä¸­åŠ å…¥æˆ–åˆ é™¤å…ƒç´ ï¼Œæ€•å¥´è›‹æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ç­‰ã€‚ç”±äºé›†åˆç±»å‹çš„ redis å†…éƒ¨æ˜¯ä½¿ç”¨å€¼ä¸ºç©ºçš„<strong>æ•£åˆ—è¡¨</strong>å®ç°ï¼Œæ‰€ä»¥è¿™äº›æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸º O(1)ã€‚redis è¿˜æä¾›äº†å¤šä¸ªé›†åˆä¹‹é—´çš„äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„è¿ç®—ã€‚</p>

<ul>
  <li>
    <p>å¢åŠ /åˆ é™¤å…ƒç´ </p>

    <ul>
      <li>
        <p>é›†åˆä¸­æ·»åŠ æ•°æ®ä½¿ç”¨ sadd å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">sadd key member [member ...]</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[2]&gt; <span class="k">select </span>3
OK
127.0.0.1:6379[3]&gt; sadd num1 10 20
<span class="o">(</span>integer<span class="o">)</span> 2
127.0.0.1:6379[3]&gt; sadd num2 10 20 30 40 
<span class="o">(</span>integer<span class="o">)</span> 4
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>è·å–é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ </p>

    <ul>
      <li>
        <p>è·å–é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ä½¿ç”¨ SMEMBERS å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">smembers key</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[3]&gt; smembers num1
1<span class="o">)</span> <span class="s2">"10"</span>
2<span class="o">)</span> <span class="s2">"20"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>é›†åˆçš„å·®é›†è¿ç®—</p>

    <ul>
      <li>
        <p>å±äº A å¹¶ä¸”ä¸å±äº B çš„å…ƒç´ æ„æˆçš„é›†åˆï¼Œä½¿ç”¨ SDIFF å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">sdiff key [key ...]</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[3]&gt; sdiff num2 num1
1<span class="o">)</span> <span class="s2">"30"</span>
2<span class="o">)</span> <span class="s2">"40"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>é›†åˆçš„äº¤é›†è¿ç®—</p>

    <ul>
      <li>
        <p>å±äº A å¹¶ä¸”ä¹Ÿå±äº B çš„å…ƒç´ æ„æˆçš„é›†åˆï¼Œä½¿ç”¨SINTER å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">sinter key [key ...]</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[3]&gt; sinter num1 num2
1<span class="o">)</span> <span class="s2">"10"</span>
2<span class="o">)</span> <span class="s2">"20"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>é›†åˆçš„å¹¶é›†è¿ç®—</p>

    <ul>
      <li>
        <p>å±äº Aå¹¶ä¸”æˆ–è€…å±äº B çš„å…ƒç´ æ„æˆçš„é›†åˆï¼Œä½¿ç”¨ SUNION å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">sunoin key [key ...]</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[3]&gt; sunion num1 num2
1<span class="o">)</span> <span class="s2">"10"</span>
2<span class="o">)</span> <span class="s2">"20"</span>
3<span class="o">)</span> <span class="s2">"30"</span>
4<span class="o">)</span> <span class="s2">"40"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>è·å¾—é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°</p>

    <ul>
      <li>
        <p>è·å¾—é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œä½¿ç”¨SCARD å‘½ä»¤ï¼Œå¦‚æœé›†åˆä¸å­˜åœ¨åˆ™è¿”å› 0ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">scard key</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[3]&gt; scard num2
<span class="o">(</span>integer<span class="o">)</span> 4
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>ä»é›†åˆä¸­å¼¹å‡ºä¸€ä¸ªå…ƒç´ </p>

    <ul>
      <li>
        <p>ä»é›†åˆä¸­<code class="highlighter-rouge">éšæœº</code>çš„å¼¹å‡ºä¸€ä¸ªå…ƒç´ ä½¿ç”¨ spop å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">spop key</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[3]&gt; sadd num3 10 20 30 40 50
<span class="o">(</span>integer<span class="o">)</span> 5
127.0.0.1:6379[3]&gt; smembers num3
1<span class="o">)</span> <span class="s2">"10"</span>
2<span class="o">)</span> <span class="s2">"20"</span>
3<span class="o">)</span> <span class="s2">"30"</span>
4<span class="o">)</span> <span class="s2">"40"</span>
5<span class="o">)</span> <span class="s2">"50"</span>
127.0.0.1:6379[3]&gt; spop num3
<span class="s2">"20"</span>
127.0.0.1:6379[3]&gt; spop num3
<span class="s2">"50"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h4 id="125--sorted-set-ç±»å‹">1.2.5  <code class="highlighter-rouge">sorted set ç±»å‹</code></h4>

<p>åœ¨é›†åˆç±»å‹çš„åŸºç¡€ä¸Š<code class="highlighter-rouge">æœ‰åºé›†åˆç±»å‹</code>ä¸ºé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å…³è”ä¸€ä¸ªåˆ†æ•°ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬ä¸ä»…å¯ä»¥å®Œæˆæ’å…¥ã€åˆ é™¤å’Œåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨é›†åˆä¸­ï¼Œè¿˜èƒ½å¤Ÿè·å¾—åˆ†æ•°æœ€é«˜æˆ–æœ€ä½çš„å‰Nä¸ªå…ƒç´ ã€è·å–æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ç­‰ä¸åˆ†æ•°æœ‰å…³çš„æ“ä½œã€‚</p>

<p>åœ¨æŸäº›æ–¹é¢æœ‰åºé›†åˆå’Œåˆ—è¡¨ç±»å‹æœ‰äº›ç›¸ä¼¼ã€‚</p>

<ul>
  <li>ä¸¤è€…éƒ½æ˜¯æœ‰åºçš„</li>
  <li>ä¸¤è€…éƒ½å¯ä»¥è·å¾—æŸä¸€èŒƒå›´çš„å…ƒç´ </li>
</ul>

<p>ä½†æ˜¯ï¼Œä¸¤è€…æœ‰ç€å¾ˆå¤§åŒºåˆ«ï¼š</p>

<ul>
  <li>åˆ—è¡¨ç±»å‹æ˜¯é€šè¿‡é“¾è¡¨å®ç°çš„ï¼Œè·å–é è¿‘ä¸¤ç«¯çš„æ•°æ®é€Ÿåº¦æå¿«ï¼Œè€Œå½“å…ƒç´ å¢å¤šåï¼Œè®¿é—®ä¸­é—´æ•°æ®çš„é€Ÿåº¦ä¼šå˜æ…¢ã€‚</li>
  <li>æœ‰åºé›†åˆç±»å‹ä½¿ç”¨æ•£åˆ—è¡¨å®ç°ï¼Œæ‰€æœ‰å³ä½¿è¯»å–ä½äºä¸­é—´éƒ¨åˆ†çš„æ•°æ®ä¹Ÿå¾ˆå¿«</li>
  <li>åˆ—è¡¨ä¸­ä¸èƒ½ç®€å•çš„è°ƒç”¨æŸä¸ªå…ƒç´ çš„ä½ç½®ï¼Œä½†æ˜¯æœ‰åºé›†åˆå¯ä»¥(é€šè¿‡æ›´æ”¹åˆ†æ•°å®ç°)</li>
  <li>æœ‰åºé›†åˆè¦æ¯”åˆ—è¡¨ç±»å‹æ›´è€—å†…å­˜</li>
</ul>

<p>sorted set ç±»å‹çš„å¸¸ç”¨å‘½ä»¤æœ‰ï¼š</p>

<ol>
  <li>
    <p>å¢åŠ å…ƒç´ </p>

    <ul>
      <li>
        <p>å‘æœ‰åºé›†åˆä¸­åŠ å…¥ä¸€ä¸ªå…ƒç´ å’Œè¯¥å…ƒç´ çš„åˆ†æ•°ï¼Œå¦‚æœè¯¥å…ƒç´ å·²ç»å­˜åœ¨åˆ™ä¼šç”¨æ–°çš„åˆ†æ•°æ›¿æ¢åŸæœ‰çš„åˆ†æ•°ã€‚è¿”å›å€¼æ˜¯æ–°åŠ å…¥åˆ°é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œä¸åŒ…å«æ‰§å‹¤å•Šå·²ç»å­˜åœ¨çš„å…ƒç´ ã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">zadd key score member [score member]</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; <span class="k">select </span>4
OK
127.0.0.1:6379[4]&gt; zadd score 80 tom 90 lucy 85 silhouette
<span class="o">(</span>integer<span class="o">)</span> 3
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>è·å–æ’ååœ¨æŸä¸ªèŒƒå›´çš„å…ƒç´ åˆ—è¡¨</p>

    <ul>
      <li>
        <p>è·å¾—æ’åå­æŸä¸ªèŒƒå›´çš„å…ƒç´ åˆ—è¡¨ä½¿ç”¨ zrange å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">zrange key start stop [withscores]</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; zrange score 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"tom"</span>
2<span class="o">)</span> <span class="s2">"silhouette"</span>
3<span class="o">)</span> <span class="s2">"lucy"</span>
127.0.0.1:6379[4]&gt; zrange score 0 <span class="nt">-1</span> withscores
1<span class="o">)</span> <span class="s2">"tom"</span>
2<span class="o">)</span> <span class="s2">"80"</span>
3<span class="o">)</span> <span class="s2">"silhouette"</span>
4<span class="o">)</span> <span class="s2">"85"</span>
5<span class="o">)</span> <span class="s2">"lucy"</span>
6<span class="o">)</span> <span class="s2">"90"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>åˆ é™¤å…ƒç´ </p>

    <ul>
      <li>
        <p>ç§»é™¤æœ‰åºé›† key ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ä½¿ç”¨ zrem å‘½ä»¤ï¼Œä¸å­˜åœ¨çš„æˆå‘˜å°†è¢«å¿½ç•¥ã€‚è¯­æ³•ï¼š<code class="highlighter-rouge">zrem key member[member ...]</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; zrange score 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"tom"</span>
2<span class="o">)</span> <span class="s2">"silhouette"</span>
3<span class="o">)</span> <span class="s2">"lucy"</span>
127.0.0.1:6379[4]&gt; zrem score tom
<span class="o">(</span>integer<span class="o">)</span> 1
127.0.0.1:6379[4]&gt; zrange score 0 <span class="nt">-1</span>
1<span class="o">)</span> <span class="s2">"silhouette"</span>
2<span class="o">)</span> <span class="s2">"lucy"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>è·å¾—æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´ </p>

    <ul>
      <li>
        <p>è·å¾—æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´ ä½¿ç”¨ zrangebyscore å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; zrangebyscore score 90 100 withscores
1<span class="o">)</span> <span class="s2">"lucy"</span>
2<span class="o">)</span> <span class="s2">"90"</span>
127.0.0.1:6379[4]&gt;  zrange score 0 <span class="nt">-1</span> withscores
1<span class="o">)</span> <span class="s2">"silhouette"</span>
2<span class="o">)</span> <span class="s2">"85"</span>
3<span class="o">)</span> <span class="s2">"lucy"</span>
4<span class="o">)</span> <span class="s2">"90"</span>
127.0.0.1:6379[4]&gt;  zrangebyscore score 90 100
1<span class="o">)</span> <span class="s2">"lucy"</span>
127.0.0.1:6379[4]&gt;  zrangebyscore score 90 100 withscores
1<span class="o">)</span> <span class="s2">"lucy"</span>
2<span class="o">)</span> <span class="s2">"90"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>å¢åŠ æŸä¸ªå…ƒç´ çš„åˆ†æ•°ï¼Œè¿”å›å€¼æ˜¯æ›´æ”¹åçš„åˆ†æ•°</p>

    <ul>
      <li>
        <p>å¢åŠ æŸä¸ªå…ƒç´ çš„åˆ†æ•°ï¼Œè¿”å›å€¼æ˜¯æ›´æ”¹åçš„åˆ†æ•°ï¼Œä½¿ç”¨ zincrby å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">ZINCRBY key increment member</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; zincrby score 4 silhouette
<span class="s2">"89"</span>
127.0.0.1:6379[4]&gt;  zrange score 0 <span class="nt">-1</span> withscores
1<span class="o">)</span> <span class="s2">"silhouette"</span>
2<span class="o">)</span> <span class="s2">"89"</span>
3<span class="o">)</span> <span class="s2">"lucy"</span>
4<span class="o">)</span> <span class="s2">"90"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>è·å–é›†åˆä¸­å…ƒç´ çš„æ•°é‡</p>

    <ul>
      <li>
        <p>è·å–é›†åˆä¸­å…ƒç´ çš„æ•°é‡ä½¿ç”¨ ZCARD å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">ZCARD key</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; zcard score
<span class="o">(</span>integer<span class="o">)</span> 2
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>è·å¾—æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ä¸ªæ•°</p>

    <ul>
      <li>
        <p>è·å–æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ä¸ªæ•°ä½¿ç”¨ ZOUNT å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">ZCOUNT key min max</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt;  zrange score 0 <span class="nt">-1</span> withscores
1<span class="o">)</span> <span class="s2">"silhouette"</span>
2<span class="o">)</span> <span class="s2">"89"</span>
3<span class="o">)</span> <span class="s2">"lucy"</span>
4<span class="o">)</span> <span class="s2">"90"</span>
127.0.0.1:6379[4]&gt; zcount score 90 100
<span class="o">(</span>integer<span class="o">)</span> 1
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>æŒ‰ç…§æ’åèŒƒå›´åˆ é™¤å…ƒç´ </p>

    <ul>
      <li>
        <p>æŒ‰ç…§æ’åèŒƒå›´åˆ é™¤å…ƒç´ ä½¿ç”¨ ZREMRANGEBYRANK å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">ZREMRANGEBYRANK key start stop</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; zadd score 80 tom 90 lucy 85 silhouette
<span class="o">(</span>integer<span class="o">)</span> 3
127.0.0.1:6379[4]&gt; zremrangebyrank score 0 1
<span class="o">(</span>integer<span class="o">)</span> 2
127.0.0.1:6379[4]&gt;  zrange score 0 <span class="nt">-1</span> withscores
1<span class="o">)</span> <span class="s2">"lucy"</span>
2<span class="o">)</span> <span class="s2">"90"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>æŒ‰ç…§åˆ†æ•°èŒƒå›´åˆ é™¤å…ƒç´ </p>

    <ul>
      <li>
        <p>æŒ‰ç…§åˆ†æ•°èŒƒå›´åˆ é™¤å…ƒç´ ä½¿ç”¨ ZREMRANGEBYSCORE ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">ZREMRANGEBYSCORE key start stop</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt;  zrange score 0 <span class="nt">-1</span> withscores
1<span class="o">)</span> <span class="s2">"lili"</span>
2<span class="o">)</span> <span class="s2">"75"</span>
3<span class="o">)</span> <span class="s2">"tom"</span>
4<span class="o">)</span> <span class="s2">"80"</span>
5<span class="o">)</span> <span class="s2">"silhouette"</span>
6<span class="o">)</span> <span class="s2">"85"</span>
7<span class="o">)</span> <span class="s2">"lucy"</span>
8<span class="o">)</span> <span class="s2">"90"</span>
127.0.0.1:6379[4]&gt; zremrangebyscore score 0 79
<span class="o">(</span>integer<span class="o">)</span> 1
127.0.0.1:6379[4]&gt;  zrange score 0 <span class="nt">-1</span> withscores
1<span class="o">)</span> <span class="s2">"tom"</span>
2<span class="o">)</span> <span class="s2">"80"</span>
3<span class="o">)</span> <span class="s2">"silhouette"</span>
4<span class="o">)</span> <span class="s2">"85"</span>
5<span class="o">)</span> <span class="s2">"lucy"</span>
6<span class="o">)</span> <span class="s2">"90"</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>è·å–å…ƒç´ çš„æ’å</p>

    <ul>
      <li>
        <p>è·å–å…ƒç´ çš„æ’åä½¿ç”¨ ZRANK å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">ZRANK key member</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt;  zrange score 0 <span class="nt">-1</span> withscores
1<span class="o">)</span> <span class="s2">"tom"</span>
2<span class="o">)</span> <span class="s2">"80"</span>
3<span class="o">)</span> <span class="s2">"silhouette"</span>
4<span class="o">)</span> <span class="s2">"85"</span>
5<span class="o">)</span> <span class="s2">"lucy"</span>
6<span class="o">)</span> <span class="s2">"90"</span>
127.0.0.1:6379[4]&gt; zrank score silhouette
<span class="o">(</span>integer<span class="o">)</span> 1
127.0.0.1:6379[4]&gt; zrank score lucy
<span class="o">(</span>integer<span class="o">)</span> 2
127.0.0.1:6379[4]&gt; zrank score tom
<span class="o">(</span>integer<span class="o">)</span> 0
</code></pre></div>        </div>
      </li>
      <li>
        <p>è·å–å…ƒç´ çš„å€’åºæ’åä½¿ç”¨ ZREVRANK å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">ZREVRANK key member</code></p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; zrank score lucy
<span class="o">(</span>integer<span class="o">)</span> 2
127.0.0.1:6379[4]&gt; zrevrank score lucy
<span class="o">(</span>integer<span class="o">)</span> 0
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<h3 id="13-redis-çš„å…¶ä»–å‘½ä»¤">1.3 redis çš„å…¶ä»–å‘½ä»¤</h3>

<h4 id="131-è®¾ç½®-key-çš„ç”Ÿå­˜æ—¶é—´">1.3.1 è®¾ç½® key çš„ç”Ÿå­˜æ—¶é—´</h4>

<p>redis åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­æ›´å¤šçš„ç”¨åšç¼“å­˜ï¼Œç„¶è€Œç¼“å­˜çš„æ•°æ®ä¸€èˆ¬éƒ½æ˜¯éœ€è¦è®¾ç½®ç”Ÿå­˜æ—¶é—´çš„ï¼Œå³ï¼šåˆ°æœŸåæ•°æ®é”€æ¯ã€‚</p>

<pre><code class="language-txt">EXPIRE key seconds					è®¾ç½®keyçš„ç”Ÿå­˜æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰keyåœ¨å¤šå°‘ç§’åä¼šè‡ªåŠ¨åˆ é™¤
TTL key 										æŸ¥çœ‹keyç”Ÿäºçš„ç”Ÿå­˜æ—¶é—´
PERSIST key									æ¸…é™¤ç”Ÿå­˜æ—¶é—´ 
PEXPIRE key milliseconds		ç”Ÿå­˜æ—¶é—´è®¾ç½®å•ä½ä¸ºï¼šæ¯«ç§’
</code></pre>

<h4 id="132-è¿”å›æ»¡è¶³ç»™å®špattern-çš„æ‰€æœ‰-key">1.3.2 è¿”å›æ»¡è¶³ç»™å®špattern çš„æ‰€æœ‰ key</h4>

<ul>
  <li>
    <p>redis ä¸­å¯ä»¥ä½¿ç”¨ pattern æ¥è·å–é”®çš„åç§°</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; keys <span class="k">*</span> 
1<span class="o">)</span> <span class="s2">"score"</span>
2<span class="o">)</span> <span class="s2">"scores"</span>
127.0.0.1:6379[4]&gt; keys score<span class="k">*</span>
1<span class="o">)</span> <span class="s2">"score"</span>
2<span class="o">)</span> <span class="s2">"scores"</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="133-é‡å‘½ä»¤-key">1.3.3 é‡å‘½ä»¤ key</h4>

<ul>
  <li>
    <p>é‡å‘½å key ä½¿ç”¨ rename å‘½ä»¤ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">rename name newname</code></p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; keys <span class="k">*</span> 
1<span class="o">)</span> <span class="s2">"score"</span>
2<span class="o">)</span> <span class="s2">"scores"</span>
127.0.0.1:6379[4]&gt; rename scores demo
OK
127.0.0.1:6379[4]&gt; keys <span class="k">*</span>
1<span class="o">)</span> <span class="s2">"score"</span>
2<span class="o">)</span> <span class="s2">"demo"</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="134-è¿”å›å€¼ç±»å‹">1.3.4 è¿”å›å€¼ç±»å‹</h4>

<ul>
  <li>
    <p>ä½¿ç”¨ type å‘½ä»¤å¯ä»¥è¿”å›æŒ‡å®šé”®çš„å€¼çš„ç±»å‹ï¼Œè¯­æ³•ï¼š<code class="highlighter-rouge">type key</code></p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; <span class="nb">type </span>score
zset
127.0.0.1:6379[4]&gt; <span class="nb">set </span>name lili
OK
127.0.0.1:6379[4]&gt; <span class="nb">type </span>name
string
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="135-è·å–æœåŠ¡å™¨çš„ä¿¡æ¯å’Œç»Ÿè®¡">1.3.5 è·å–æœåŠ¡å™¨çš„ä¿¡æ¯å’Œç»Ÿè®¡</h4>

<ul>
  <li>
    <p>è·å–æœåŠ¡å™¨çš„ä¿¡æ¯å’Œç»Ÿè®¡ä½¿ç”¨ info å‘½ä»¤</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; info
<span class="c"># Server</span>
redis_version:3.0.0
redis_git_sha1:00000000
redis_git_dirty:0
redis_build_id:623444a9491ce503
redis_mode:standalone
os:Linux 3.10.0-1062.el7.x86_64 x86_64
arch_bits:64
multiplexing_api:epoll
gcc_version:4.8.5
process_id:1576
run_id:2887fee0240c056f048965cf62410d4ba5df2dca
tcp_port:6379
uptime_in_seconds:12794
uptime_in_days:0
hz:10
lru_clock:15313912
config_file:/usr/local/redis/etc/redis.conf
  
<span class="c"># Clients</span>
connected_clients:1
client_longest_output_list:0
client_biggest_input_buf:0
blocked_clients:0
  
<span class="c"># Memory</span>
used_memory:816152
used_memory_human:797.02K
used_memory_rss:7442432
used_memory_peak:816616
used_memory_peak_human:797.48K
used_memory_lua:35840
mem_fragmentation_ratio:9.12
mem_allocator:jemalloc-3.6.0
  
<span class="c"># Persistence</span>
loading:0
rdb_changes_since_last_save:3
rdb_bgsave_in_progress:0
rdb_last_save_time:1592371760
rdb_last_bgsave_status:ok
rdb_last_bgsave_time_sec:0
rdb_current_bgsave_time_sec:-1
aof_enabled:0
aof_rewrite_in_progress:0
aof_rewrite_scheduled:0
aof_last_rewrite_time_sec:-1
aof_current_rewrite_time_sec:-1
aof_last_bgrewrite_status:ok
aof_last_write_status:ok
  
<span class="c"># Stats</span>
total_connections_received:1
total_commands_processed:190
instantaneous_ops_per_sec:0
total_net_input_bytes:7121
total_net_output_bytes:5012
instantaneous_input_kbps:0.00
instantaneous_output_kbps:0.00
rejected_connections:0
sync_full:0
sync_partial_ok:0
sync_partial_err:0
expired_keys:0
evicted_keys:0
keyspace_hits:106
keyspace_misses:9
pubsub_channels:0
pubsub_patterns:0
latest_fork_usec:805
migrate_cached_sockets:0
  
<span class="c"># Replication</span>
role:master
connected_slaves:0
master_repl_offset:0
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0
  
<span class="c"># CPU</span>
used_cpu_sys:8.06
used_cpu_user:3.69
used_cpu_sys_children:0.01
used_cpu_user_children:0.01
  
<span class="c"># Cluster</span>
cluster_enabled:0
  
<span class="c"># Keyspace</span>
db0:keys<span class="o">=</span>2,expires<span class="o">=</span>0,avg_ttl<span class="o">=</span>0
db1:keys<span class="o">=</span>1,expires<span class="o">=</span>0,avg_ttl<span class="o">=</span>0
db2:keys<span class="o">=</span>3,expires<span class="o">=</span>0,avg_ttl<span class="o">=</span>0
db3:keys<span class="o">=</span>3,expires<span class="o">=</span>0,avg_ttl<span class="o">=</span>0
db4:keys<span class="o">=</span>3,expires<span class="o">=</span>0,avg_ttl<span class="o">=</span>0
</code></pre></div>    </div>
  </li>
  <li>
    <p>å¦‚æœåªéœ€è¦è·å–æŸä¸€ä¸ªæ–¹é¢çš„ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ info åŠ ä¸Šéœ€è¦çš„ä¿¡æ¯åç§°å³å¯ã€‚ç¤ºä¾‹ï¼š<strong>info CPU</strong></p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379[4]&gt; info Keyspace
<span class="c"># Keyspace</span>
db0:keys<span class="o">=</span>2,expires<span class="o">=</span>0,avg_ttl<span class="o">=</span>0
db1:keys<span class="o">=</span>1,expires<span class="o">=</span>0,avg_ttl<span class="o">=</span>0
db2:keys<span class="o">=</span>3,expires<span class="o">=</span>0,avg_ttl<span class="o">=</span>0
db3:keys<span class="o">=</span>3,expires<span class="o">=</span>0,avg_ttl<span class="o">=</span>0
db4:keys<span class="o">=</span>3,expires<span class="o">=</span>0,avg_ttl<span class="o">=</span>0
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="136-æ¨å‡ºè¿æ¥">1.3.6 æ¨å‡ºè¿æ¥</h4>

<ul>
  <li>ä½¿ç”¨<code class="highlighter-rouge">quit</code>å‘½ä»¤è¡¨ç¤ºæ¨å‡º</li>
</ul>

<h2 id="äºŒredisçš„æŒä¹…åŒ–">äºŒã€<code class="highlighter-rouge">Redis</code>çš„æŒä¹…åŒ–</h2>

<h4 id="21-redis-çš„æŒä¹…åŒ–">2.1 redis çš„æŒä¹…åŒ–</h4>

<p>redis çš„é«˜æ€§èƒ½æ˜¯ç”±äºå…¶å°†æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨äº†å†…å­˜ä¸­ï¼Œä¸ºäº†ä½¿redis åœ¨é‡å¯ä¹‹åä»èƒ½ä¿æŒæ•°æ®ä¸ä¸¢å¤±ï¼Œéœ€è¦å°†æ•°æ®ä»å†…å­˜ä¸­åŒæ­¥åˆ°ç¡¬ç›˜ä¸­ï¼Œè¿™ä¸€è¿‡ç¨‹å°±æ˜¯æŒä¹…åŒ–ã€‚</p>

<p>redis æ”¯æŒä¸¤ç§æ–¹å¼çš„æŒä¹…åŒ–ï¼Œä¸€ç§æ˜¯<code class="highlighter-rouge">RDB</code> æ–¹å¼ï¼Œä¸€ç§æ˜¯<code class="highlighter-rouge">AOF</code>æ–¹å¼ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨å…¶ä¸­ä¸€ç§æˆ–å°†ä¸¤ç§ç»“åˆä½¿ç”¨ã€‚</p>

<h4 id="22-rdb-æŒä¹…åŒ–">2.2 RDB æŒä¹…åŒ–</h4>

<p>RDB æ–¹å¼çš„æŒä¹…åŒ–æ˜¯é€šè¿‡å¿«ç…§ï¼ˆsnapshottingï¼‰å®Œæˆçš„ï¼Œå½“ç¬¦åˆä¸€å®šæ¡ä»¶æ—¶ redis ä¼šè‡ªåŠ¨å°†å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œå¿«ç…§æŒä¹…åŒ–åˆ°ç¡¬ç›˜ã€‚</p>

<p><strong>RDB æ˜¯Redis é»˜è®¤é‡‡ç”¨çš„æŒä¹…åŒ–æ–¹å¼</strong>ï¼Œåœ¨ redis.conf é…ç½®æ–‡ä»¶ä¸­é»˜è®¤æœ‰æ­¤ä¸‹é…ç½®ï¼š</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># saveå¼€å¤´çš„ä¸€è¡Œå°±æ˜¯æŒä¹…åŒ–é…ç½®ï¼Œå¯ä»¥é…ç½®å¤šä¸ªæ¡ä»¶(æ¯è¡Œé…ç½®ä¸€ä¸ªæ¡ä»¶)ï¼Œæ¯ä¸ªæ¡ä»¶ä¹‹é—´æ˜¯"æˆ–"çš„å…³ç³»</span>
<span class="c"># è¡¨ç¤º 15åˆ†é’Ÿ(900ç§’)å†…è‡³å°‘1 ä¸ªé”®è¢«æ›´æ”¹åˆ™è¿›è¡Œå¿«ç…§</span>
save 900 1
<span class="c"># è¡¨ç¤º 5åˆ†é’Ÿ(300ç§’)å†…è‡³å°‘10ä¸ªé”®è¢«ä¿®æ”¹åˆ™è¿›è¡Œå¿«ç…§</span>
save 300 10
<span class="c"># </span>
save 60 10000
</code></pre></div></div>

<p>Redis å¯åŠ¨åä¼šè¯»å– RDB å¿«ç…§æ–‡ä»¶ï¼Œå°†æ•°æ®ä»ç¡¬ç›˜è½½å…¥åˆ°å†…å­˜ä¸­ã€‚æ ¹æ®æ•°æ®é‡å¤§å°ä¸ç»“æ„å’ŒæœåŠ¡æ€§èƒ½ä¸åŒï¼Œè¿™ä¸ªæ—¶é—´ä¹Ÿä¸åŒã€‚é€šå¸¸å°†è®°å½•ä¸€åƒä¸‡ä¸ªå­—ç¬¦ä¸²å‹é”®ã€å¤§å°ä¸º 1GB çš„å¿«ç…§æ–‡ä»¶è½½å…¥åˆ°å†…å­˜ä¸­éœ€è¦èŠ±è´¹ 20ï½ 30ç§’ã€‚</p>

<p>å¦‚æœå¼€å¯äº† RDB ï¼ŒRedis é»˜è®¤ä¼šåœ¨å¯åŠ¨å½“å‰æœåŠ¡çš„ç›®å½•è‡ªåŠ¨åˆ›å»ºæ•°æ®æ–‡ä»¶ã€‚é€šè¿‡ RDB æ–¹å¼å®ç°æŒä¹…åŒ–ï¼Œä¸€æ—¦ redis å¼‚å¸¸é€€å‡ºï¼Œå°±ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§ä»¥åæ›´æ”¹çš„æ‰€æœ‰æ•°æ®ã€‚è¿™å°±éœ€è¦å¼€å‘è€…æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯ï¼Œé€šè¿‡ç»„åˆè®¾ç½®è‡ªåŠ¨å¿«ç…§æ¡ä»¶çš„æ–¹å¼æ¥å°†å¯èƒ½å‘ç”Ÿçš„æ•°æ®æŸå¤±æ§åˆ¶åœ¨èƒ½å¤Ÿæ¥å—çš„èŒƒå›´ã€‚å¦‚æœæ•°æ®å¾ˆé‡è¦ä»¥è‡³äºæ— æ³•æ‰¿å—ä»»ä½•æŸå¤±ï¼Œåˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨ AOF æ–¹å¼è¿›è¡ŒæŒä¹…åŒ–ã€‚</p>

<blockquote>
  <p>æ³¨æ„ï¼šç”±äºå¿«ç…§æ–¹å¼æ˜¯åœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡çš„ï¼Œæ‰€ä»¥å¦‚æœ redis æ„å¤–å½“æœºçš„è¯ï¼Œå°±ä¼š ä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰æ•°æ®ä¿®æ”¹ã€‚</p>
</blockquote>

<h4 id="23-aof-æŒä¹…åŒ–">2.3 AOF æŒä¹…åŒ–</h4>

<p>é»˜è®¤æƒ…å†µä¸‹ redis æ²¡æœ‰å¼€å¯ AOF( append only file) æ–¹å¼çš„æŒä¹…åŒ–ï¼Œå¯ä»¥é€šè¿‡ appendonly å‚æ•°å¼€å¯ï¼š<code class="highlighter-rouge">appendonly yes</code></p>

<p>å¼€å¯ AOF æŒä¹…åŒ–åæ¯æ‰§è¡Œä¸€æ¡ä¼šæ›´æ”¹ Redis ä¸­çš„æ•°æ®çš„å‘½ä»¤ï¼Œ Redis å°±ä¼šå°†è¯¥å‘½ä»¤å†™å…¥ç¡¬ç›˜ä¸­çš„ AOF æ–‡ä»¶ã€‚AOF æ–‡ä»¶çš„ä¿å­˜ä½ç½®å’Œ RDB æ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡ dir å‚æ•°è®¾ç½®çš„ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯<code class="highlighter-rouge">appendonly.aof</code>ï¼Œå¯ä»¥é€šè¿‡ appendfilename å‚æ•°ä¿®æ”¹ï¼š<code class="highlighter-rouge">appendfilename appendonly.aof</code></p>

<p>è¿™ç§æ—¥å¿—è¿½åŠ æ–¹å¼ redis ä¼šå°†æ¯ä¸€ä¸ªæ”¶åˆ°çš„å†™å‘½ä»¤éƒ½é€šè¿‡ write å‡½æ•°è¿½åŠ åˆ°æ–‡ä»¶ä¸­(é»˜è®¤appendonly.aof)ã€‚å½“redis é‡å¯æ—¶ä¼šé€šè¿‡é‡æ–°æ‰§è¡Œæ–‡ä»¶ä¸­ä¿å­˜çš„å†™å‘½ä»¤æ¥åœ¨å†…å­˜ä¸­é‡å»ºæ•´ä¸ªæ•°æ®åº“çš„å†…å®¹ã€‚å½“ç„¶ç”±äºæ“ä½œç³»ç»Ÿä¼šåœ¨å†…æ ¸ä¸­ç¼“å­˜ write åšè¿‡çš„ä¿®æ”¹ï¼Œæ‰€ä»¥å¯èƒ½ä¸æ˜¯ç«‹å³å†™åˆ°ç£ç›˜ä¸Šã€‚è¿™æ ·çš„æŒä¹…æŠ¤é¢è¿˜æ˜¯æœ‰å¯èƒ½ä¼šä¸¢å¤±éƒ¨åˆ†ä¿®æ”¹ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å‘Šè¯‰ redis æˆ‘ä»¬æƒ³è¦é€šè¿‡<code class="highlighter-rouge">fsync</code>å‡½æ•°å¼ºåˆ¶æ“ä½œç³»ç»Ÿå†™å…¥åˆ°ç£ç›˜çš„æ—¶æœºã€‚æœ‰ä¸‰ç§æ–¹å¼å¦‚ä¸‹ï¼š(é»˜è®¤æ˜¯ï¼šæ¯ç§’ fsync ä¸€æ¬¡)</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c"># å¯ç”¨æ—¥å¿—è¿½åŠ æŒä¹…åŒ–æ–¹å¼</span>
appendonly <span class="nb">yes</span>

<span class="c"># æ¯æ¬¡æ”¶åˆ°å†™å‘½ä»¤å°±ç«‹å³å¼ºåˆ¶å†™å…¥ç£ç›˜ï¼Œæœ€æ…¢çš„ï¼Œä½†æ˜¯ä¿è¯å®Œå…¨ çš„æŒä¹…åŒ–ï¼Œä¸æ¨èä½¿ç”¨</span>
<span class="c"># appendfsync always</span>
<span class="c"># æ¯ç§’é’Ÿå¼ºåˆ¶å†™å…¥ç£ç›˜ä¸€æ¬¡ï¼Œåœ¨æ€§èƒ½å’ŒæŒä¹…åŒ–æ–¹é¢åšäº†å¾ˆå¥½çš„æŠ˜ ä¸­ï¼Œæ¨è</span>
appendfsync everysec
<span class="c"># å®Œå…¨ä¾èµ–æ“ä½œç³»ç»Ÿï¼Œæ€§èƒ½æœ€å¥½,æŒä¹…åŒ–æ²¡ä¿è¯</span>
<span class="c">#appendfsync no</span>
</code></pre></div></div>

<p>ä½¿ç”¨ AOF æ–¹å¼åŒæ—¶å¸¦æ¥å¦ä¸€ä¸ªé—®é¢˜ï¼šæŒä¹…åŒ–æ–‡ä»¶ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ã€‚ä¾‹å¦‚æˆ‘ä»¬è°ƒç”¨ incr test å‘½ä»¤ 100æ¬¡ï¼Œæ–‡ä»¶ä¸­å¿…é¡»å…¨éƒ¨ä¿å­˜ 100 æ¡å‘½ä»¤ï¼Œå…¶å®æœ‰ 99æ¡ éƒ½æ˜¯å¤šä½™çš„ã€‚å› ä¸ºè¦æ¢å¤æ•°æ®åº“çŠ¶æ€å…¶å®æ–‡ä»¶ä¸­ä¿å­˜ä¸€æ¡ set test 100 å°±å¤Ÿäº†ã€‚ä¸ºäº†å‹ç¼©è¿™ç§æŒä¹…åŒ–æ–¹å¼çš„æ—¥å¿—æ–‡ä»¶ï¼Œredis æä¾›äº†<code class="highlighter-rouge">bgrewriteaof</code>å‘½ä»¤ã€‚æ”¶åˆ°æ­¤å‘½ä»¤ redis å°†ä½¿ç”¨ä¸å¿«ç…§ç±»ä¼¼çš„æ–¹å¼å°†å†…å­˜ä¸­çš„æ•°æ®ä»¥å‘½ä»¤çš„æ–¹å¼ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œæœ€åæ›¿æ¢åŸæ¥çš„æŒä¹…åŒ–æ—¥å¿—æ–‡ä»¶ã€‚</p>
:ET