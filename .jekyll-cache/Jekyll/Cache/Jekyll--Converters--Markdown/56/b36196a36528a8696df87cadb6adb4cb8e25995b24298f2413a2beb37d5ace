I"ÿu<h2 id="å‰è¨€">å‰è¨€</h2>

<p>æœ€è¿‘æœ‰ç‚¹æ—¶é—´ï¼Œå°±æƒ³æŠŠç½‘ç›˜ä¸­æ”¶è—çš„ä¸€ä¸ªå¤§å‹é¡¹ç›®å®ç°ä¸€ä¸‹ï¼Œé¡¹ç›®ä¸­æ¶‰åŠåˆ°å›¾ç‰‡çš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œä½¿ç”¨çš„æ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ<code class="highlighter-rouge">FastDFS</code>ã€‚è€Œ<code class="highlighter-rouge">FastDFS</code>å›¾ç‰‡æœåŠ¡å™¨éœ€è¦å’Œ<code class="highlighter-rouge">Nginx</code>æ•´åˆåæ‰èƒ½æä¾›åŸºäº HTTPåè®®çš„ä¸‹è½½ç­‰åŠŸèƒ½ï¼Œæ‰€ä»¥æ­å»º<code class="highlighter-rouge">FastDFS</code>ä¹‹å‰å¾—éœ€è¦ç®€å•çš„äº†è§£ä¸€ä¸‹<code class="highlighter-rouge">Nginx</code>ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ç¯‡<code class="highlighter-rouge">Blog</code>ï¼ŒåæœŸä¼šç»§ç»­æ·±å…¥å­¦ä¹ <code class="highlighter-rouge">Nginx</code>ï¼Œæ‰€ä»¥è¿™ç¯‡åšå®¢å°±ç®€å•çš„ä»‹ç»ä¸€ä¸‹<code class="highlighter-rouge">Nginx</code>åŠå…¶å®‰è£…è¿‡ç¨‹ã€‚</p>

<h2 id="ä¸€nginx-åˆè¯†">ä¸€ã€Nginx åˆè¯†</h2>

<h3 id="11-ä»€ä¹ˆæ˜¯nginx">1.1 ä»€ä¹ˆæ˜¯Nginx</h3>

<p>Nginx æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„ http æœåŠ¡å™¨/åå‘ä»£ç†æœåŠ¡å™¨åŠç”µå­é‚®ä»¶ï¼ˆIMAP/POP3ï¼‰ä»£ç†æœåŠ¡å™¨ã€‚ ç”±ä¿„ç½—æ–¯çš„ç¨‹åºè®¾è®¡å¸ˆ Igor Sysoev æ‰€å¼€å‘ï¼Œå®˜æ–¹æµ‹è¯• nginx èƒ½å¤Ÿæ”¯æ”¯æ’‘ 5 ä¸‡å¹¶å‘é“¾æ¥ï¼Œå¹¶ ä¸” cpuã€å†…å­˜ç­‰èµ„æºæ¶ˆè€—å´éå¸¸ä½ï¼Œè¿è¡Œéå¸¸ç¨³å®šã€‚</p>

<h3 id="12-åº”ç”¨åœºæ™¯">1.2 åº”ç”¨åœºæ™¯</h3>

<ol>
  <li>http æœåŠ¡å™¨ã€‚Nginx æ˜¯ä¸€ä¸ª http æœåŠ¡å¯ä»¥ç‹¬ç«‹æä¾› http æœåŠ¡ã€‚å¯ä»¥åšç½‘é¡µé™æ€æœåŠ¡å™¨ã€‚</li>
  <li>è™šæ‹Ÿä¸»æœºã€‚å¯ä»¥å®ç°åœ¨ä¸€å°æœåŠ¡å™¨è™šæ‹Ÿå‡ºå¤šä¸ªç½‘ç«™ã€‚ä¾‹å¦‚ä¸ªäººç½‘ç«™ä½¿ç”¨çš„è™šæ‹Ÿä¸»æœºã€‚</li>
  <li>åå‘ä»£ç†ï¼Œè´Ÿè½½å‡è¡¡ã€‚å½“ç½‘ç«™çš„è®¿é—®é‡è¾¾åˆ°ä¸€å®šç¨‹åº¦åï¼Œå•å°æœåŠ¡å™¨ä¸èƒ½æ»¡è¶³ç”¨æˆ·çš„è¯· æ±‚æ—¶ï¼Œéœ€è¦ç”¨å¤šå°æœåŠ¡å™¨é›†ç¾¤å¯ä»¥ä½¿ç”¨ nginx åšåå‘ä»£ç†ã€‚å¹¶ä¸”å¤šå°æœåŠ¡å™¨å¯ä»¥å¹³å‡åˆ†æ‹…è´Ÿè½½ï¼Œä¸ä¼šå› ä¸ºæŸå°æœåŠ¡å™¨è´Ÿè½½é«˜å®•æœºè€ŒæŸå°æœåŠ¡å™¨é—²ç½®çš„æƒ…å†µã€‚</li>
</ol>

<h3 id="13-nginx-å®‰è£…">1.3 Nginx å®‰è£…</h3>

<h4 id="131-windowsç¯å¢ƒçš„å®‰è£…">1.3.1 Windowsç¯å¢ƒçš„å®‰è£…</h4>

<ol>
  <li>ä¸‹è½½ nginxï¼š<a href="http://nginx.org/en/download.html">å®˜æ–¹ç½‘ç«™</a></li>
  <li>å°†zipæ–‡ä»¶åŠ å‹åˆ°è‡ªå®šä¹‰ç›®å½•ä¸‹å³å¯ã€‚</li>
  <li>åŠ å‹æ–‡ä»¶åçš„ä¸»è¦ç›®å½•è¯´æ˜ï¼š
    <ul>
      <li>confç›®å½•ï¼šå­˜æ”¾Nginxçš„ä¸»è¦é…ç½®æ–‡ä»¶ï¼Œå¾ˆå¤šåŠŸèƒ½å®ç°éƒ½æ˜¯é€šè¿‡é…ç½®è¯¥ç›®å½•ä¸‹çš„nginx.confæ–‡ä»¶</li>
      <li>docsç›®å½•ï¼šå­˜æ”¾NginxæœåŠ¡å™¨çš„ä¸»è¦æ–‡æ¡£èµ„æ–™ï¼ŒåŒ…æ‹¬NginxæœåŠ¡å™¨çš„LICENSEã€OpenSSLçš„LICENSEã€PCREçš„LICENSEä»¥åŠzlibçš„LICENSEï¼Œè¿˜åŒ…æ‹¬æœ¬ç‰ˆæœ¬çš„NginxæœåŠ¡å™¨å‡çº§çš„ç‰ˆæœ¬å˜æ›´è¯´æ˜ï¼Œä»¥åŠREADMEæ–‡æ¡£ã€‚</li>
      <li>htmlç›®å½•ï¼šå­˜æ”¾äº†ä¸¤ä¸ªåç¼€åä¸º.htmlçš„é™æ€ç½‘é¡µæ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶ä¸NginxæœåŠ¡å™¨çš„è¿è¡Œç›¸å…³</li>
      <li>logsç›®å½•ï¼šå­˜æ”¾NginxæœåŠ¡å™¨è¿è¡Œçš„æ—¥å¿—æ–‡ä»¶</li>
      <li>nginx.exeï¼šå¯åŠ¨NginxæœåŠ¡å™¨çš„exeæ–‡ä»¶ï¼Œå¦‚æœconfç›®å½•ä¸‹çš„nginx.confæ–‡ä»¶é…ç½®æ­£ç¡®çš„è¯ï¼Œé€šè¿‡è¯¥æ–‡ä»¶å³å¯å¯åŠ¨NginxæœåŠ¡å™¨</li>
    </ul>
  </li>
  <li>å¯åŠ¨è¿è¡Œ
    <ul>
      <li>åŒå‡»åŠ å‹åçš„æ–‡ä»¶ä¸­çš„nginx.exeæ–‡ä»¶ï¼Œå‡ºç°ä¸€é—ªè€Œè¿‡çš„ç”»é¢ï¼Œåˆ™å¯åŠ¨æˆåŠŸ</li>
      <li>ç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥ http://localhostæˆ–è€… http://localhost:80 ä¼šå‡ºç°å¯åŠ¨æˆåŠŸçš„ç”»é¢</li>
    </ul>
  </li>
</ol>

<h4 id="132-linuxç¯å¢ƒçš„å®‰è£…">1.3.2 Linuxç¯å¢ƒçš„å®‰è£…</h4>

<ol>
  <li>
    <p>å®‰è£…ç¯å¢ƒè¦æ±‚</p>

    <ol>
      <li>
        <p>éœ€è¦å®‰è£… gcc çš„ç¯å¢ƒ</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>yum <span class="nb">install </span>gcc-c++
</code></pre></div>        </div>
      </li>
      <li>
        <p>ç¬¬ä¸‰æ–¹çš„å¼€å‘åŒ…</p>

        <ul>
          <li>
            <p><strong>PCRE(Perl Compatible Regular Expressions)</strong> æ˜¯ä¸€ä¸ª Perl åº“ï¼ŒåŒ…æ‹¬ perl å…¼å®¹çš„æ­£åˆ™è¡¨è¾¾å¼ åº“ã€‚nginx çš„ http æ¨¡å—ä½¿ç”¨ pcre æ¥è§£ææ­£åˆ™è¡¨è¾¾å¼ï¼Œæ‰€ä»¥éœ€è¦åœ¨ linux ä¸Šå®‰è£… pc re åº“ã€‚</p>

            <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>yum <span class="nb">install</span> <span class="nt">-y</span> pcre pcre-devel
</code></pre></div>            </div>
          </li>
          <li>
            <p><strong>zlib</strong> åº“æä¾›äº†å¾ˆå¤šç§å‹ç¼©å’Œè§£å‹ç¼©çš„æ–¹å¼ï¼Œnginx ä½¿ç”¨ zlib å¯¹ http åŒ…çš„å†…å®¹è¿›è¡Œ gzipï¼Œ æ‰€ä»¥éœ€è¦åœ¨ linux ä¸Šå®‰è£… zlib åº“ã€‚</p>

            <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>yum <span class="nb">install</span> <span class="nt">-y</span> zlib zlib-devel
</code></pre></div>            </div>
          </li>
          <li>
            <p><strong>OpenSSL</strong>æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å®‰å…¨å¥—æ¥å­—å±‚å¯†ç åº“ï¼Œå›Šæ‹¬ä¸»è¦çš„å¯†ç ç®—æ³•ã€å¸¸ç”¨çš„å¯†é’¥å’Œè¯ ä¹¦å°è£…ç®¡ç†åŠŸèƒ½åŠ SSL åè®®ï¼Œå¹¶æä¾›ä¸°å¯Œçš„åº”ç”¨ç¨‹åºä¾›æµ‹è¯•æˆ–å…¶å®ƒç›®çš„ä½¿ç”¨ã€‚ nginx ä¸ä»…æ”¯æŒ http åè®®ï¼Œè¿˜æ”¯æŒ https ï¼ˆå³åœ¨ ssl åè®®ä¸Šä¼ è¾“ httpï¼‰ï¼Œæ‰€ä»¥éœ€è¦åœ¨ linux å®‰è£… openssl åº“ã€‚</p>

            <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>yum <span class="nb">install</span> <span class="nt">-y</span> openssl openssl-devel
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
    </ol>
  </li>
  <li>
    <p>å®‰è£…æ­¥éª¤</p>

    <ol>
      <li>
        <p>æŠŠ nginx çš„æºç åŒ…ä¸Šä¼ åˆ° linux ç³»ç»Ÿ</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rz nginx-1.8.0.tar.gz
</code></pre></div>        </div>
      </li>
      <li>
        <p>å®‰è£…ç¼–è¯‘</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-zxvf</span> nginx-1.8.0.tar.gz
<span class="nv">$ </span><span class="nb">cd </span>nginx-1.8.0
</code></pre></div>        </div>

        <ol>
          <li>
            <p>configure</p>

            <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ./configure --helpæŸ¥è¯¢è¯¦ç»†å‚æ•°ï¼ˆå‚è€ƒæœ¬æ•™ç¨‹é™„å½•éƒ¨åˆ†ï¼šnginxç¼–è¯‘å‚æ•°ï¼‰</span>
<span class="c"># è¿›å…¥ nginx ç›®å½•ä½¿ç”¨ configure å‘½ä»¤åˆ›å»ºä¸€ makeFile æ–‡ä»¶ã€‚</span>
<span class="c"># å‚æ•°è®¾ç½®å¦‚ä¸‹ï¼š</span>
<span class="nv">$ </span>./configure <span class="se">\</span>
<span class="nt">--prefix</span><span class="o">=</span>/usr/local/nginx <span class="se">\</span>
<span class="nt">--pid-path</span><span class="o">=</span>/var/run/nginx/nginx.pid <span class="se">\</span>
<span class="nt">--lock-path</span><span class="o">=</span>/var/lock/nginx.lock <span class="se">\</span>
<span class="nt">--error-log-path</span><span class="o">=</span>/var/log/nginx/error.log <span class="se">\</span>
<span class="nt">--http-log-path</span><span class="o">=</span>/var/log/nginx/access.log <span class="se">\</span>
<span class="nt">--with-http_gzip_static_module</span> <span class="se">\</span>
<span class="nt">--http-client-body-temp-path</span><span class="o">=</span>/var/temp/nginx/client <span class="se">\</span>
<span class="nt">--http-proxy-temp-path</span><span class="o">=</span>/var/temp/nginx/proxy <span class="se">\</span>
<span class="nt">--http-fastcgi-temp-path</span><span class="o">=</span>/var/temp/nginx/fastcgi <span class="se">\</span>
<span class="nt">--http-uwsgi-temp-path</span><span class="o">=</span>/var/temp/nginx/uwsgi <span class="se">\</span>
<span class="nt">--http-scgi-temp-path</span><span class="o">=</span>/var/temp/nginx/scgi
</code></pre></div>            </div>

            <blockquote>
              <p>æ³¨æ„ï¼šä¸Šè¾¹å°†ä¸´æ—¶æ–‡ä»¶ç›®å½•æŒ‡å®šä¸º<code class="highlighter-rouge">/var/temp/nginx</code>ï¼Œéœ€è¦åœ¨<code class="highlighter-rouge">/var</code>ä¸‹åˆ›å»º<code class="highlighter-rouge">temp</code>åŠ<code class="highlighter-rouge">nginx</code>ç›®å½•</p>

              <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir</span> /var/temp/nginx/client â€“p
</code></pre></div>              </div>
            </blockquote>
          </li>
          <li>
            <p>ç¼–è¯‘å®‰è£…</p>

            <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make
<span class="nv">$ </span>make  <span class="nb">install</span>
</code></pre></div>            </div>

            <p>å®‰è£…æˆåŠŸæŸ¥çœ‹å®‰è£…ç›®å½• ï¼š</p>

            <p><img src="/img/images/nginx/01-å®‰è£…æˆåŠŸåçš„ç›®å½•.png" /></p>
          </li>
        </ol>
      </li>
    </ol>
  </li>
  <li>
    <p>å¯åŠ¨ Nginx</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /usr/local/nginx/sbin/
<span class="nv">$ </span>./nginx
   
<span class="c"># åœæ­¢ nginx</span>
<span class="c"># æ–¹å¼ä¸€ï¼šæ­¤æ–¹å¼ç›¸å½“äºå…ˆæŸ¥å‡ºnginxè¿›ç¨‹idå†ä½¿ç”¨killå‘½ä»¤å¼ºåˆ¶æ€æ‰è¿›ç¨‹</span>
<span class="nv">$ </span>./nginx <span class="nt">-s</span> stop 
<span class="c"># æ–¹å¼äºŒï¼šæ­¤æ–¹å¼åœæ­¢æ­¥éª¤æ˜¯å¾…nginxè¿›ç¨‹å¤„ç†ä»»åŠ¡å®Œæ¯•è¿›è¡Œåœæ­¢ã€‚</span>
<span class="nv">$ </span>./nginx <span class="nt">-s</span> quit
   
<span class="c"># é‡å¯ nginx</span>
<span class="c"># æ–¹å¼ä¸€ï¼šå…ˆåœæ­¢ä»”å¯åŠ¨(å»ºè®®ä½¿ç”¨)</span>
<span class="c"># å³ï¼šå¯¹nginxè¿›è¡Œé‡å¯ç›¸å½“äºå…ˆåœæ­¢nginxå†å¯åŠ¨nginxï¼Œå³å…ˆæ‰§è¡Œåœæ­¢å‘½ä»¤å†æ‰§è¡Œå¯åŠ¨å‘½ä»¤ã€‚</span>
<span class="nv">$ </span>./nginx <span class="nt">-s</span> quit
<span class="nv">$ </span>./nginx
<span class="c"># æ–¹å¼äºŒï¼šé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span>
<span class="c"># å³ï¼šå½“nginxçš„é…ç½®æ–‡ä»¶nginx.confä¿®æ”¹åï¼Œè¦æƒ³è®©é…ç½®ç”Ÿæ•ˆéœ€è¦é‡å¯nginxï¼Œä½¿ç”¨-s reloadä¸ç”¨å…ˆåœæ­¢nginxå†å¯åŠ¨nginxå³å¯å°†é…ç½®ä¿¡æ¯åœ¨nginxä¸­ç”Ÿæ•ˆ</span>
<span class="nv">$ </span>./nginx <span class="nt">-s</span> reload
</code></pre></div>    </div>

    <blockquote>
      <p>æ³¨æ„ï¼šæ‰§è¡Œ<code class="highlighter-rouge">./nginx</code>å¯åŠ¨<code class="highlighter-rouge">nginx</code>ï¼Œè¿™é‡Œå¯ä»¥<code class="highlighter-rouge">-c</code>æŒ‡å®šåŠ è½½çš„<code class="highlighter-rouge">nginx</code>é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š<code class="highlighter-rouge">./nginx -c /usr/local/nginx/conf/nginx.conf</code>ã€‚å¦‚æœä¸æŒ‡å®š<code class="highlighter-rouge">-c</code>ï¼Œnginxåœ¨å¯åŠ¨æ—¶é»˜è®¤åŠ è½½<code class="highlighter-rouge">conf/nginx.conf</code>æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶çš„åœ°å€ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘å®‰è£…<code class="highlighter-rouge">nginx</code>æ—¶æŒ‡å®š<code class="highlighter-rouge">./configure</code>çš„å‚æ•°(<code class="highlighter-rouge">--conf-path=</code> **æŒ‡å‘é…ç½®æ–‡ä»¶<code class="highlighter-rouge">nginx.conf</code>)</p>
    </blockquote>
  </li>
  <li>
    <p>è®¿é—® Nginx</p>

    <p>nginxå®‰è£…æˆåŠŸï¼Œå¯åŠ¨nginxï¼Œå³å¯è®¿é—®è™šæ‹Ÿæœºä¸Šçš„nginxï¼›<code class="highlighter-rouge">192.168.30.201:80</code></p>
  </li>
  <li>
    <p>å¼€æœºè‡ªå¯åŠ¨ nginx</p>

    <ol>
      <li>
        <p>ç¼–å†™ shell è„šæœ¬</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim /etc/init.d/nginx
<span class="c">## è„šæœ¬ä»£ç </span>
<span class="c">#!/bin/bash</span>
<span class="c"># nginx Startup script for the Nginx HTTP Server</span>
<span class="c"># it is v.0.0.2 version.</span>
<span class="c"># chkconfig: - 85 15</span>
<span class="c"># description: Nginx is a high-performance web and proxy server.</span>
<span class="c">#              It has a lot of features, but it's not for everyone.</span>
<span class="c"># processname: nginx</span>
<span class="c"># pidfile: /var/run/nginx.pid</span>
<span class="c"># config: /usr/local/nginx/conf/nginx.conf</span>
<span class="nv">nginxd</span><span class="o">=</span>/usr/local/nginx/sbin/nginx
<span class="nv">nginx_config</span><span class="o">=</span>/usr/local/nginx/conf/nginx.conf
<span class="nv">nginx_pid</span><span class="o">=</span>/var/run/nginx.pid
<span class="nv">RETVAL</span><span class="o">=</span>0
<span class="nv">prog</span><span class="o">=</span><span class="s2">"nginx"</span>
<span class="c"># Source function library.</span>
<span class="nb">.</span> /etc/rc.d/init.d/functions
<span class="c"># Source networking configuration.</span>
<span class="nb">.</span> /etc/sysconfig/network
<span class="c"># Check that networking is up.</span>
<span class="o">[</span> <span class="k">${</span><span class="nv">NETWORKING</span><span class="k">}</span> <span class="o">=</span> <span class="s2">"no"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">exit </span>0
<span class="o">[</span> <span class="nt">-x</span> <span class="nv">$nginxd</span> <span class="o">]</span> <span class="o">||</span> <span class="nb">exit </span>0
<span class="c"># Start nginx daemons functions.</span>
start<span class="o">()</span> <span class="o">{</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-e</span> <span class="nv">$nginx_pid</span> <span class="o">]</span><span class="p">;</span><span class="k">then
   </span><span class="nb">echo</span> <span class="s2">"nginx already running...."</span>
   <span class="nb">exit </span>1
<span class="k">fi
   </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">$"Starting </span><span class="nv">$prog</span><span class="s2">: "</span>
   daemon <span class="nv">$nginxd</span> <span class="nt">-c</span> <span class="k">${</span><span class="nv">nginx_config</span><span class="k">}</span>
   <span class="nv">RETVAL</span><span class="o">=</span><span class="nv">$?</span>
   <span class="nb">echo</span>
   <span class="o">[</span> <span class="nv">$RETVAL</span> <span class="o">=</span> 0 <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">touch</span> /var/lock/subsys/nginx
   <span class="k">return</span> <span class="nv">$RETVAL</span>
<span class="o">}</span>
<span class="c"># Stop nginx daemons functions.</span>
stop<span class="o">()</span> <span class="o">{</span>
        <span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">$"Stopping </span><span class="nv">$prog</span><span class="s2">: "</span>
        killproc <span class="nv">$nginxd</span>
        <span class="nv">RETVAL</span><span class="o">=</span><span class="nv">$?</span>
        <span class="nb">echo</span>
        <span class="o">[</span> <span class="nv">$RETVAL</span> <span class="o">=</span> 0 <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-f</span> /var/lock/subsys/nginx /var/run/nginx.pid
<span class="o">}</span>
<span class="c"># reload nginx service functions.</span>
reload<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">$"Reloading </span><span class="nv">$prog</span><span class="s2">: "</span>
    <span class="c">#kill -HUP `cat ${nginx_pid}`</span>
    killproc <span class="nv">$nginxd</span> <span class="nt">-HUP</span>
    <span class="nv">RETVAL</span><span class="o">=</span><span class="nv">$?</span>
    <span class="nb">echo</span>
<span class="o">}</span>
<span class="c"># See how we were called.</span>
<span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in
</span>start<span class="p">)</span>
        start
        <span class="p">;;</span>
stop<span class="p">)</span>
        stop
        <span class="p">;;</span>
reload<span class="p">)</span>
        reload
        <span class="p">;;</span>
restart<span class="p">)</span>
        stop
        start
        <span class="p">;;</span>
status<span class="p">)</span>
        status <span class="nv">$prog</span>
        <span class="nv">RETVAL</span><span class="o">=</span><span class="nv">$?</span>
        <span class="p">;;</span>
<span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">$"Usage: </span><span class="nv">$prog</span><span class="s2"> {start|stop|restart|reload|status|help}"</span>
        <span class="nb">exit </span>1
<span class="k">esac
</span><span class="nb">exit</span> <span class="nv">$RETVAL</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>è®¾ç½®æ–‡ä»¶çš„è®¿é—®æƒé™</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># a+x ==&gt; all user can execute  æ‰€æœ‰ç”¨æˆ·å¯æ‰§è¡Œ</span>
<span class="nv">$ </span><span class="nb">chmod </span>a+x /etc/init.d/nginx 
<span class="nv">$ </span>/etc/init.d/nginx status|start|stop|restart
</code></pre></div>        </div>
      </li>
      <li>
        <p>åŠ å…¥åˆ° <code class="highlighter-rouge">rc.local</code>æ–‡ä»¶ä¸­</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim /etc/rc.local
<span class="c"># åŠ å…¥ä¸€è¡Œ  /etc/init.d/nginx start    ä¿å­˜å¹¶é€€å‡ºï¼Œä¸‹æ¬¡é‡å¯ä¼šç”Ÿæ•ˆã€‚</span>
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ol>

<h3 id="14-é…ç½®è™šæ‹Ÿä¸»æœº">1.4 é…ç½®è™šæ‹Ÿä¸»æœº</h3>

<p>å°±æ˜¯åœ¨ä¸€å°æœåŠ¡å™¨å¯åŠ¨å¤šä¸ªç½‘ç«™ã€‚å¦‚ä½•åŒºåˆ†ä¸åŒçš„ç½‘ç«™ï¼šåŸŸåä¸åŒã€ç«¯å£ä¸åŒ</p>

<h4 id="141-é€šè¿‡ç«¯å£åŒºåˆ†ä¸åŒè™šæ‹Ÿæœº">1.4.1 é€šè¿‡ç«¯å£åŒºåˆ†ä¸åŒè™šæ‹Ÿæœº</h4>

<p>Nginx çš„é…ç½®æ–‡ä»¶ï¼š /usr/local/nginx/conf/nginx.conf</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#user  nobody;</span>
worker_processes  1<span class="p">;</span>

<span class="c">#error_log  logs/error.log;</span>
<span class="c">#error_log  logs/error.log  notice;</span>
<span class="c">#error_log  logs/error.log  info;</span>

<span class="c">#pid        logs/nginx.pid;</span>


events <span class="o">{</span>
    worker_connections  1024<span class="p">;</span>
<span class="o">}</span>


http <span class="o">{</span>
    include       mime.types<span class="p">;</span>
    default_type  application/octet-stream<span class="p">;</span>

    <span class="c">#log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span>
    <span class="c">#                  '$status $body_bytes_sent "$http_referer" '</span>
    <span class="c">#                  '"$http_user_agent" "$http_x_forwarded_for"';</span>

    <span class="c">#access_log  logs/access.log  main;</span>

    sendfile        on<span class="p">;</span>
    <span class="c">#tcp_nopush     on;</span>

    <span class="c">#keepalive_timeout  0;</span>
    keepalive_timeout  65<span class="p">;</span>

    <span class="c">#gzip  on;</span>

    server <span class="o">{</span>
        listen       80<span class="p">;</span>
        server_name  localhost<span class="p">;</span>

        <span class="c">#charset koi8-r;</span>

        <span class="c">#access_log  logs/host.access.log  main;</span>

        location / <span class="o">{</span>
            root   html<span class="p">;</span>
            index  index.html index.htm<span class="p">;</span>
        <span class="o">}</span>

        <span class="c">#error_page  404              /404.html;</span>

        <span class="c"># redirect server error pages to the static page /50x.html</span>
        <span class="c">#</span>
        error_page   500 502 503 504  /50x.html<span class="p">;</span>
        location <span class="o">=</span> /50x.html <span class="o">{</span>
            root   html<span class="p">;</span>
        <span class="o">}</span>

        <span class="c"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span>
        <span class="c">#</span>
        <span class="c">#location ~ \.php$ {</span>
        <span class="c">#    proxy_pass   http://127.0.0.1;</span>
        <span class="c">#}</span>

        <span class="c"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span>
        <span class="c">#</span>
        <span class="c">#location ~ \.php$ {</span>
        <span class="c">#    root           html;</span>
        <span class="c">#    fastcgi_pass   127.0.0.1:9000;</span>
        <span class="c">#    fastcgi_index  index.php;</span>
        <span class="c">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span>
        <span class="c">#    include        fastcgi_params;</span>
        <span class="c">#}</span>

        <span class="c"># deny access to .htaccess files, if Apache's document root</span>
        <span class="c"># concurs with nginx's one</span>
        <span class="c">#</span>
        <span class="c">#location ~ /\.ht {</span>
        <span class="c">#    deny  all;</span>
        <span class="c">#}</span>
    <span class="o">}</span>


    <span class="c"># another virtual host using mix of IP-, name-, and port-based configuration</span>
    <span class="c">#</span>
    <span class="c">#server {</span>
    <span class="c">#    listen       8000;</span>
    <span class="c">#    listen       somename:8080;</span>
    <span class="c">#    server_name  somename  alias  another.alias;</span>

    <span class="c">#    location / {</span>
    <span class="c">#        root   html;</span>
    <span class="c">#        index  index.html index.htm;</span>
    <span class="c">#    }</span>
    <span class="c">#}</span>


    <span class="c"># HTTPS server</span>
    <span class="c">#</span>
    <span class="c">#server {</span>
    <span class="c">#    listen       443 ssl;</span>
    <span class="c">#    server_name  localhost;</span>

    <span class="c">#    ssl_certificate      cert.pem;</span>
    <span class="c">#    ssl_certificate_key  cert.key;</span>

    <span class="c">#    ssl_session_cache    shared:SSL:1m;</span>
    <span class="c">#    ssl_session_timeout  5m;</span>

    <span class="c">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span>
    <span class="c">#    ssl_prefer_server_ciphers  on;</span>

    <span class="c">#    location / {</span>
    <span class="c">#        root   html;</span>
    <span class="c">#        index  index.html index.htm;</span>
    <span class="c">#    }</span>
    <span class="c">#}</span>

<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>ä¸€ä¸ª server èŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œå¯ä»¥é…ç½®å¤šä¸ª serverï¼Œé…ç½®äº†å¤šä¸ªè™šæ‹Ÿä¸»æœºã€‚</p>
</blockquote>

<ul>
  <li>
    <p>æ·»åŠ è™šæ‹Ÿä¸»æœºï¼š</p>

    <ol>
      <li>
        <p>å¤åˆ¶ä¸€ä»½ html æ–‡ä»¶å¤¹</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-r</span> html html81
</code></pre></div>        </div>
      </li>
      <li>
        <p>ä¿®æ”¹ html81 ä¸­çš„ index.html</p>
      </li>
      <li>
        <p>ä¿®æ”¹ nginx çš„é…ç½®æ–‡ nginx.conf ä»¶å¦‚ä¸‹:</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>worker_processes  1<span class="p">;</span>
events <span class="o">{</span>
    worker_connections  1024<span class="p">;</span>
<span class="o">}</span>
     
     
http <span class="o">{</span>
    include       mime.types<span class="p">;</span>
    default_type  application/octet-stream<span class="p">;</span>
     
    sendfile        on<span class="p">;</span>
         
    keepalive_timeout  65<span class="p">;</span>
     
    server <span class="o">{</span>
        listen       80<span class="p">;</span>
        server_name  localhost<span class="p">;</span>
     
        location / <span class="o">{</span>
            root   html<span class="p">;</span>
            index  index.html index.htm<span class="p">;</span>
        <span class="o">}</span>
     
        error_page   500 502 503 504  /50x.html<span class="p">;</span>
        location <span class="o">=</span> /50x.html <span class="o">{</span>
            root   html<span class="p">;</span>
        <span class="o">}</span>
     
    <span class="o">}</span>
         
    <span class="c"># ä¸€ä¸ª server èŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿä¸»æœº</span>
    server <span class="o">{</span>
        listen       81<span class="p">;</span>
        server_name  localhost<span class="p">;</span>
     
        location / <span class="o">{</span>
            root   html81<span class="p">;</span>
            index  index.html index.htm<span class="p">;</span>
        <span class="o">}</span>
     
    <span class="o">}</span>
     
<span class="o">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>sbin/nginx <span class="nt">-s</span> reload
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ul>

<h4 id="142-é€šè¿‡åŸŸååŒºåˆ†è™šæ‹Ÿä¸»æœº">1.4.2 é€šè¿‡åŸŸååŒºåˆ†è™šæ‹Ÿä¸»æœº</h4>

<ul>
  <li>
    <p>åŸŸåå°±æ˜¯ç½‘ç«™ã€‚</p>

    <pre><code class="language-txt">www.baidu.com
www.taobao.com
www.jd.com
</code></pre>
  </li>
  <li>
    <p>Dns æœåŠ¡å™¨ï¼šæŠŠåŸŸåè§£æä¸º ip åœ°å€ã€‚ä¿å­˜çš„å°±æ˜¯åŸŸåå’Œ ip çš„æ˜ å°„å…³ç³»ã€‚</p>

    <pre><code class="language-txt"># ä¸€çº§åŸŸåï¼š 
		Baidu.com
		Taobao.com
		Jd.com
# äºŒçº§åŸŸåï¼š 
    www.baidu.com
		Image.baidu.com
		Item.baidu.com
# ä¸‰çº§åŸŸåï¼š 
		1.Image.baidu.com
		Aaa.image.baidu.com
</code></pre>

    <blockquote>
      <p>ä¸€ä¸ªåŸŸåå¯¹åº”ä¸€ä¸ª ip åœ°å€ï¼Œä¸€ä¸ª ip åœ°å€å¯ä»¥è¢«å¤šä¸ªåŸŸåç»‘å®šã€‚</p>
    </blockquote>
  </li>
</ul>

<h3 id="15-åå‘ä»£ç†">1.5 åå‘ä»£ç†</h3>

<h4 id="151-åå‘ä»£ç†">1.5.1 åå‘ä»£ç†</h4>

<ul>
  <li>
    <p>æ­£å‘ä»£ç†æ˜¯åœ¨ç”¨æˆ·ç«¯ã€‚æ¯”å¦‚éœ€è¦è®¿é—®å›½å¤–çš„ç½‘ç«™ï¼Œå°±éœ€è¦VPNæœåŠ¡å™¨å°†æˆ‘ä»¬çš„IPåœ°å€å˜æˆå›½å¤–çš„åœ°å€ã€‚</p>
  </li>
  <li>
    <p>æ­£å‘ä»£ç†æœåŠ¡å™¨ä½äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œä¸ºäº†å‘æœåŠ¡å™¨è·å–æ•°æ®ï¼Œå®¢æˆ·ç«¯è¦å‘ä»£ç†æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶æŒ‡å®šç›®æ ‡æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨å°†ç›®æ ‡æœåŠ¡å™¨è¿”å›çš„æ•°æ®è½¬äº¤ç»™å®¢æˆ·ç«¯ã€‚è¿™é‡Œå®¢æˆ·ç«¯è¦è¿›è¡Œä¸€äº›æ­£å‘ä»£ç†çš„è®¾ç½®ã€‚</p>

    <p><img src="/img/images/nginx/02-æ­£å‘ä»£ç†.png" /></p>
  </li>
</ul>

<h4 id="152-åå‘ä»£ç†">1.5.2 åå‘ä»£ç†</h4>

<ul>
  <li>
    <p>åå‘ä»£ç†ï¼Œå…¶å®å®¢æˆ·ç«¯å¯¹ä»£ç†æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸éœ€è¦ä»»ä½•é…ç½®å°±å¯ä»¥è®¿é—®ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¯·æ±‚å‘é€åˆ°åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”±åå‘ä»£ç†æœåŠ¡å™¨å»é€‰æ‹©ç›®æ ‡æœåŠ¡å™¨è·å–æ•°æ®åï¼Œåœ¨è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶åå‘ä»£ç†æœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨å¯¹å¤–å°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæš´éœ²çš„æ˜¯ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œéšè—äº†çœŸå®æœåŠ¡å™¨IPåœ°å€ã€‚</p>

    <p><img src="/img/images/nginx/03-åå‘ä»£ç†.png" /></p>
  </li>
</ul>

<h4 id="153-nginx-å®ç°åå‘ä»£ç†">1.5.3 Nginx å®ç°åå‘ä»£ç†</h4>

<p>ä¸¤ä¸ªåŸŸåæŒ‡å‘åŒä¸€å° nginx æœåŠ¡å™¨ï¼Œç”¨æˆ·è®¿é—®ä¸åŒçš„åŸŸåæ˜¾ç¤ºä¸åŒçš„ç½‘é¡µå†…å®¹ã€‚ ä¸¤ä¸ªåŸŸåæ˜¯ www.sian.com.cn å’Œ www.sohu.com</p>

<ol>
  <li>
    <p>å®‰è£…ä¸¤ä¸ª tomcatï¼Œåˆ†åˆ«è¿è¡Œåœ¨ 8080 å’Œ 8081 ç«¯å£ã€‚</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim  /home/silhouette/apache-tomcat-8.5.38-2/conf/server.xml
</code></pre></div>    </div>

    <blockquote>
      <p>æ³¨æ„ï¼šéœ€è¦ä¿®æ”¹httpè®¿é—®ç«¯å£ï¼ˆé»˜è®¤ä¸º8080ç«¯å£ï¼‰ã€ç›‘å¬tomcatå…³é—­çš„ç«¯å£ï¼ˆé»˜è®¤ä¸º8005ï¼‰ã€è´Ÿè´£æ¥æ”¶å…¶ä»–httpæœåŠ¡å™¨çš„è¯·æ±‚ç«¯å£ï¼ˆé»˜è®¤ä¸º8009ï¼‰ã€‚</p>
    </blockquote>
  </li>
  <li>
    <p>ä¿®æ”¹ä¸¤ä¸ªtomcatçš„é¦–é¡µå†…å®¹ï¼Œå¯åŠ¨ä¸¤ä¸ª tomcatã€‚</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim /home/silhouette/apache-tomcat-8.5.38-2/webapps/ROOT/index.jsp
</code></pre></div>    </div>
  </li>
  <li>
    <p>åå‘ä»£ç†æœåŠ¡å™¨çš„é…ç½®</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>upstream tomcat1<span class="o">{</span>
        server    192.168.30.77:8888<span class="p">;</span>
<span class="o">}</span>
server <span class="o">{</span>
      listen    80<span class="p">;</span>
      server_name   8888.silhouette.com<span class="p">;</span>
   
      location / <span class="o">{</span>
           proxy_pass     http://tomcat1<span class="p">;</span>
           index index.html index.htm<span class="p">;</span>
      <span class="o">}</span>
<span class="o">}</span>
   
upstream tomcat2<span class="o">{</span>
        server    192.168.30.77:8080<span class="p">;</span>
<span class="o">}</span>
server <span class="o">{</span>
      listen    80<span class="p">;</span>
      server_name   8080.silhouette.com<span class="p">;</span>
   
      location / <span class="o">{</span>
           proxy_pass     http://tomcat2<span class="p">;</span>
           index index.html index.htm<span class="p">;</span>
      <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>nginxé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./nginx <span class="nt">-s</span> reload
</code></pre></div>    </div>
  </li>
  <li>
    <p>é…ç½®åŸŸåï¼šåœ¨hostsæ–‡ä»¶ä¸­æ·»åŠ åŸŸåå’Œipçš„æ˜ å°„å…³ç³»</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim /etc/hosts
<span class="c">####æ·»åŠ æ¡ç›®,å¦‚ä¸‹:</span>
192.168.30.77  8081.silhouette.com
192.168.30.77  8080.silhouette.com
</code></pre></div>    </div>

    <blockquote>
      <p>æ³¨æ„ï¼šé…ç½®åŸŸåä¸IPçš„æ˜ å°„æ˜¯åœ¨å®¿ä¸»æœºä¸Šï¼Œè€Œä¸æ˜¯åœ¨è™šæ‹Ÿæœºä¸Š</p>
    </blockquote>
  </li>
</ol>

:ET