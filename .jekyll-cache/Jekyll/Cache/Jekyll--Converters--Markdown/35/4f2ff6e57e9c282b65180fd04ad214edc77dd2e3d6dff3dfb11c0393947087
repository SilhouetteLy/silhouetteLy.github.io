I"òp<h2 id="å‰è¨€">å‰è¨€</h2>

<p>ä¸Šå›ä¹¦æˆ‘ä»¬è¯¦ç»†çš„äº†è§£äº† Nginx é…ç½®æ–‡ä»¶çš„è¯­æ³•åŠNginx çš„åŸç†ï¼Œé‚£ä¹ˆä¹¦æ¥ä¸Šå›ï¼ŒNginxåœ¨å®é™…ç”Ÿäº§ä¸­æœ‰å“ªäº›å®é™…ç”¨æ³•å‘¢ï¼Ÿç°åœ¨ï¼Œå°±è®©æˆ‘ä»¬å»å®æ“ä¸€ä¸‹ nginx åœ¨å®é™…ç”Ÿäº§çš„ä¸€äº›å¸¸ç”¨æ¡ˆä¾‹ã€‚ä¸‹é¢æ˜¯æœ¬åšå®¢æ‰€å‚è€ƒé“¾æ¥ï¼š</p>

<ul>
  <li><a href="https://www.cnblogs.com/arjenlee/p/9256835.html">Nginxè´Ÿè½½å‡è¡¡é«˜å¯ç”¨</a></li>
</ul>

<h2 id="ä¸€nginx-é…ç½®å®ä¾‹">ä¸€ã€Nginx é…ç½®å®ä¾‹</h2>

<h3 id="11-åå‘ä»£ç†">1.1 åå‘ä»£ç†</h3>

<h4 id="112-ç¤ºä¾‹1">1.1.2 ç¤ºä¾‹1</h4>

<ul>
  <li>
    <p>éœ€æ±‚åˆ†æï¼šä½¿ç”¨ nginx åå‘ä»£ç†ï¼Œè®¿é—®www.1234567.com ç›´æ¥è·³è½¬åˆ°è™šæ‹Ÿæœºçš„ tomcat ä¸»é¡µé¢ä¸­</p>
  </li>
  <li>
    <p>å®ç°æ­¥éª¤</p>

    <ol>
      <li>
        <p>åœ¨ Linux ç³»ç»Ÿå®‰è£… tomcat ï¼Œä½¿ç”¨é»˜è®¤ç«¯å£ 8080 å¯åŠ¨ tomcat æœåŠ¡å™¨</p>
      </li>
      <li>
        <p>æŸ¥çœ‹å¯¹å¤–è®¿é—®çš„ç«¯å£</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>firewall-cmd <span class="nt">--add-port</span><span class="o">=</span>8080/tcp <span class="nt">--permanent</span>
<span class="nv">$ </span>firewall-cmd <span class="nt">-reload</span>
<span class="c">#æŸ¥çœ‹å·²ç»å¼€æ”¾çš„ç«¯å£å·</span>
<span class="nv">$ </span>firewall-cmd <span class="nt">--list-all</span>
<span class="c"># é‡å¯é˜²ç«å¢™</span>
<span class="nv">$ </span>firewall-cmd â€“reload
</code></pre></div>        </div>

        <blockquote>
          <p>æ³¨æ„ï¼šå¦‚æœé˜²ç«å¢™æœåŠ¡å·²ç»å…³é—­ï¼Œåˆ™å¯ä»¥çœç•¥è¿™ä¸€æ­¥</p>
        </blockquote>
      </li>
      <li>
        <p>ä¿®æ”¹æœ¬åœ° host æ–‡ä»¶ï¼Œå°† www.1234567.com æ˜ å°„ åˆ°è™šæ‹Ÿæœºtomcatä¸»é¡µä¸­ 192.168.0.109:8080</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>su
<span class="nv">$ </span>vim /etc/hosts
<span class="c"># æ·»åŠ IP å’ŒåŸŸåçš„æ˜ å°„</span>
192.168.0.109    www.1234567.com
</code></pre></div>        </div>

        <blockquote>
          <p>Tipsï¼šå½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªåŸŸåæ—¶ï¼Œå®ƒæ˜¯å…ˆå»æˆ‘ä»¬æœ¬åœ°çš„<code class="highlighter-rouge">host</code>æ–‡ä»¶ä¸­æ‰¾é…ç½®åŸŸåæ˜ å°„çš„IPåœ°å€é…ç½®ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±å»ç½‘ç»œæ‰¾<code class="highlighter-rouge">DNSåŸŸåè§£ææœåŠ¡å™¨</code>ï¼Œæ‰¾ç½‘ç»œä¸­IPã€‚</p>
        </blockquote>
      </li>
      <li>
        <p>åœ¨<code class="highlighter-rouge">nginx.conf</code>é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim /usr/local/nginx/nginx.conf
<span class="c"># æ·»åŠ ä»£ç å¦‚ä¸‹</span>
server <span class="o">{</span>
	listen		80<span class="p">;</span>
	server_name	www.1234567.com<span class="p">;</span>
     	
	location /<span class="o">{</span>
		proxy_pass    http://192.168.0.109:8080<span class="p">;</span>
		index index.html index.htm. index.jsp<span class="p">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œè®¿é—®æµ‹è¯•</p>

        <p><img src="/img/images/nginx/02/01-åå‘ä»£ç†.png.png" /></p>
      </li>
    </ol>
  </li>
</ul>

<h4 id="112-å®ä¾‹äºŒ">1.1.2 å®ä¾‹äºŒ</h4>

<ul>
  <li>
    <p>å®ç°æ•ˆæœï¼š</p>

    <ul>
      <li>ä½¿ç”¨ nginx åå‘ä»£ç†ï¼Œæ ¹æ®è®¿é—®çš„è·¯å¾„è·³è½¬åˆ°ä¸åŒç«¯å£çš„æœåŠ¡ä¸­ï¼Œnginx ç›‘å¬ç«¯å£ä¸º 9001</li>
      <li>è®¿é—® http://192.168.0.109/edu/ ç›´æ¥è·³è½¬åˆ° 192.168.109:8081</li>
      <li>è®¿é—® http://192.168.0.109/vod/ ç›´æ¥è·³è½¬åˆ° 192.168.109:8082</li>
    </ul>
  </li>
  <li>
    <p>å®ç°æ­¥éª¤</p>

    <ol>
      <li>
        <p>å‡†å¤‡ä¸¤ä¸ªtomcat ï¼Œä¸€ä¸ª 8081ç«¯å£ï¼Œä¸€ä¸ª8082 ç«¯å£ï¼Œå¹¶å‡†å¤‡å¥½æµ‹è¯•é¡µé¢</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-r</span> apache-tomcat-8.5.38 tomcat1
<span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-r</span> apache-tomcat-8.5.38 tomcat2
<span class="nv">$ </span>vim /home/silhouette/tomcat1/conf/server.xml
<span class="nv">$ </span><span class="nb">cd</span> /home/silhouette/tomcat1/webapps/ROOT
<span class="nv">$ </span><span class="nb">mkdir </span>edu
<span class="nv">$ </span>vim index.jsp
<span class="nv">$ </span>vim /home/silhouette/tomcat2/conf/server.xml
<span class="nv">$ </span><span class="nb">cd</span> /home/silhouette/tomcat2/webapps/ROOT
<span class="nv">$ </span><span class="nb">mkdir </span>vod
<span class="nv">$ </span>vim index.jsp
</code></pre></div>        </div>
      </li>
      <li>
        <p>ä¿®æ”¹ nginx çš„é…ç½®æ–‡ä»¶ï¼Œè¿›è¡Œåå‘ä»£ç†è®¾ç½®</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim /usr/local/nginx/nginx.conf
<span class="c"># æ·»åŠ ä»£ç å¦‚ä¸‹</span>
server <span class="o">{</span>
	listen       9001<span class="p">;</span>
	server_name   192.168.0.109<span class="p">;</span>
     	
	location   ~/edu/ <span class="o">{</span>
		proxy_pass   http://192.168.0.109:8081<span class="p">;</span>
	<span class="o">}</span>
	location   ~/vod/ <span class="o">{</span>
		proxy_pass   http://192.168.0.109:8082<span class="p">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>å¼€æ”¾9001ã€8081ã€8082ç«¯å£</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># æŸ¥çœ‹å·²ç»å¼€æ”¾çš„ç«¯å£å·</span>
<span class="nv">$ </span>firewall-cmd <span class="nt">--list-all</span>
<span class="c"># å¯¹å¤–å¼€æ”¾è®¿é—®çš„ç«¯å£</span>
<span class="nv">$ </span>firewall-cmd <span class="nt">--add-service</span><span class="o">=</span>http <span class="nt">--permanent</span>
<span class="nv">$ </span>firewall-cmd <span class="nt">--add-port</span><span class="o">=</span>9001/tcp <span class="nt">--permannent</span>
</code></pre></div>        </div>

        <blockquote>
          <p>Tipsï¼šå¦‚æœé˜²ç«å¢™æœåŠ¡å·²ç»å…³é—­ï¼Œè¯¥æ­¥æ“ä½œå¯çœ</p>
        </blockquote>
      </li>
      <li>
        <p>åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œæµ‹è¯•ï¼Œæ•ˆæœå¦‚å›¾</p>

        <p><img src="/img/images/nginx/02/02-åå‘ä»£ç†ç¤ºä¾‹2.png" /></p>
      </li>
    </ol>
  </li>
</ul>

<h3 id="12-è´Ÿè½½å‡è¡¡">1.2 è´Ÿè½½å‡è¡¡</h3>

<h4 id="121-è´Ÿè½½å‡è¡¡æ¦‚è¿°">1.2.1 è´Ÿè½½å‡è¡¡æ¦‚è¿°</h4>

<ul>
  <li>
    <p><code class="highlighter-rouge">è´Ÿè½½å‡è¡¡</code>ï¼šå¢åŠ æœåŠ¡å™¨çš„æ•°é‡ï¼Œç„¶åå°†è¯·æ±‚åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°†åŸå…ˆè¯·æ±‚é›†ä¸­åˆ°å•ä¸ªæœåŠ¡å™¨ä¸Šçš„æƒ…å†µæ”¹ä¸ºå°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œ<code class="highlighter-rouge">å°†è´Ÿè½½åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„è´Ÿè½½å‡è¡¡ã€‚</code></p>
  </li>
  <li>
    <p>å›¾è§£è´Ÿè½½å‡è¡¡</p>

    <p><img src="/img/images/nginx/02/03-è´Ÿè½½å‡è¡¡.png" /></p>
  </li>
</ul>

<h4 id="122-è´Ÿè½½å‡è¡¡çš„å®ç°">1.2.2 è´Ÿè½½å‡è¡¡çš„å®ç°</h4>

<ul>
  <li>
    <p>å®ç°æ•ˆæœ</p>

    <ul>
      <li>æµè§ˆå™¨åœ°å€è¾“å…¥<code class="highlighter-rouge">http://192.168.0.108/edu/index.jsp</code>ï¼Œè´Ÿè½½å‡è¡¡æ•ˆæœï¼Œå¹³å‡8081å’Œ8082ç«¯å£ä¸­</li>
    </ul>
  </li>
  <li>
    <p>å®ç°æ­¥éª¤</p>

    <ol>
      <li>
        <p>å‡†å¤‡ä¸¤å° tomcat æœåŠ¡å™¨ï¼Œä¸€å° 8081 ï¼Œä¸€å°8082</p>
      </li>
      <li>
        <p>åœ¨ä¸¤å° tomcat é‡Œé¢çš„ webapps ç›®å½•ä¸­ï¼Œåˆ›å»ºåç§°ä¸º eduæ–‡ä»¶å¤¹ï¼Œåœ¨ edu æ–‡ä»¶å¤¹ä¸­åˆ›å»ºé¡µé¢index.jspï¼Œç”¨äºæµ‹è¯•è®¿é—®</p>
      </li>
      <li>
        <p>åœ¨ nginx çš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè´Ÿè½½å‡è¡¡çš„é…ç½®</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim /usr/local/nginx/nginx.conf
<span class="c"># æ·»åŠ ä»£ç å¦‚ä¸‹</span>
upstream myserver <span class="o">{</span>
		server 192.168.0.108:8081<span class="p">;</span>
		server 192.168.0.108:8082<span class="p">;</span> 
<span class="o">}</span>
     
server <span class="o">{</span>
	listen       9002<span class="p">;</span>
	server_name   192.168.0.108<span class="p">;</span>
     	
	location   / <span class="o">{</span>
		proxy_pass   http://myserver<span class="p">;</span>
		proxy_connect_timeout     10<span class="p">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>æµ‹è¯•è¿è¡Œ</p>

        <p><img src="/img/images/nginx/02/04-è´Ÿè½½å‡è¡¡æ•ˆæœå›¾.png" /></p>
      </li>
    </ol>
  </li>
  <li>
    <p>è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼š</p>

    <ul>
      <li>Nginx æä¾›äº†è¿˜é›†ä¸­åˆ†é…ç­–ç•¥ï¼Œä¸Šä¾‹é‡‡ç”¨çš„æ˜¯<code class="highlighter-rouge">è½®è¯¢(é»˜è®¤)</code>çš„æ–¹å¼ï¼Œå…¶ä»–ç”¨æ³•è¯·æŸ¥çœ‹<a href="">ä¼ é€é—¨</a></li>
    </ul>
  </li>
</ul>

<h3 id="13-åŠ¨é™åˆ†ç¦»">1.3 åŠ¨é™åˆ†ç¦»</h3>

<h4 id="131-åŠ¨é™åˆ†ç¦»æ¦‚è¿°">1.3.1 åŠ¨é™åˆ†ç¦»æ¦‚è¿°</h4>

<p>Nginx åŠ¨é™åˆ†ç¦»ç®€å•æ¥è¯´å°±æ˜¯æŠŠåŠ¨æ€å’Œé™æ€è¯·æ±‚åˆ†å¼€ï¼Œä¸èƒ½ç†è§£æˆåªæ˜¯å•çº¯çš„æŠŠåŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢ç‰©ç†åˆ†ç¦»ã€‚ä¸¥æ ¼æ„ä¹‰ä¸Šè¯´å°±æ˜¯åŠ¨æ€è¯·æ±‚æ›´é™æ€è¯·æ±‚åˆ†å¼€ï¼Œå¯ä»¥ç†è§£æˆä½¿ç”¨ Nginx å¤„ç†é™æ€é¡µé¢ï¼Œ Tomcat å¤„ç†åŠ¨æ€é¡µé¢ã€‚åŠ¨é™åˆ†ç¦»ä»ç›®å‰æ¥çœ‹å¤§è‡´åˆ†ä¸ºä¸¤ç§ï¼š</p>

<ul>
  <li>
    <p>ä¸€ç§æ˜¯çº¯ç²¹æŠŠé™æ€æ–‡ä»¶ç‹¬ç«‹æˆå•ç‹¬çš„åŸŸåï¼Œæ”¾åœ¨ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šï¼Œä¹Ÿæ˜¯ç›®å‰ä¸»æµæ¨å´‡çš„æ–¹æ¡ˆ</p>

    <p><img src="/img/images/nginx/02/05-é™æ€åˆ†ç¦»åŸç†.png" /></p>
  </li>
  <li>
    <p>å¦ä¸€ç§æ˜¯å°±æ˜¯åŠ¨æ€å’Œé™æ€æ–‡ä»¶æ··åˆåœ¨ä¸€èµ·å‘å¸ƒï¼Œé€šè¿‡ nginx  æ¥åˆ†å¼€ã€‚</p>
  </li>
</ul>

<p>é€šè¿‡<code class="highlighter-rouge">location</code>æŒ‡å®šä¸åŒçš„åç¼€åå®ç°ä¸åŒçš„è¯·æ±‚è½¬å‘ã€‚é€šè¿‡<code class="highlighter-rouge">expires</code>å‚æ•°è®¾ç½®ï¼Œå¯ä»¥ä½¿æµè§ˆå™¨ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œå‡å°‘ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¯·æ±‚å’Œæµé‡ã€‚å…·ä½“<code class="highlighter-rouge">Expires</code>å®šä¹‰ï¼šæ˜¯ç»™ä¸€ä¸ªèµ„æºè®¾å®šä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´æ— éœ€å»æœåŠ¡ç«¯éªŒè¯ï¼Œç›´æ¥é€šè¿‡æµè§ˆå™¨è‡ªèº«ç¡®è®¤æ˜¯å¦è¿‡æœŸå³å¯ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿé¢å¤–çš„æµé‡ã€‚æ­¤ç§æ–¹æ³•éå¸¸é€‚åˆä¸ç»å¸¸å˜åŠ¨çš„èµ„æºã€‚(å¦‚æœç»å¸¸æ›´æ–°çš„æ–‡ä»¶ï¼Œä¸å»ºè®®ä½¿ç”¨<code class="highlighter-rouge">Expires</code>æ¥ç¼“å­˜)ã€‚</p>

<p>å¦‚ï¼šæˆ‘ä»¬è¿™é‡Œè®¾ç½® 3dï¼Œè¡¨ç¤ºåœ¨è¿™ 3å¤©ä¹‹å†…è®¿é—®è¿™ä¸ª URL ï¼Œå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯”å¯¹æœåŠ¡å™¨è¯¥æ–‡ä»¶æœ€åæ›´æ–°æ—¶é—´æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸ä¼šä»æœåŠ¡å™¨æŠ“å–ï¼Œè¿”å›çŠ¶æ€ç  304ï¼Œå¦‚æœæœ‰ä¿®æ”¹ï¼Œåˆ™ç›´æ¥ä»æœåŠ¡å™¨é‡æ–°ä¸‹è½½ï¼Œè¿”å›çŠ¶æ€ç  200ã€‚</p>

<h4 id="132-å®ç°æ­¥éª¤">1.3.2 å®ç°æ­¥éª¤</h4>

<ol>
  <li>
    <p>é™æ€èµ„æºå‡†å¤‡</p>

    <p><img src="/img/images/nginx/02/06-é™æ€èµ„æºå‡†å¤‡.png" /></p>
  </li>
  <li>
    <p>è¿›è¡Œ nginx é…ç½®</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim /usr/local/nginx/nginx.conf
<span class="c"># æ·»åŠ ä»£ç å¦‚ä¸‹</span>
server <span class="o">{</span>
	listen	    9003<span class="p">;</span>
	server_name  192.168.0.108<span class="p">;</span>
     	
   location /html/ <span class="o">{</span>
   		root /home/silhouette/static-file/<span class="p">;</span>
   		<span class="c"># åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶</span>
   		autoindex  on<span class="p">;</span>
   		index index.html index.htm<span class="p">;</span>
   <span class="o">}</span>
   location /image/<span class="o">{</span>
   		root /home/silhouette/static-file/<span class="p">;</span>
   		index index.html index.htm<span class="p">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>åœ¨æµè§ˆå™¨å™¨ä¸­è¾“å…¥åœ°å€ï¼ŒæŸ¥çœ‹æ•ˆæœ</p>

    <p><img src="/img/images/nginx/02/07-é™æ€åˆ†ç¦»æ•ˆæœå›¾.png" /></p>
  </li>
</ol>

<h3 id="14-nginxæ­å»ºé«˜å¯ç”¨é›†ç¾¤">1.4 Nginxæ­å»ºé«˜å¯ç”¨é›†ç¾¤</h3>

<h4 id="141-ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡é«˜å¯ç”¨">1.4.1 ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡é«˜å¯ç”¨</h4>

<p>Nginx ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½åˆ°äº†ngxin ï¼Œå¯è§nginx å¤„äºéå¸¸é‡è¦çš„ä½ç½®ï¼Œå¦‚æœ nginx æœåŠ¡å™¨å®•æœºåç«¯ web æœåŠ¡å°†æ— æ³•æä¾›æœåŠ¡ï¼Œå½±å“ä¸¥é‡ã€‚</p>

<p>ä¸ºäº†å±è”½è´Ÿè½½å‡è¡¡æœåŠ¡å™¨çš„å®•æœºï¼Œéœ€è¦å»ºç«‹ä¸€ä¸ªå¤‡ä»½æœºã€‚ä¸»æœåŠ¡å™¨å’Œå¤‡ä»½æœºéƒ½è¿è¡Œåœ¨é«˜å¯ç”¨(High Availability)ç›‘æ§ç¨‹åºï¼Œé€šè¿‡ä¼ é€è¯¸å¦‚ â€œI am aliveâ€ è¿™æ ·çš„ä¿¡æ¯æ¥ç›‘æ§å¯¹æ–¹çš„è¿è¡ŒçŠ¶å†µã€‚å½“å¤‡ä»½æœºä¸èƒ½åœ¨ä¸€å®šçš„æ—¶é—´å†…æ”¶åˆ°è¿™æ ·çš„ä¿¡æ¯æ—¶ï¼Œå®ƒå°±æ¥ç®¡ä¸»æœåŠ¡å™¨çš„IP å¹¶ç»§ç»­æä¾›è´Ÿè½½å‡è¡¡æœåŠ¡ï¼›å½“å¤‡ä»½ç®¡ç†å™¨åˆä»ä¸»ç®¡ç†å™¨æ”¶åˆ°â€œI am aliveâ€è¿™æ ·çš„ä¿¡æ¯æ—¶ï¼Œå®ƒå°±é‡Šæ”¾ IPåœ°å€ï¼Œè¿™æ ·çš„ä¸»æœåŠ¡å°±å¼€å§‹å†æ¬¡æä¾›è´Ÿè½½å‡è¡¡æœåŠ¡ã€‚</p>

<ul>
  <li>
    <p>é«˜å¯ç”¨åŸç†å›¾</p>

    <p><img src="/img/images/nginx/02/08-é«˜å¯ç”¨.png" /></p>
  </li>
  <li>
    <p>æ­å»ºç¯å¢ƒéœ€æ±‚</p>

    <ul>
      <li>éœ€è¦ä¸¤å° nginx æœåŠ¡å™¨</li>
      <li>éœ€è¦keepalived</li>
      <li>éœ€è¦è™šæ‹Ÿ IP</li>
    </ul>
  </li>
</ul>

<h4 id="142-ä»€ä¹ˆæ˜¯-keepalived">1.4.2 ä»€ä¹ˆæ˜¯ keepalived</h4>

<ul>
  <li>
    <p>ç®€ä»‹</p>

    <ul>
      <li><code class="highlighter-rouge">keepalivedæ˜¯é›†ç¾¤ç®¡ç†ä¸­ä¿è¯é›†ç¾¤é«˜å¯ç”¨çš„ä¸€ä¸ªæœåŠ¡è½¯ä»¶ï¼Œç”¨æ¥é˜²æ­¢å•ç‚¹æ•…éšœ</code></li>
      <li>Keepalived çš„ä½œç”¨æ˜¯æ£€æµ‹ web æœåŠ¡å™¨çš„çŠ¶æ€ï¼Œå¦‚æœæœ‰ä¸€å° web æœåŠ¡å™¨æ­»æœºï¼Œæˆ–å·¥ä½œå‡ºç°æ•…éšœï¼ŒKeepalived å°†æ£€æµ‹åˆ°ï¼Œå¹¶å°†æœ‰æ•…éšœçš„ web æœåŠ¡å™¨ä»ç³»ç»Ÿä¸­å‰”é™¤ï¼Œå½“ web æœåŠ¡å™¨å·¥ä½œæ­£å¸¸å Keepalived è‡ªåŠ¨å°† web æœåŠ¡å™¨åŠ å…¥åˆ°æœåŠ¡å™¨ç¾¤ä¸­ï¼Œè¿™äº›å·¥ä½œå…¨éƒ¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦äººå·¥å¹²æ¶‰ï¼Œéœ€è¦äººå·¥åšçš„åªæ˜¯ä¿®å¤æ•…éšœçš„ web æœåŠ¡å™¨</li>
    </ul>
  </li>
  <li>
    <p>Keepalived å·¥ä½œåŸç†</p>

    <ul>
      <li>Keepalied æ˜¯ä»¥ VRRP(Virtual Router Redundancy Protocolï¼Œå³è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®) åè®®ä¸ºå®ç°åŸºç¡€çš„</li>
      <li>è™šæ‹Ÿè·¯ç”±åè®®ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å®ç°è·¯ç”±å™¨é«˜å¯ç”¨çš„åè®®ï¼Œå³å°† N å°æä¾›ç›¸åŒåŠŸèƒ½çš„è·¯ç”±å™¨ç»„æˆä¸€ä¸ªè·¯ç”±å™¨ç»„ï¼Œè¿™ä¸ªç»„é‡Œé¢æœ‰ä¸€ä¸ª master å’Œå¤šä¸ª backupï¼Œmaster ä¸Šé¢æœ‰ä¸€ä¸ªå¯¹å¤–æä¾›æœåŠ¡çš„ vip (Virtual IP Addressï¼Œè™šæ‹ŸIP åœ°å€ï¼Œè¯¥è·¯ç”±å™¨æ‰€åœ¨å±€åŸŸç½‘å†…å…¶ä»–æœºå™¨çš„é»˜è®¤è·¯ç”±ä¸ºè¯¥ vip) ï¼Œmaster ä¼šåˆ†ç»„æ’­ï¼Œå½“backup æ‰‹ä¸åˆ° VRRP åŒ…æ—¶å°±è®¤ä¸º master å®• æ‰äº†ï¼Œè¿™æ—¶å°±éœ€è¦æ ¹æ® VRRP çš„ä¼˜å…ˆçº§æ¥é€‰ä¸¾ä¸€ä¸ª backup å½“masterã€‚è¿™æ ·çš„è¯å°±å¯ä»¥ä¿è¯è·¯ç”±å™¨çš„é«˜å¯ç”¨äº†ã€‚</li>
      <li>Keepalived ä¸»è¦æœ‰ä¸‰ä¸ªæ¨¡å—ï¼Œåˆ†åˆ«æ˜¯ coreã€checkå’Œ VRRPã€‚core æ¨¡å—ä¸ºkeepalived çš„æ ¸å¿ƒï¼Œè´Ÿè´£ä¸»è¿›ç¨‹çš„å¯åŠ¨ã€ç»´æŠ¤ä»¥åŠå…¨å±€é…ç½®æ–‡ä»¶çš„å®¶åœ¨å’Œè§£æã€‚check è´Ÿè´£å¥åº·æ£€æŸ¥ï¼ŒåŒ…æ‹¬å¸¸è§çš„å„ç§æ£€æŸ¥æ–¹å¼ã€‚VRRP æ¨¡å—æ˜¯ç”¨æ¥å®ç° VRRP åè®®çš„ã€‚</li>
    </ul>
  </li>
  <li>
    <p>å®‰è£…æ­¥éª¤</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># å…³é—­é˜²ç«å¢™</span>
<span class="nv">$ </span>systemctl stop firewalld
<span class="c"># //å…³é—­ selinuxï¼Œé‡å¯ç”Ÿæ•ˆ</span>
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/^SELINUX=.*/SELINUX=disabled/'</span> /etc/sysconfig/selinux
<span class="c"># å…³é—­ selinuxï¼Œä¸´æ—¶ç”Ÿæ•ˆ</span>
<span class="nv">$ </span>setenforce 0
<span class="c"># æ—¶é—´åŒæ­¥</span>
<span class="nv">$ </span>ntpdate 0.centos.pool.ntp.org
<span class="nv">$ </span> yum <span class="nb">install</span> <span class="nt">-y</span> keepalived
<span class="c"># æŸ¥çœ‹å®‰è£…ç‰ˆæœ¬</span>
<span class="nv">$ </span> rpm <span class="nt">-q</span> <span class="nt">-a</span> keepalived
<span class="c"># å®‰è£…è·¯å¾„ </span>
<span class="nv">$ </span>vim /etc/keepalived/keepalived.conf
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">keepalived.conf</code>è¯¦è§£</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># å…¨å±€å®šä¹‰</span>
global_defs <span class="o">{</span>
   notification_email <span class="o">{</span>    <span class="c">#æŒ‡å®škeepalivedåœ¨å‘ç”Ÿåˆ‡æ¢æ—¶éœ€è¦å‘é€emailåˆ°çš„å¯¹è±¡ï¼Œä¸€è¡Œä¸€ä¸ª</span>
     acassen@firewall.loc
     failover@firewall.loc
     sysadmin@firewall.loc
   <span class="o">}</span>
   notification_email_from Alexandre.Cassen@firewall.loc    <span class="c">#æŒ‡å®šå‘ä»¶äºº</span>
   smtp_server 192.168.200.1											<span class="c">#æŒ‡å®šsmtpæœåŠ¡å™¨åœ°å€</span>
   smtp_connect_timeout 30													 <span class="c">#æŒ‡å®šsmtpè¿æ¥è¶…æ—¶æ—¶é—´</span>
   router_id LVS_DEVEL <span class="c">#è¿è¡Œkeepalivedæœºå™¨çš„ä¸€ä¸ªæ ‡è¯†</span>
<span class="o">}</span>
  
vrrp_script chk_http_port <span class="o">{</span>
		script <span class="s2">"/usr/local/src/nginx_check.sh"</span>
		interval 2    <span class="c">#ï¼ˆæ£€æµ‹è„šæœ¬æ‰§è¡Œçš„é—´éš”ï¼‰</span>
		weight 2
<span class="o">}</span>
  
vrrp_instance VI_1 <span class="o">{</span>
    state MASTER  		<span class="c"># å¤‡ä»½æœåŠ¡å™¨ä¸Šå°† MASTER æ”¹ä¸º BACKUP</span>
    interface enp0s3    <span class="c"># ç½‘å¡,ä½¿ç”¨ ip addr æŒ‡ä»¤æŸ¥çœ‹</span>
    virtual_router_id 51  <span class="c"># ä¸»ã€å¤‡æœºçš„ virtual_router_id å¿…é¡»ç›¸åŒ</span>
    priority 100					<span class="c"># ä¸»ã€å¤‡æœºå–ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œä¸»æœºå€¼è¾ƒå¤§ï¼Œå¤‡ä»½æœºå€¼è¾ƒå°</span>
    advert_int 1					<span class="c">#MASTERä¸BACKUPè´Ÿè½½å‡è¡¡å™¨ä¹‹é—´åŒæ­¥æ£€æŸ¥çš„æ—¶é—´é—´éš”ï¼Œå•ä½æ˜¯ç§’</span>
    authentication <span class="o">{</span>     <span class="c">#è®¾ç½®è®¤è¯</span>
        auth_type PASS   <span class="c">#ä¸»ä»æœåŠ¡å™¨éªŒè¯æ–¹å¼</span>
        auth_pass 1111
    <span class="o">}</span>
    virtual_ipaddress <span class="o">{</span>    <span class="c">#è®¾ç½®vip</span>
        192.168.0.200 <span class="c"># VRRP H è™šæ‹Ÿåœ°å€ï¼ˆè™šæ‹ŸIPï¼‰,å¯ä»¥å¤šä¸ªè™šæ‹ŸIPï¼Œæ¢è¡Œå³å¯</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>æ£€æµ‹ Nginx çš„è„šæœ¬æ–‡ä»¶<code class="highlighter-rouge">nginx_check.sh</code></p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash </span>
<span class="nv">A</span><span class="o">=</span><span class="sb">`</span>ps <span class="nt">-C</span> nginx â€“no-header |wc <span class="nt">-l</span><span class="sb">`</span> 
<span class="k">if</span> <span class="o">[</span> <span class="nv">$A</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span><span class="k">then</span> 
		/usr/local/nginx/sbin/nginx 
		<span class="nb">sleep </span>2 
		<span class="k">if</span> <span class="o">[</span> <span class="sb">`</span>ps <span class="nt">-C</span> nginx <span class="nt">--no-header</span> |wc <span class="nt">-l</span><span class="sb">`</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span><span class="k">then 
				</span>killall keepalived 
		<span class="k">fi 
fi</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="143-keepalived--nginx-å®ç°ä¸»å¤‡è¿‡ç¨‹ä¸»ä»æ¨¡å¼">1.4.3 keepalived + nginx å®ç°ä¸»å¤‡è¿‡ç¨‹(ä¸»ä»æ¨¡å¼)</h4>

<ol>
  <li>
    <p>ä¿®æ”¹ /etc/keepalived/keepalived.conf</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>global_defs <span class="o">{</span>
   notification_email <span class="o">{</span>
     acassen@firewall.loc
     failover@firewall.loc
     sysadmin@firewall.loc
   <span class="o">}</span>
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id LVS_DEVEL  
<span class="o">}</span>
   
vrrp_script chk_http_port <span class="o">{</span>
                script <span class="s2">"/usr/local/src/nginx_check.sh"</span>
                interval 2    
                weight 2
<span class="o">}</span>
   
vrrp_instance VI_1 <span class="o">{</span>
    state MASTER                
    interface enp0s3    
    virtual_router_id 51  
    priority 100
    advert_int 1
    authentication <span class="o">{</span>
        auth_type PASS
        auth_pass 1111
    <span class="o">}</span>
    virtual_ipaddress <span class="o">{</span>
        192.168.0.200    <span class="c"># è™šæ‹ŸIP</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>åœ¨/usr/local/src/ è·¯å¾„ä¸‹æ·»åŠ ä¸€ä¸ªç›‘å¬ nginxè„šæœ¬ï¼Œè„šæœ¬ä»£ç å¦‚ä¸Š<code class="highlighter-rouge">nginx_check.sh</code></p>
  </li>
  <li>
    <p>æŠŠä¸¤å° æœåŠ¡å™¨ä¸Šçš„ nginx å’Œkeepalived å¯åŠ¨</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /usr/local/nginx/sbin/
<span class="nv">$ </span>./nginx
<span class="c"># å¯åŠ¨ keepalived</span>
<span class="nv">$ </span>systemctl start keepalived.service
<span class="c"># åŠ å…¥å¼€æœºè‡ªå¯åŠ¨</span>
<span class="nv">$ </span>systemctl <span class="nb">enable </span>keepalived
</code></pre></div>    </div>

    <p><img src="/img/images/nginx/02/09-å¯åŠ¨keepalived.png" /></p>
  </li>
  <li>
    <p>æµ‹è¯•è¿è¡Œ</p>

    <ol>
      <li>
        <p>åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥ è™šæ‹ŸIPåœ°å€ 192.168.0.200</p>

        <p><img src="/img/images/nginx/02/10-é«˜å¯ç”¨æµ‹è¯•1.png" /></p>

        <p>é€šè¿‡<code class="highlighter-rouge">ip addr</code>å¯ä»¥æŸ¥çœ‹ç»‘å®šçš„è™šæ‹ŸIPï¼Œvipç»‘å®šåœ¨ä¸»nginxçš„<code class="highlighter-rouge">enp0s3</code>ä¸Š</p>

        <p><img src="/img/images/nginx/02/11-IPæŸ¥çœ‹æ˜¯å¦ç»‘å®š.png" /></p>
      </li>
      <li>
        <p>æŠŠä¸»æœåŠ¡å™¨(192.168.0.107)çš„ nginx å’Œ keepalived åœæ‰å†è®¿é—® 192.168.0.200ï¼Œå‘ç°è®¿é—®æ­£å¸¸</p>

        <ul>
          <li>
            <p>æŸ¥çœ‹ä¸»å¤‡ IPï¼Œæ­¤æ—¶å¤‡èŠ‚ç‚¹ä¸ä¼šæœ‰ VIPï¼ˆåªæœ‰å½“ä¸»æŒ‚äº†çš„æ—¶å€™ï¼ŒVIP æ‰ä¼šé£˜åˆ°å¤‡èŠ‚ç‚¹ï¼‰</p>

            <p><img src="/img/images/nginx/02/12-å¤‡åˆ†çº§vipæ¼‚ç§».png" /></p>
          </li>
          <li>
            <p>å°†ä¸»nginxçš„keepalivedå’Œnginxéƒ½å¯åŠ¨ï¼Œå†æ¬¡æŸ¥çœ‹ä¸»å¤‡ IPï¼Œå‘ç°vipæ¼‚ç§»åˆ°ä¸»nginx</p>
          </li>
        </ul>

        <blockquote>
          <p>æ³¨æ„ï¼šä¸» nginx æ¢å¤æ—¶ä¸€å®šè¦å°†nginx ä¹Ÿå¯åŠ¨ï¼ˆé€šå¸¸ nginx å¯åŠ¨è¦åŠ åœ¨å¼€æœºå¯åŠ¨ä¸­ï¼‰ï¼Œå¦åˆ™å³ä½¿ vipæ¼‚ç§»åˆ°ä¸»nginxä¹Ÿæ— æ³•è®¿é—®ã€‚</p>
        </blockquote>
      </li>
    </ol>
  </li>
</ol>

<h4 id="144-keepalived--nginx-å®ç°é«˜å¯ç”¨é›†ç¾¤åŒä¸»æ¨¡å¼">1.4.4 keepalived + nginx å®ç°é«˜å¯ç”¨é›†ç¾¤(åŒä¸»æ¨¡å¼)</h4>

<p>ä¸Šé¢æˆ‘ä»¬å®ç°äº† keepalived + nginx é«˜å¯ç”¨çš„ä¸»ä»æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼çš„çš„ä¼˜ç‚¹æ˜¯æœ‰ä¸€ä¸ªå¤‡ä»½æœºï¼Œå½“ä¸»æœºå®•æœºæ—¶ï¼Œå¤‡ä»½æœºå°±è‡ªåŠ¨æ¥ç®¡ä¸»æœåŠ¡å™¨çš„IP å¹¶ç»§ç»­æä¾›è´Ÿè½½å‡è¡¡æœåŠ¡ã€‚ä½†æ˜¯è¦æ˜¯æˆ‘ä¸»æœºæ²¡æœ‰å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆå¤‡ä»½æœºå°±ä¼šè¢«é—²ç½®ï¼Œä»è€Œé€ æˆæµªè´¹ã€‚å› æ­¤ï¼Œä¸ºäº†é¿å…å¤‡ä»½æœºçš„é—²ç½®é€ æˆçš„æµªè´¹ï¼Œä»è€Œæ¨å‡ºäº† <code class="highlighter-rouge">keepalived +nginx çš„åŒä¸»æ¨¡å¼</code>ï¼Œé›†ç¾¤æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>

<p><img src="/Users/silhouette/note/Server/Nginx/images/02/13-åŒä¸»æ¨¡å¼.png" alt="13-åŒä¸»æ¨¡å¼" style="zoom:50%;" /></p>

<p><img src="/img/images/nginx/00/01-å®‰è£…æˆåŠŸåçš„ç›®å½•.png" /></p>

<p>ç”±ä¸Šå›¾å¯çŸ¥ï¼Œåªéœ€è¦ä¿®æ”¹ä¸Šè¿°ç¤ºä¾‹ä¸­keepalived æœåŠ¡çš„é…ç½®æ–‡ä»¶å³å¯ã€‚æ­¤æ—¶æ­¤æ—¶LB-01 èŠ‚ç‚¹å³ä¸º Keepalived çš„ä¸»èŠ‚ç‚¹ä¹Ÿä¸ºå¤‡èŠ‚ç‚¹ï¼ŒLB-02 èŠ‚ç‚¹åŒæ ·å³ä¸º Keepalived çš„ä¸»èŠ‚ç‚¹ä¹Ÿä¸ºå¤‡èŠ‚ç‚¹ã€‚LB-01 èŠ‚ç‚¹é»˜è®¤çš„ä¸»èŠ‚ç‚¹ VIPï¼ˆ192.168.1.110ï¼‰ï¼ŒLB-02 èŠ‚ç‚¹é»˜è®¤çš„ä¸»èŠ‚ç‚¹ VIPï¼ˆ192.168.1.210ï¼‰</p>

<ul>
  <li>
    <p>å®ç°æ­¥éª¤</p>

    <ol>
      <li>
        <p>é…ç½® LB-01 èŠ‚ç‚¹</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim /etc/keepalived/keepalived.conf
<span class="c"># /ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¢åŠ ä¸€æ®µæ–°çš„vrrp_instance è§„åˆ™</span>
<span class="o">!</span> Configuration File <span class="k">for </span>keepalived
     
global_defs <span class="o">{</span>
   notification_email <span class="o">{</span>
     acassen@firewall.loc
     failover@firewall.loc
     sysadmin@firewall.loc
   <span class="o">}</span>
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id LVS_DEVEL
<span class="o">}</span>
     
vrrp_script chk_http_port <span class="o">{</span>
                script <span class="s2">"/usr/local/src/nginx_check.sh"</span>
                interval 2
                weight 2
<span class="o">}</span>
     
vrrp_instance VI_1 <span class="o">{</span>
    state MASTER
    interface enp0s3
    virtual_router_id 51
    priority 100
    advert_int 1
    authentication <span class="o">{</span>
        auth_type PASS
        auth_pass 1111
    <span class="o">}</span>
    virtual_ipaddress <span class="o">{</span>
        192.168.0.200
    <span class="o">}</span>
<span class="o">}</span>
     
vrrp_instance VI_2 <span class="o">{</span>
	state BACKUP
	interface enp0s3
	virtual_router_id 52
	priority 99
	advert_int 1
	authentication <span class="o">{</span>
			auth_type PASS
			auth_pass 2222
	<span class="o">}</span>
	virtual_ipaddress <span class="o">{</span>
			192.168.0.210
	<span class="o">}</span>
<span class="o">}</span>
<span class="c"># é‡æ–°å¯åŠ¨ keepalived</span>
<span class="nv">$ </span>systemctl restart keepalived
</code></pre></div>        </div>

        <ul>
          <li>
            <p>æŸ¥çœ‹ LB-01 èŠ‚ç‚¹çš„ IP åœ°å€ï¼Œå‘ç° VIPï¼ˆ192.168.0.109ï¼‰åŒæ ·è¿˜æ˜¯é»˜è®¤åœ¨è¯¥èŠ‚ç‚¹</p>

            <p><img src="/Users/silhouette/note/Server/Nginx/images/02/14-åŒä¸»æ¨¡å¼1.png" alt="14-åŒä¸»æ¨¡å¼1" style="zoom:50%;" /></p>

            <p><img src="/img/images/nginx/00/01-å®‰è£…æˆåŠŸåçš„ç›®å½•.png" /></p>
          </li>
        </ul>
      </li>
      <li>
        <p>é…ç½® LB-02 èŠ‚ç‚¹</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim /etc/keepalived/keepalived.conf
<span class="c"># //ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¢åŠ ä¸€æ®µæ–°çš„ vrrp_instance è§„åˆ™</span>
global_defs <span class="o">{</span>
   notification_email <span class="o">{</span>
     acassen@firewall.loc
     failover@firewall.loc
     sysadmin@firewall.loc
   <span class="o">}</span>
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id LVS_DEVEL
<span class="o">}</span>
     
vrrp_script chk_http_port <span class="o">{</span>
                script <span class="s2">"/usr/local/src/nginx_check.sh"</span>
                interval 2
                weight 2
<span class="o">}</span>
     
vrrp_instance VI_1 <span class="o">{</span>
    state BACKUP
    interface enp0s3
    virtual_router_id 51
    priority 99
    advert_int 1
    authentication <span class="o">{</span>
        auth_type PASS
        auth_pass 1111
    <span class="o">}</span>
    virtual_ipaddress <span class="o">{</span>
        192.168.0.200
    <span class="o">}</span>
<span class="o">}</span>
     
vrrp_instance VI_2 <span class="o">{</span>
		state MASTER
		interface enp0s3
		virtual_router_id 52
		priority 100
		advert_int 1
		authentication <span class="o">{</span>
			auth_type PASS
			auth_pass 2222
		<span class="o">}</span>
		virtual_ipaddress <span class="o">{</span>
				192.168.0.210
		<span class="o">}</span>
<span class="o">}</span>
<span class="c"># é‡æ–°å¯åŠ¨ keepalived</span>
<span class="nv">$ </span>systemctl restart keepalived
</code></pre></div>        </div>

        <ul>
          <li>
            <p>æŸ¥çœ‹ LB-02 èŠ‚ç‚¹ IPï¼Œä¼šå‘ç°ä¹Ÿå¤šäº†ä¸€ä¸ª VIPï¼ˆ192.168.0.110ï¼‰ï¼Œæ­¤æ—¶è¯¥èŠ‚ç‚¹ä¹Ÿå°±æ˜¯ä¸€ä¸ªä¸»äº†ã€‚</p>

            <p><img src="/Users/silhouette/note/Server/Nginx/images/02/15-åŒä¸»æ¨¡å¼2.png" alt="15-åŒä¸»æ¨¡å¼2" style="zoom:50%;" /></p>

            <p><img src="/img/images/nginx/00/01-å®‰è£…æˆåŠŸåçš„ç›®å½•.png" /></p>
          </li>
        </ul>
      </li>
      <li>
        <p>æµ‹è¯•1</p>

        <p><img src="/Users/silhouette/note/Server/Nginx/images/02/16-åŒä¸»æ¨¡å¼æµ‹è¯•.png" alt="16-åŒä¸»æ¨¡å¼æµ‹è¯•" style="zoom:50%;" /></p>

        <p><img src="/img/images/nginx/00/01-å®‰è£…æˆåŠŸåçš„ç›®å½•.png" /></p>
      </li>
    </ol>
  </li>
</ul>

<blockquote>
  <p>Tips: æµ‹è¯•å¯ä»¥å‘ç°æˆ‘ä»¬è®¿é—® keepalived ä¸­é…ç½®çš„ä¸¤ä¸ª VIP éƒ½å¯ä»¥æ­£å¸¸è°ƒåº¦ç­‰ï¼Œå½“æˆ‘ä»¬åœæ­¢ä»»æ„ä¸€å° keepalivedèŠ‚ç‚¹ï¼ŒåŒæ ·è¿˜æ˜¯æ­£å¸¸è®¿é—®ï¼›åˆ°æ­¤ï¼Œkeepalived+nginx é«˜å¯ç”¨é›†ç¾¤ï¼ˆåŒä¸»æ¨¡å¼ï¼‰å°±æ­å»ºå®Œæˆäº†ã€‚</p>
</blockquote>
:ET