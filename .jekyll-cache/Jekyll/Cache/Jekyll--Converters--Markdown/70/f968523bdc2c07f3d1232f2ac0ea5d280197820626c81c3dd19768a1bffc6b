I"e<h2 id="å‰è¨€">å‰è¨€</h2>

<p>æœ€è¿‘åˆ©ç”¨ç©ºä½™æ—¶é—´åšç½‘ç›˜ä¸Šæ”¶è—å¥½ä¹…çš„ä¸€ä¸ªé¡¹ç›®ï¼Œé¡¹ç›®ä¸­æ¶‰åŠåˆ°å›¾ç‰‡çš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œä½¿ç”¨çš„æ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ<code class="highlighter-rouge">FastDFS</code>ã€‚æ‰€ä»¥æœ¬ç¯‡åšå®¢å°±æ˜¯è®°å½•æˆ‘ä¸ªäººåœ¨è™šæ‹Ÿæœºä¸Šæ­å»º<code class="highlighter-rouge">FastDFS</code>ä¸ä½¿ç”¨è¿‡ç¨‹ã€‚</p>

<h2 id="ä¸€-fastdfsä»‹ç»">ä¸€ã€ FastDFSä»‹ç»</h2>

<h3 id="11-fastdfsç®€ä»‹">1.1 FastDFSç®€ä»‹</h3>

<p>FastDFSæ˜¯ç”¨cè¯­è¨€ç¼–å†™çš„ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚FastDFSä¸ºäº’è”ç½‘é‡èº«å®šåˆ¶ï¼Œå……åˆ†è€ƒè™‘äº†å†—ä½™å¤‡ä»½ã€è´Ÿè½½å‡è¡¡ã€çº¿æ€§æ‰©å®¹ç­‰æœºåˆ¶ï¼Œå¹¶æ³¨é‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰æŒ‡æ ‡ï¼Œä½¿ç”¨FastDFSå¾ˆå®¹æ˜“æ­å»ºä¸€å¥—é«˜æ€§èƒ½çš„æ–‡ä»¶æœåŠ¡å™¨é›†ç¾¤æä¾›æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ç­‰æœåŠ¡ã€‚</p>

<h3 id="12-fastdfsæ¶æ„">1.2 FastDFSæ¶æ„</h3>

<p>FastDFSæ¶æ„åŒ…æ‹¬ Tracker serverå’ŒStorage serverã€‚å®¢æˆ·ç«¯è¯·æ±‚Tracker serverè¿›è¡Œæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ï¼Œé€šè¿‡Tracker serverè°ƒåº¦æœ€ç»ˆç”±Storage serverå®Œæˆæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ã€‚</p>

<p>Tracker serverä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡å’Œè°ƒåº¦ï¼Œé€šè¿‡Tracker serveråœ¨æ–‡ä»¶ä¸Šä¼ æ—¶å¯ä»¥æ ¹æ®ä¸€äº›ç­–ç•¥æ‰¾åˆ°Storage serveræä¾›æ–‡ä»¶ä¸Šä¼ æœåŠ¡ã€‚å¯ä»¥å°†trackerç§°ä¸ºè¿½è¸ªæœåŠ¡å™¨æˆ–è°ƒåº¦æœåŠ¡å™¨ã€‚</p>

<p>Storage serverä½œç”¨æ˜¯æ–‡ä»¶å­˜å‚¨ï¼Œå®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶æœ€ç»ˆå­˜å‚¨åœ¨StorageæœåŠ¡å™¨ä¸Šï¼ŒStorage serveræ²¡æœ‰å®ç°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿè€Œæ˜¯åˆ©ç”¨æ“ä½œç³»ç»Ÿ çš„æ–‡ä»¶ç³»ç»Ÿæ¥ç®¡ç†æ–‡ä»¶ã€‚å¯ä»¥å°†storageç§°ä¸ºå­˜å‚¨æœåŠ¡å™¨ã€‚</p>

<p>å¦‚ä¸‹å›¾ï¼š</p>

<p><img src="/img/images/fastDFS/00/01-FastDFSæ¶æ„.png" /></p>

<h4 id="121-tracker-é›†ç¾¤">1.2.1 Tracker é›†ç¾¤</h4>

<p>FastDFSé›†ç¾¤ä¸­çš„Tracker serverå¯ä»¥æœ‰å¤šå°ï¼ŒTracker serverä¹‹é—´æ˜¯ç›¸äº’å¹³ç­‰å…³ç³»åŒæ—¶æä¾›æœåŠ¡ï¼ŒTracker serverä¸å­˜åœ¨å•ç‚¹æ•…éšœã€‚å®¢æˆ·ç«¯è¯·æ±‚Tracker serveré‡‡ç”¨è½®è¯¢æ–¹å¼ï¼Œå¦‚æœè¯·æ±‚çš„trackeræ— æ³•æä¾›æœåŠ¡åˆ™æ¢å¦ä¸€ä¸ªtrackerã€‚</p>

<h4 id="122-storageé›†ç¾¤">1.2.2 Storageé›†ç¾¤</h4>

<p>Storageé›†ç¾¤é‡‡ç”¨äº†åˆ†ç»„å­˜å‚¨æ–¹å¼ã€‚storageé›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç»„æ„æˆï¼Œé›†ç¾¤å­˜å‚¨æ€»å®¹é‡ä¸ºé›†ç¾¤ä¸­æ‰€æœ‰ç»„çš„å­˜å‚¨å®¹é‡ä¹‹å’Œã€‚ä¸€ä¸ªç»„ç”±ä¸€å°æˆ–å¤šå°å­˜å‚¨æœåŠ¡å™¨ç»„æˆï¼Œç»„å†…çš„Storage serverä¹‹é—´æ˜¯å¹³ç­‰å…³ç³»ï¼Œä¸åŒç»„çš„Storage serverä¹‹é—´ä¸ä¼šç›¸äº’é€šä¿¡ï¼ŒåŒç»„å†…çš„Storage serverä¹‹é—´ä¼šç›¸äº’è¿æ¥è¿›è¡Œæ–‡ä»¶åŒæ­¥ï¼Œä»è€Œä¿è¯åŒç»„å†…æ¯ä¸ªstorageä¸Šçš„æ–‡ä»¶å®Œå…¨ä¸€è‡´çš„ã€‚ä¸€ä¸ªç»„çš„å­˜å‚¨å®¹é‡ä¸ºè¯¥ç»„å†…å­˜å‚¨æœåŠ¡å™¨å®¹é‡æœ€å°çš„é‚£ä¸ªï¼Œç”±æ­¤å¯è§ç»„å†…å­˜å‚¨æœåŠ¡å™¨çš„è½¯ç¡¬ä»¶é…ç½®æœ€å¥½æ˜¯ä¸€è‡´çš„ã€‚</p>

<p>é‡‡ç”¨åˆ†ç»„å­˜å‚¨æ–¹å¼çš„å¥½å¤„æ˜¯çµæ´»ã€å¯æ§æ€§è¾ƒå¼ºã€‚æ¯”å¦‚ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ç”±å®¢æˆ·ç«¯ç›´æ¥æŒ‡å®šä¸Šä¼ åˆ°çš„ç»„ä¹Ÿå¯ä»¥ç”±trackerè¿›è¡Œè°ƒåº¦é€‰æ‹©ã€‚ä¸€ä¸ªåˆ†ç»„çš„å­˜å‚¨æœåŠ¡å™¨è®¿é—®å‹åŠ›è¾ƒå¤§æ—¶ï¼Œå¯ä»¥åœ¨è¯¥ç»„å¢åŠ å­˜å‚¨æœåŠ¡å™¨æ¥æ‰©å……æœåŠ¡èƒ½åŠ›ï¼ˆçºµå‘æ‰©å®¹ï¼‰ã€‚å½“ç³»ç»Ÿå®¹é‡ä¸è¶³æ—¶ï¼Œå¯ä»¥å¢åŠ ç»„æ¥æ‰©å……å­˜å‚¨å®¹é‡ï¼ˆæ¨ªå‘æ‰©å®¹ï¼‰ã€‚</p>

<h4 id="123-storageçŠ¶æ€æ”¶é›†">1.2.3 StorageçŠ¶æ€æ”¶é›†</h4>

<p>Storage serverä¼šè¿æ¥é›†ç¾¤ä¸­æ‰€æœ‰çš„Tracker serverï¼Œå®šæ—¶å‘ä»–ä»¬æŠ¥å‘Šè‡ªå·±çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬ç£ç›˜å‰©ä½™ç©ºé—´ã€æ–‡ä»¶åŒæ­¥çŠ¶å†µã€æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ¬¡æ•°ç­‰ç»Ÿè®¡ä¿¡æ¯ã€‚</p>

<h4 id="124-æ–‡ä»¶ä¸Šä¼ æµç¨‹">1.2.4 æ–‡ä»¶ä¸Šä¼ æµç¨‹</h4>

<p><img src="/img/images/fastDFS/00/02-æ–‡ä»¶ä¸Šä¼ æµç¨‹.png" /></p>

<p>å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶åå­˜å‚¨æœåŠ¡å™¨å°†æ–‡ä»¶IDè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ–‡ä»¶IDç”¨äºä»¥åè®¿é—®è¯¥æ–‡ä»¶çš„ç´¢å¼•ä¿¡æ¯ã€‚æ–‡ä»¶ç´¢å¼•ä¿¡æ¯åŒ…æ‹¬ï¼šç»„åï¼Œè™šæ‹Ÿç£ç›˜è·¯å¾„ï¼Œæ•°æ®ä¸¤çº§ç›®å½•ï¼Œæ–‡ä»¶åã€‚</p>

<p><img src="/img/images/fastDFS/00/03-æ–‡ä»¶ç´¢å¼•ä¿¡æ¯.png" /></p>

<ul>
  <li>ç»„åï¼šæ–‡ä»¶ä¸Šä¼ åæ‰€åœ¨çš„storageç»„åç§°ï¼Œåœ¨æ–‡ä»¶ä¸Šä¼ æˆåŠŸåæœ‰storageæœåŠ¡å™¨è¿”å›ï¼Œéœ€è¦å®¢æˆ·ç«¯è‡ªè¡Œä¿å­˜ã€‚</li>
  <li>è™šæ‹Ÿç£ç›˜è·¯å¾„ï¼šstorageé…ç½®çš„è™šæ‹Ÿè·¯å¾„ï¼Œä¸ç£ç›˜é€‰é¡¹store_path*å¯¹åº”ã€‚å¦‚æœé…ç½®äº†store_path0åˆ™æ˜¯M00ï¼Œå¦‚æœé…ç½®äº†store_path1åˆ™æ˜¯M01ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li>
  <li>æ•°æ®ä¸¤çº§ç›®å½•ï¼šstorageæœåŠ¡å™¨åœ¨æ¯ä¸ªè™šæ‹Ÿç£ç›˜è·¯å¾„ä¸‹åˆ›å»ºçš„ä¸¤çº§ç›®å½•ï¼Œç”¨äºå­˜å‚¨æ•°æ®æ–‡ä»¶ã€‚</li>
  <li>æ–‡ä»¶åï¼šä¸æ–‡ä»¶ä¸Šä¼ æ—¶ä¸åŒã€‚æ˜¯ç”±å­˜å‚¨æœåŠ¡å™¨æ ¹æ®ç‰¹å®šä¿¡æ¯ç”Ÿæˆï¼Œæ–‡ä»¶ååŒ…å«ï¼šæºå­˜å‚¨æœåŠ¡å™¨IPåœ°å€ã€æ–‡ä»¶åˆ›å»ºæ—¶é—´æˆ³ã€æ–‡ä»¶å¤§å°ã€éšæœºæ•°å’Œæ–‡ä»¶æ‹“å±•åç­‰ä¿¡æ¯ã€‚</li>
</ul>

<h4 id="125-æ–‡ä»¶ä¸‹è½½æµç¨‹">1.2.5 æ–‡ä»¶ä¸‹è½½æµç¨‹</h4>

<p><img src="/img/images/fastDFS/00/04-æ–‡ä»¶ä¸‹è½½æµç¨‹.png" /></p>

<p>trackeræ ¹æ®è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„å³æ–‡ä»¶ID æ¥å¿«é€Ÿå®šä¹‰æ–‡ä»¶ã€‚æ¯”å¦‚è¯·æ±‚ä¸‹è¾¹çš„æ–‡ä»¶ï¼š</p>

<p><img src="/img/images/fastDFS/00/03-æ–‡ä»¶ç´¢å¼•ä¿¡æ¯.png" /></p>

<ol>
  <li>
    <p>é€šè¿‡ç»„åtrackerèƒ½å¤Ÿå¾ˆå¿«çš„å®šä½åˆ°å®¢æˆ·ç«¯éœ€è¦è®¿é—®çš„å­˜å‚¨æœåŠ¡å™¨ç»„æ˜¯group1ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„å­˜å‚¨æœåŠ¡å™¨æä¾›å®¢æˆ·ç«¯è®¿é—®ã€‚</p>
  </li>
  <li>
    <p>å­˜å‚¨æœåŠ¡å™¨æ ¹æ®â€œæ–‡ä»¶å­˜å‚¨è™šæ‹Ÿç£ç›˜è·¯å¾„â€å’Œâ€œæ•°æ®æ–‡ä»¶ä¸¤çº§ç›®å½•â€å¯ä»¥å¾ˆå¿«å®šä½åˆ°æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œå¹¶æ ¹æ®æ–‡ä»¶åæ‰¾åˆ°å®¢æˆ·ç«¯éœ€è¦è®¿é—®çš„æ–‡ä»¶ã€‚</p>
  </li>
</ol>

<h3 id="13-fastdfsnginxå®ç°æ–‡ä»¶æœåŠ¡å™¨">1.3 FastDFS+Nginxå®ç°æ–‡ä»¶æœåŠ¡å™¨</h3>

<h4 id="131-æ¶æ„å›¾">1.3.1 æ¶æ„å›¾</h4>

<p><img src="/img/images/fastDFS/00/05-æ¶æ„å›¾.png" /></p>

<h4 id="132-fastdfstrackerå®‰è£…">1.3.2 FastDFSâ€“trackerå®‰è£…</h4>

<ol>
  <li>
    <p>FastDFS å®‰è£…ç¯å¢ƒ</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># FastDFSæ˜¯Cè¯­è¨€å¼€å‘ï¼Œå»ºè®®åœ¨linuxä¸Šè¿è¡Œï¼Œæœ¬æ•™ç¨‹ä½¿ç”¨Centos6.4ä½œä¸ºå®‰è£…ç¯å¢ƒã€‚</span>
<span class="c"># è£…FastDFSéœ€è¦å…ˆå°†å®˜ç½‘ä¸‹è½½çš„æºç è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘ä¾èµ–gccç¯å¢ƒï¼Œå¦‚æœæ²¡æœ‰gccç¯å¢ƒï¼Œéœ€è¦å®‰è£…gcc</span>
<span class="nv">$ </span>yum <span class="nb">install </span>gcc-c++
</code></pre></div>    </div>
  </li>
  <li>
    <p>å®‰è£…lievent</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># FastDFSä¾èµ–libeventåº“</span>
<span class="nv">$ </span>yum <span class="nt">-y</span> <span class="nb">install </span>libevent
</code></pre></div>    </div>
  </li>
  <li>
    <p>å®‰è£… libfastcommon</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># libfastcommonæ˜¯FastDFSå®˜æ–¹æä¾›çš„ï¼ŒlibfastcommonåŒ…å«äº†FastDFSè¿è¡Œæ‰€éœ€è¦çš„ä¸€äº›åŸºç¡€åº“ã€‚</span>
<span class="nv">$ </span>rz libfastcommonV1.0.7.tar.gz
<span class="nv">$ </span><span class="nb">cd</span> /home/silhouette
<span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-zxvf</span> libfastcommonV1.0.7.tar.gz
<span class="nv">$ </span><span class="nb">cd </span>libfastcommon-1.0.7
<span class="nv">$ </span>./make.sh
<span class="nv">$ </span>./make.sh <span class="nb">install</span>
</code></pre></div>    </div>

    <ul>
      <li>
        <p><strong>æ³¨æ„ï¼šlibfastcommon</strong>å®‰è£…å¥½åä¼šè‡ªåŠ¨å°†åº“æ–‡ä»¶æ‹·è´è‡³<code class="highlighter-rouge">/usr/lib64</code>ä¸‹ï¼Œç”±äºFastDFSç¨‹åºå¼•ç”¨<code class="highlighter-rouge"> usr/lib</code> ç›®å½•æ‰€ä»¥éœ€è¦å°†<code class="highlighter-rouge">/usr/lib64</code>ä¸‹çš„åº“æ–‡ä»¶æ‹·è´è‡³<code class="highlighter-rouge"> /usr/lib </code>ä¸‹ã€‚</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp</span> /usr/lib64/libfastcommon.so /usr/lib
<span class="nv">$ </span><span class="nb">cp</span> /usr/lib64/libfastcommon.so /usr/local/lib/
<span class="nv">$ </span><span class="nb">cp</span> /usr/lib64/libfdfsclient.so /usr/lib
<span class="nv">$ </span><span class="nb">cp</span> /usr/lib64/libfdfsclient.so /usr/local/lib
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>å®‰è£…fastdfs-5.05.tar.gz</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rz FastDFS_v5.05.tar.gz
<span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-zxvf</span> FastDFS_v5.05.tar.gz
<span class="nv">$ </span><span class="nb">cd </span>FastDFS
<span class="nv">$ </span>./make.sh
<span class="nv">$ </span>./make.sh <span class="nb">install</span>
<span class="c"># å®‰è£…æˆåŠŸå°†å®‰è£…ç›®å½•ä¸‹çš„confä¸‹çš„æ–‡ä»¶æ‹·è´åˆ°/etc/fdfs/ä¸‹ã€‚</span>
<span class="nv">$ </span><span class="nb">cp</span> /home/silhouette/FastDFS/conf/<span class="k">*</span> /etc/fads
</code></pre></div>    </div>
  </li>
  <li>
    <p>é…ç½®tracker</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim tracker.conf
<span class="c">## ä¿®æ”¹FastDFSå®‰è£…è·¯å¾„</span>
<span class="nv">base_path</span><span class="o">=</span>/home/silhouette/FastDFS
</code></pre></div>    </div>
  </li>
  <li>
    <p>å¯åŠ¨</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart
<span class="c"># ï¬è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</span>
<span class="nv">$ </span>vim /etc/rc.d/rc.local
<span class="c">## æ·»åŠ å¯åŠ¨å‘½ä»¤</span>
/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart
</code></pre></div>    </div>
  </li>
</ol>

<p><img src="/img/images/fastDFS/00/06-trackerå¯åŠ¨.png" /></p>

<h4 id="133-fastdfsstorageå®‰è£…">1.3.3 FastDFSâ€“storageå®‰è£…</h4>

<ol>
  <li>
    <p>é…ç½® storage</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim storage.conf
<span class="c"># ä¿®æ”¹é»˜è®¤é…ç½®</span>
<span class="nv">base_path</span><span class="o">=</span>/home/silhouette/FastDFS
<span class="nv">store_path0</span><span class="o">=</span>/home/silhouette/FastDFS/fdfs_storage
<span class="c">#å¦‚æœæœ‰å¤šä¸ªæŒ‚è½½ç£ç›˜åˆ™å®šä¹‰å¤šä¸ªstore_pathï¼Œå¦‚ä¸‹</span>
<span class="c">#store_path1=.....</span>
<span class="c">#store_path2=......</span>
<span class="nv">tracker_server</span><span class="o">=</span>192.168.30.201:22122   <span class="c">#é…ç½®trackeræœåŠ¡å™¨:IP</span>
<span class="c">#å¦‚æœæœ‰å¤šä¸ªåˆ™é…ç½®å¤šä¸ªtracker</span>
<span class="c">#tracker_server=192.168.101.4:22122</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>å¯åŠ¨</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart
<span class="c"># ï¬è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</span>
<span class="nv">$ </span>vim /etc/rc.d/rc.local
<span class="c">## æ·»åŠ å¯åŠ¨å‘½ä»¤</span>
/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart
</code></pre></div>    </div>

    <p><img src="/img/images/fastDFS/00/07-storageå¯åŠ¨.png" /></p>
  </li>
</ol>

<h4 id="134-ä¸Šä¼ å›¾ç‰‡æµ‹è¯•">1.3.4 ä¸Šä¼ å›¾ç‰‡æµ‹è¯•</h4>

<p>FastDFSå®‰è£…æˆåŠŸå¯é€šè¿‡/usr/bin/fdfs_testæµ‹è¯•ä¸Šä¼ ã€ä¸‹è½½ç­‰æ“ä½œã€‚ä¿®æ”¹/etc/fdfs/client.confï¼š</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim /etc/fdfs/client.conf
<span class="c"># ä¿®æ”¹é»˜è®¤é…ç½®</span>
<span class="nv">base_path</span><span class="o">=</span>/home/silhouette/FastDFS
<span class="nv">tracker_server</span><span class="o">=</span>192.168.30.201:22122
</code></pre></div></div>

<p>ä½¿ç”¨æ ¼å¼ï¼š <code class="highlighter-rouge">/usr/bin/fdfs_test</code>  å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶åœ°å€ <code class="highlighter-rouge">upload</code> ä¸Šä¼ æ–‡ä»¶</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">## ç¤ºä¾‹ï¼šæ¯”å¦‚å°†/homeä¸‹çš„å›¾ç‰‡ä¸Šä¼ åˆ°FastDFSä¸­</span>
<span class="nv">$ </span> /usr/bin/fdfs_test /etc/fdfs/client.conf upload /home/anti-steal.jpg
<span class="c"># æŸ¥çœ‹æ—¥å¿—è¾“å‡º</span>
 http://192.168.30.201/group1/M00/00/00/wKgeyV7fLNyAci5dAABdrZgsqUU078.jpg <span class="c">#å°±æ˜¯æ–‡ä»¶çš„ä¸‹è½½è·¯å¾„</span>
 /home/silhouette/FastDFS/fdfs_storage/data/00/00/wKgeyV7fLNyAci5dAABdrZgsqUU078.jpg#å¯¹åº”storageæœåŠ¡å™¨ä¸Šçš„è·¯å¾„ 
</code></pre></div></div>

<blockquote>
  <p>æ³¨æ„ï¼šç”±äºç°åœ¨è¿˜æ²¡æœ‰å’Œnginxæ•´åˆæ— æ³•ä½¿ç”¨httpä¸‹è½½</p>
</blockquote>

<h3 id="14-fastdfs-å’Œnginxæ•´åˆ">1.4 FastDFS å’Œnginxæ•´åˆ</h3>

<p>ä»¥ä¸Šå†…å®¹å…¶å®å·²ç»å®Œæˆäº†<code class="highlighter-rouge">FastDFS</code>çš„é…ç½®ï¼Œå¦‚æœæ­¤æ—¶ä½ ç”¨<code class="highlighter-rouge">Java</code>ç­‰API ç¼–è¾‘å®¢æˆ·ç«¯ï¼Œå®é™…ä¸Šå°±å®Œæˆäº†æ–‡ä»¶çš„ä¸Šä¼ ã€åŒæ­¥å’Œä¸‹è½½ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆç½‘ä¸Šä¼šæœ‰äººè¯´éœ€è¦<code class="highlighter-rouge">Nginx</code>å‘¢ï¼Ÿå…¶ä¸»è¦åŸå› æ˜¯å› ä¸ºï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®Nginx ä¸ºä¸‹è½½æä¾›<code class="highlighter-rouge">åŸºäºhttpåè®®çš„ä¸‹è½½ç­‰åŠŸèƒ½</code></p>

<ul>
  <li>trackerä¸­å®‰è£… Nginxï¼Œä¸»è¦æ˜¯ä¸ºäº†æä¾›<strong>httpè®¿é—®çš„åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ä»¥åŠç¼“å­˜æœåŠ¡</strong></li>
  <li>storageä¸­å®‰è£… Nginxï¼Œä¸»è¦æ˜¯ä¸ºäº†æä¾›<strong>httpçš„è®¿é—®æœåŠ¡ã€‚åŒæ—¶è§£å†³group ä¸­ storage æœåŠ¡å™¨çš„åŒæ­¥å»¶è¿Ÿé—®é¢˜</strong></li>
</ul>

<h4 id="141--åœ¨-trackerä¸Šå®‰è£…nginx">1.4.1  åœ¨ trackerä¸Šå®‰è£…nginx</h4>

<p>nginxçš„å®‰è£…ç»†èŠ‚å‚è€ƒè¿™é‡Œ<a href="https://silhouettely.github.io/2020/06/09/nginx00/">ä¼ é€é—¨</a>ã€‚</p>

<p>åœ¨æ¯ä¸ªtrackerä¸Šå®‰è£…nginxï¼Œçš„ä¸»è¦ç›®çš„æ˜¯åšè´Ÿè½½å‡è¡¡åŠå®ç°é«˜å¯ç”¨ã€‚å¦‚æœåªæœ‰ä¸€å°trackeræœåŠ¡å™¨å¯ä»¥ä¸é…ç½®nginxã€‚</p>

<h4 id="142-åœ¨-storage-ä¸Šå®‰è£…nginx">1.4.2 åœ¨ Storage ä¸Šå®‰è£…nginx</h4>

<ol>
  <li>
    <p>FastDFS-nginx-module</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rz FastDFS-nginx-module_v1.16.tar.gz
<span class="nv">$ </span><span class="nb">cd</span> /home/silhouette
<span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-zxvf</span> FastDFS-nginx-module_v1.16.tar.gz
<span class="nv">$ </span><span class="nb">cd </span>FastDFS-nginx-module/src
<span class="nv">$ </span>vim conf
<span class="c"># ä¿®æ”¹configæ–‡ä»¶å°†/usr/local/è·¯å¾„æ”¹ä¸º/usr/</span>
</code></pre></div>    </div>

    <p><img src="/img/images/fastDFS/00/08-fastdfs-nginx-moduleé…ç½®æ–‡ä»¶çš„ä¿®æ”¹.png" /></p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># å°†FastDFS-nginx-module/srcä¸‹çš„mod_FastDFS.confæ‹·è´è‡³/etc/fdfs/ä¸‹</span>
<span class="nv">$ </span><span class="nb">cp</span> /home/silhouette/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/
<span class="nv">$ </span><span class="nb">cd</span> /etc/fdfs
<span class="nv">$ </span>vim mod_fastdfs.conf
<span class="c"># ä¿®æ”¹mod_FastDFS.confçš„å†…å®¹ï¼š</span>
<span class="nv">base_path</span><span class="o">=</span>/home/silhouette/FastDFS
<span class="nv">tracker_server</span><span class="o">=</span>192.168.30.201:22122
<span class="c">#tracker_server=192.168.101.4:22122ï¼ˆå¤šä¸ªtrackeré…ç½®å¤šè¡Œï¼‰</span>
url_have_group_name <span class="o">=</span> <span class="nb">true</span>        <span class="c">#urlä¸­åŒ…å«groupåç§°</span>
<span class="nv">store_path0</span><span class="o">=</span>/home/silhouette/FastDFS/fdfs_storage    <span class="c">#æŒ‡å®šæ–‡ä»¶å­˜å‚¨è·¯å¾„</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Nginx å®‰è£…</p>

    <ol>
      <li>
        <p>æ·»åŠ FastDFS-nginx-moduleæ¨¡å—</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /home/silhouette/nginx-1.8.0
<span class="nv">$ </span>./configure <span class="se">\</span>
<span class="nt">--prefix</span><span class="o">=</span>/usr/local/nginx <span class="se">\</span>
<span class="nt">--pid-path</span><span class="o">=</span>/var/run/nginx/nginx.pid <span class="se">\</span>
<span class="nt">--lock-path</span><span class="o">=</span>/var/lock/nginx.lock <span class="se">\</span>
<span class="nt">--error-log-path</span><span class="o">=</span>/var/log/nginx/error.log <span class="se">\</span>
<span class="nt">--http-log-path</span><span class="o">=</span>/var/log/nginx/access.log <span class="se">\</span>
<span class="nt">--with-http_gzip_static_module</span> <span class="se">\</span>
<span class="nt">--http-client-body-temp-path</span><span class="o">=</span>/var/temp/nginx/client <span class="se">\</span>
<span class="nt">--http-proxy-temp-path</span><span class="o">=</span>/var/temp/nginx/proxy <span class="se">\</span>
<span class="nt">--http-fastcgi-temp-path</span><span class="o">=</span>/var/temp/nginx/fastcgi <span class="se">\</span>
<span class="nt">--http-uwsgi-temp-path</span><span class="o">=</span>/var/temp/nginx/uwsgi <span class="se">\</span>
<span class="nt">--http-scgi-temp-path</span><span class="o">=</span>/var/temp/nginx/scgi <span class="se">\</span>
<span class="nt">--add-module</span><span class="o">=</span>/usr/local/fastdfs-nginx-module/src <span class="se">\</span>
<span class="nt">--add-module</span><span class="o">=</span>/home/silhouette/fastdfs-nginx-module/src
</code></pre></div>        </div>
      </li>
      <li>
        <p>é‡æ–°ç¼–è¯‘</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make
<span class="nv">$ </span>make <span class="nb">install</span>
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
  <li>
    <p>nginxé…ç½®æ–‡ä»¶</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ä¿®æ”¹ nginxé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ server ä»£ç å—</span>
<span class="nv">$ </span><span class="nb">cat </span>nginx.conf
worker_processes  1<span class="p">;</span>
   
events <span class="o">{</span>
    worker_connections  1024<span class="p">;</span>
<span class="o">}</span>
   
   
http <span class="o">{</span>
    include       mime.types<span class="p">;</span>
    default_type  application/octet-stream<span class="p">;</span>
   
    sendfile        on<span class="p">;</span>
       
    keepalive_timeout  65<span class="p">;</span>
   
    <span class="c">#gzip  on;</span>
   
    server <span class="o">{</span>
        listen       80<span class="p">;</span>
        server_name  localhost<span class="p">;</span>
   
        location / <span class="o">{</span>
            root   html<span class="p">;</span>
            index  index.html index.htm<span class="p">;</span>
        <span class="o">}</span>
           
        error_page   500 502 503 504  /50x.html<span class="p">;</span>
        location <span class="o">=</span> /50x.html <span class="o">{</span>
            root   html<span class="p">;</span>
        <span class="o">}</span>
         
        <span class="c"># ocation /group1/M00/ï¼šgroup1ä¸ºnginx æœåŠ¡FastDFSçš„åˆ†ç»„åç§°</span>
        <span class="c"># M00æ˜¯FastDFSè‡ªåŠ¨ç”Ÿæˆç¼–å·ï¼Œå¯¹åº”store_path0=/home/silhouette/FastDFS/fdfs_storage</span>
        <span class="c"># å¦‚æœFastDFSå®šä¹‰store_path1ï¼Œè¿™é‡Œå°±æ˜¯M01</span>
        location ~/group1/M00/<span class="o">{</span>
             root /home/silhouette/FastDFS/fdfs_storage/data<span class="p">;</span>
             ngx_fastdfs_module<span class="p">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>æµ‹è¯•</p>

    <ul>
      <li>
        <p>ä¸Šè¿°æˆ‘ä»¬å·²ç»ç»™æœåŠ¡å™¨ä¸­æ·»åŠ è¿‡å›¾ç‰‡ï¼Œç°åœ¨å°±å¯ä»¥ç›´æ¥é€šè¿‡æµè§ˆå™¨æ¥ç›´æ¥è®¿é—® storageï¼š</p>

        <pre><code class="language-txt">http://192.168.30.201/group1/M00/00/00/wKgeyV7fLNyAci5dAABdrZgsqUU078.jpg
</code></pre>

        <p><img src="/img/images/fastDFS/00/09-æµ‹è¯•æ•ˆæœå›¾.png" /></p>
      </li>
    </ul>
  </li>
</ol>

<h4 id="143-å›¾ç‰‡æœåŠ¡å™¨çš„è¿ç§»å®‰è£…">1.4.3 å›¾ç‰‡æœåŠ¡å™¨çš„è¿ç§»å®‰è£…</h4>

<ol>
  <li>
    <p>ç¼–è¾‘ç½‘ç»œ</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># æŸ¥çœ‹å½“å‰è™šæ‹Ÿæœºç½‘ç»œï¼Œå¹¶ä¿æŒç½‘ç»œç•…é€š</span>
<span class="nv">$ </span>ip addr
</code></pre></div>    </div>
  </li>
  <li>
    <p>ç¼–è¾‘æ–‡ä»¶</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vi /etc/fdfs/storage.conf
<span class="c"># ä¿®æ”¹ä¸ºå½“å‰è™šæ‹Ÿæœºçš„IP</span>
<span class="nv">tracker_server</span><span class="o">=</span>192.168.30.201:22122
   
<span class="nv">$ </span>vi /usr/local/nginx/conf/nginx.conf
<span class="c"># ä¿®æ”¹ä¸ºå½“å‰è™šæ‹Ÿæœºçš„IP</span>
 server<span class="o">{</span>
        listen            80<span class="p">;</span>
        server_name      192.168.30.201<span class="p">;</span>
           
        location ~/group1/M00/<span class="o">{</span>
             root /home/silhouette/FastDFS/fdfs_storage/data<span class="p">;</span>
             ngx_fastdfs_module<span class="p">;</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ç¼–å†™ä¸€é”®å¯åŠ¨çš„æ‰¹å¤„ç†æ–‡ä»¶</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> vim start-all.sh
<span class="c"># åœ¨æ–‡ä»¶ä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤</span>
/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart
/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart
<span class="nb">cd</span> /usr/local/nginx/sbin
./nginx
<span class="nb">cd</span> ~
   
<span class="c"># ä¿®æ”¹æ–‡ä»¶æƒé™</span>
<span class="nb">chmod </span>u+x start-all.sh
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="15-java-å®¢æˆ·ç«¯ä½¿ç”¨å›¾ç‰‡æœåŠ¡å™¨">1.5 Java å®¢æˆ·ç«¯ä½¿ç”¨å›¾ç‰‡æœåŠ¡å™¨</h3>

<ol>
  <li>
    <p>æ·»åŠ ç¯å¢ƒä¾èµ–</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">&lt;!-- fastDFSClient --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>fastdfs_client<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>fastdfs_client<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.25<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ä½¿ç”¨åŸç”Ÿçš„æ–¹å¼è¿›è¡Œä¸Šä¼ æ“ä½œ</p>

    <ol>
      <li>
        <p>æ·»åŠ é…ç½®æ–‡ä»¶</p>

        <div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">connect_timeout</span> = <span class="m">2</span>
<span class="n">network_timeout</span> = <span class="m">30</span>
<span class="n">charset</span> = <span class="n">ISO8859</span>-<span class="m">1</span>
<span class="n">http</span>.<span class="n">tracker_http_port</span> = <span class="m">8080</span>
<span class="n">http</span>.<span class="n">anti_steal_token</span> = <span class="n">no</span>
<span class="n">http</span>.<span class="n">secret_key</span> = <span class="n">FastDFS1234567890</span>
      
<span class="n">tracker_server</span> = <span class="m">192</span>.<span class="m">168</span>.<span class="m">30</span>.<span class="m">201</span>:<span class="m">22122</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>æµ‹è¯•</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUpload</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">MyException</span> <span class="o">{</span>
  <span class="c1">//åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚æ–‡ä»¶åä»»æ„ã€‚å†…å®¹å°±æ˜¯ tracker æœåŠ¡å™¨çš„åœ°å€ã€‚</span>
  <span class="c1">//ä½¿ç”¨å…¨å±€å¯¹è±¡åŠ è½½é…ç½®æ–‡ä»¶ã€‚</span>
  <span class="nc">ClientGlobal</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="s">"/Users/silhouette/git_demo/egobuy/"</span> <span class="o">+</span>
                       <span class="s">"egobuy-common/src/test/resources/client.conf"</span><span class="o">);</span>
  <span class="c1">//åˆ›å»ºä¸€ä¸ª TrackerClient å¯¹è±¡</span>
  <span class="nc">TrackerClient</span> <span class="n">trackerClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TrackerClient</span><span class="o">();</span>
  <span class="c1">//é€šè¿‡ TrackClient è·å¾—ä¸€ä¸ª TrackerServer å¯¹è±¡</span>
  <span class="nc">TrackerServer</span> <span class="n">trackerServer</span> <span class="o">=</span> <span class="n">trackerClient</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
  <span class="c1">//åˆ›å»ºä¸€ä¸ª StrorageServer çš„å¼•ç”¨ï¼Œå¯ä»¥æ˜¯ null</span>
  <span class="nc">StorageServer</span> <span class="n">storageServer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="c1">//åˆ›å»ºä¸€ä¸ª StorageClient ï¼Œå‚æ•°éœ€è¦ TrackerServer å’Œ StrorageServer</span>
  <span class="nc">StorageClient</span> <span class="n">storageClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StorageClient</span><span class="o">(</span><span class="n">trackerServer</span><span class="o">,</span> <span class="n">storageServer</span><span class="o">);</span>
  <span class="c1">//ä½¿ç”¨ StorageClient ä¸Šä¼ æ–‡ä»¶ã€‚</span>
  <span class="nc">String</span><span class="o">[]</span> <span class="n">strings</span> <span class="o">=</span><span class="n">storageClient</span><span class="o">.</span><span class="na">upload_file</span><span class="o">(</span><span class="s">"/Users/silhouette/Pictures/pap.er"</span>          
                        <span class="o">+</span><span class="s">"/2018_10_11_11_06_IMG_4257.JPG"</span><span class="o">,</span> <span class="s">"jpg"</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
      
  <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">string</span> <span class="o">:</span> <span class="n">strings</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">string</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>æŸ¥çœ‹æ•ˆæœ</p>

        <ol>
          <li>
            <p>è¿è¡Œç»“æœ</p>

            <p><img src="/img/images/fastDFS/00/10-è¿è¡Œç»“æœ.png" /></p>
          </li>
          <li>
            <p>é€šè¿‡æµè§ˆå™¨æŸ¥çœ‹</p>

            <p><img src="/img/images/fastDFS/00/11-æµè§ˆå™¨æŸ¥çœ‹.png" /></p>
          </li>
        </ol>
      </li>
    </ol>
  </li>
  <li>
    <p>ä½¿ç”¨å·¥å…·ç±»è¿›è¡Œä¸Šä¼ æ“ä½œ</p>

    <ol>
      <li>
        <p>æ·»åŠ å·¥å…·ç±»</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FastDFSClient</span> <span class="o">{</span>
      
    <span class="kd">private</span> <span class="nc">TrackerClient</span> <span class="n">trackerClient</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">TrackerServer</span> <span class="n">trackerServer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">StorageServer</span> <span class="n">storageServer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">StorageClient1</span> <span class="n">storageClient</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      
    <span class="kd">public</span> <span class="nf">FastDFSClient</span><span class="o">(</span><span class="nc">String</span> <span class="n">conf</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">//"classpath:conf/client.conf"</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">conf</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"classpath:"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="s">"classpath:"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getResource</span><span class="o">(</span><span class="s">"/"</span><span class="o">).</span><span class="na">getPath</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="nc">ClientGlobal</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">conf</span><span class="o">);</span>
        <span class="n">trackerClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TrackerClient</span><span class="o">();</span>
        <span class="n">trackerServer</span> <span class="o">=</span> <span class="n">trackerClient</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
        <span class="n">storageServer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">storageClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StorageClient1</span><span class="o">(</span><span class="n">trackerServer</span><span class="o">,</span> <span class="n">storageServer</span><span class="o">);</span>
    <span class="o">}</span>
      
    <span class="cm">/**
     *
     * @Title: uploadFile
     * @Description: TODO ä¸Šä¼ æ–‡ä»¶çš„æ–¹æ³•
     * @param fileName
     * @param extName
     * @param metas
     * @return
     * @throws Exception
     */</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">uploadFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">fileName</span><span class="o">,</span> <span class="nc">String</span> <span class="n">extName</span><span class="o">,</span> <span class="nc">NameValuePair</span><span class="o">[]</span> <span class="n">metas</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">storageClient</span><span class="o">.</span><span class="na">upload_file1</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">extName</span><span class="o">,</span> <span class="n">metas</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
      
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">uploadFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">uploadFile</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
      
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">uploadFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">fileName</span><span class="o">,</span> <span class="nc">String</span> <span class="n">extName</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">uploadFile</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">extName</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
      
    <span class="cm">/**
     *
     * @Title: uploadFile
     * @Description: TODO ä¸Šä¼ æ–‡ä»¶çš„æ–¹æ³•
     * @param fileContent
     * @param extName
     * @param metas
     * @return
     * @throws Exception
     */</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">uploadFile</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">fileContent</span><span class="o">,</span> <span class="nc">String</span> <span class="n">extName</span><span class="o">,</span> <span class="nc">NameValuePair</span><span class="o">[]</span> <span class="n">metas</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      
        <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">storageClient</span><span class="o">.</span><span class="na">upload_file1</span><span class="o">(</span><span class="n">fileContent</span><span class="o">,</span> <span class="n">extName</span><span class="o">,</span> <span class="n">metas</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
      
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">uploadFile</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">fileContent</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">uploadFile</span><span class="o">(</span><span class="n">fileContent</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
      
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">uploadFile</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">fileContent</span><span class="o">,</span> <span class="nc">String</span> <span class="n">extName</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">uploadFile</span><span class="o">(</span><span class="n">fileContent</span><span class="o">,</span> <span class="n">extName</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>æµ‹è¯•</p>

        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUploadByClient</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
  <span class="nc">FastDFSClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FastDFSClient</span><span class="o">(</span> <span class="s">"/Users/silhouette/git_demo/egobuy/"</span> <span class="o">+</span> 
                                           <span class="s">"egobuy-common/src/test/resources/client.conf"</span><span class="o">);</span>
  <span class="nc">String</span> <span class="n">file</span> <span class="o">=</span> <span class="n">client</span> <span class="o">.</span><span class="na">uploadFile</span><span class="o">(</span> 
    <span class="s">"/Users/silhouette/Pictures/pap.er/2019_06_16_18_36_IMG_4666.JPG"</span><span class="o">);</span>
      
  <span class="nc">System</span><span class="o">.</span> <span class="n">out</span> <span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="n">file</span><span class="o">);</span>
      
<span class="o">}</span>
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ol>
:ET