I"h“<h2 id="ä¸€solrcloud-æ¦‚è¿°">ä¸€ã€SolrCloud æ¦‚è¿°</h2>

<h3 id="11-ä»€ä¹ˆæ˜¯-solrcloud">1.1 ä»€ä¹ˆæ˜¯ SolrCloud</h3>

<p>å•ç‚¹çš„ Solr æœåŠ¡çš„é—®é¢˜ï¼š</p>

<ul>
  <li>èƒ½å­˜å‚¨çš„æ•°æ®é‡æœ‰é™ï¼Œå¦‚æœæ˜¯æµ·é‡æ•°æ®ï¼Œæ— æ³•å­˜å‚¨</li>
  <li>å®¹æ˜“å‡ºç°å•ç‚¹æ•…éšœ</li>
  <li>å¯¹é«˜å¹¶å‘çš„å¤„ç†èƒ½åŠ›å·®</li>
</ul>

<p>å¦‚æœæˆ‘ä»¬çš„éœ€è¦å¤„ç†æµ·é‡æ•°æ®ã€åº”å¯¹é«˜å¹¶å‘è¯·æ±‚ï¼Œå¹¶ä¸”è®©æˆ‘ä»¬çš„æœåŠ¡å®ç°é«˜å¯ç”¨ã€‚é‚£ä¹ˆä¹…å¿…é¡»æ­å»º<code class="highlighter-rouge">SolrCloud</code>äº†ã€‚åä¹‹ï¼Œå¦‚æœæ•°æ®é‡å¾ˆå°ï¼Œè¯·æ±‚å¹¶å‘ä½çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸éœ€è¦ SolrColud çš„ï¼Œå•ç‚¹ Solr ä¹…å¤Ÿäº†ã€‚</p>

<p><code class="highlighter-rouge">SolrCloud(solräº‘)</code>ï¼šæ˜¯<code class="highlighter-rouge">Solr</code> æä¾›çš„åˆ†å¸ƒå¼æœç´¢æ–¹æ¡ˆï¼Œå¯ä»¥è§£å†³æµ·é‡æ•°æ®çš„åˆ†å¸ƒå¼å…¨æ–‡æ£€ç´¢ï¼Œå› ä¸ºæ­å»ºäº†é›†ç¾¤ï¼Œå› æ­¤å…·å¤‡äº†é«˜å¯ç”¨çš„ç‰¹æ€§ï¼ŒåŒæ—¶å¯¹æ•°æ®è¿›è¡Œä¸»ä»å¤‡ä»½ï¼Œé¿å…äº†å•ç‚¹æ•…éšœé—®é¢˜ã€‚å¯ä»¥åšåˆ°æ•°æ®çš„å¿«é€Ÿæ¢å¤ã€‚å¹¶ä¸”å¯ä»¥åŠ¨æ€çš„æ·»åŠ æ–°çš„èŠ‚ç‚¹ï¼Œå†å¯¹æ•°æ®è¿›è¡Œå¹³è¡¡ã€‚</p>

<p>SolrCloud æ˜¯åŸºäº Solr å’Œ Zookeeper çš„åˆ†å¸ƒå¼æœç´¢æ–¹æ¡ˆï¼Œå®ƒçš„ä¸»è¦æ€æƒ³æ˜¯ä½¿ç”¨ Zookeeper ä½œä¸ºé›†ç¾¤çš„é…ç½®ä¿¡æ¯ä¸­å¿ƒã€‚å®ƒçš„å‡ ä¸ªç‰¹è‰²åŠŸèƒ½ï¼š</p>

<ol>
  <li>é›†ä¸­å¼çš„é…ç½®ä¿¡æ¯</li>
  <li>è‡ªåŠ¨å®¹é”™</li>
  <li>è¿‘å®æ—¶æœç´¢</li>
  <li>æŸ¥è¯¢æ—¶è‡ªåŠ¨è´Ÿè½½å‡è¡¡</li>
</ol>

<h3 id="12-solr-é›†ç¾¤çš„ç³»ç»Ÿæ¶æ„">1.2 Solr é›†ç¾¤çš„ç³»ç»Ÿæ¶æ„</h3>

<p><img src="/img/images/Full-text_Search/solr/01/01-solré›†ç¾¤çš„ç³»ç»Ÿæ¶æ„.png" /></p>

<h4 id="121-ç‰©ç†ç»“æ„">1.2.1 ç‰©ç†ç»“æ„</h4>

<p>ä¸‰ä¸ª Solr å®ä¾‹(æ¯ä¸ªå®ä¾‹åŒ…æ‹¬ä¸¤ä¸ª Core)ï¼Œç»„æˆä¸€ä¸ª SolrCloudã€‚</p>

<h4 id="122-é€»è¾‘ç»“æ„">1.2.2 é€»è¾‘ç»“æ„</h4>

<p>ç´¢å¼•é›†åˆåŒ…æ‹¬ä¸¤ä¸ª Shard (shard1 å’Œ shard2)ï¼Œshard1å’Œshard2 åˆ†åˆ«ç”±ä¸‰ä¸ªCore ç»„æˆï¼Œå…¶ä¸­ä¸€ä¸ª Leader è¿ä¸ª Replicationï¼ŒLeaderæ˜¯ç”± Zookeeper é€‰ä¸¾äº§ç”Ÿï¼ŒZookeeperæ§åˆ¶æ¯ä¸ªshard ä¸Šä¸‰ä¸ª Core çš„ç´¢å¼•æ•°æ®ä¸€è‡´ï¼Œè§£å†³é«˜å¯ç”¨é—®é¢˜ã€‚</p>

<p>ç”¨æˆ·å‘èµ·ç´¢å¼•è¯·æ±‚åˆ†åˆ«ä» shard1 å’Œshard2 ä¸Šè·å–ï¼Œè§£å†³é«˜å¹¶å‘é—®é¢˜ã€‚</p>

<h4 id="123-solrcloud-ç»“æ„ç®€ä»‹">1.2.3 SolrCloud ç»“æ„ç®€ä»‹</h4>

<p>ä¸ºäº†å®ç°æµ·é‡æ•°æ®çš„å­˜å‚¨ï¼Œæˆ‘ä»¬ä¼šæŠŠç´¢å¼•è¿›è¡Œåˆ†å±‚(<code class="highlighter-rouge">Shard</code>)ï¼ŒæŠŠåˆ†ç‰‡åçš„æ•°æ®å­˜å‚¨åˆ°ä¸åŒçš„ Solr èŠ‚ç‚¹ã€‚ä¸ºäº†ä¿è¯èŠ‚ç‚¹æ•°æ®çš„é«˜å¯ç”¨ï¼Œé¿å…å•ç‚¹æ•…éšœï¼Œæˆ‘ä»¬åˆä¼šå¯¹æ¯ä¸€ä¸ª Shard è¿›è¡Œå¤åˆ¶ï¼Œäº§ç”Ÿå¾ˆå¤šå‰¯æœ¬(<code class="highlighter-rouge">Replication</code>)ï¼Œæ¯ä¸€ä¸ªå‰¯æœ¬å¯¹äºä¸€ä¸ª Solr èŠ‚ç‚¹ä¸­çš„ä¸€ä¸ª coreã€‚ç”¨æˆ·è®¿é—®çš„æ—¶å€™ï¼Œå¯ä»¥è®¿é—®ä»»ä½•ä¸€ä¸ªä¼šè¢«è‡ªåŠ¨åˆ†é…åˆ°ä»»ä½•ä¸€ä¸ªå¯ç”¨å‰¯æœ¬è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™æ ·ä¹…å®ç°äº†è´Ÿè½½å‡è¡¡ã€‚</p>

<p><img src="/img/images/Full-text_Search/solr/00/06-SolrCloud.png" /></p>

<ul>
  <li>Collectionï¼šåœ¨SolrCloudé›†ç¾¤ä¸­é€»è¾‘æ„ä¹‰ä¸Šçš„å®Œæ•´çš„ç´¢å¼•ã€‚ä¸€èˆ¬ä¼šåŒ…å«å¤šä¸ªShardï¼ˆåˆ†ç‰‡ï¼‰ï¼Œå¦‚æœå¤§äº1ä¸ªåˆ†ç‰‡ï¼Œé‚£ä¹ˆå°±æ˜¯åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå®ƒä»¬ä½¿ç”¨ç›¸åŒçš„é…ç½®ä¿¡æ¯</li>
  <li>Coreï¼šæ¯ä¸ª Core æ˜¯ Solr ä¸­ä¸€ä¸ªç‹¬ç«‹è¿è¡Œå•å…ƒï¼Œæä¾›ç´¢å¼•å’Œæœç´¢æœåŠ¡ã€‚ä¸€ä¸ªshard éœ€è¦ç”±ä¸€ä¸ª Core æˆ–å¤šä¸ª Core ç»„æˆã€‚ç”±äº Collectionç”±å¤šä¸ª shardç»„æˆæ‰€ä»¥collectionä¸€èˆ¬ç”±å¤šä¸ª coreç»„æˆã€‚</li>
  <li>Shard: Collectionçš„é€»è¾‘åˆ†ç‰‡ã€‚æ¯ä¸ªShardè¢«åŒ–æˆä¸€ä¸ªæˆ–è€…å¤šä¸ªreplicationï¼ˆå‰¯æœ¬ï¼‰ï¼Œé€šè¿‡é€‰ä¸¾ç¡®å®šå“ªä¸ªæ˜¯Leaderï¼ˆä¸»ï¼‰ï¼Œå…¶å®ƒä¸ºä»</li>
  <li>Replica: Shardçš„ä¸€ä¸ªå‰¯æœ¬ï¼Œå­˜å‚¨åœ¨Solré›†ç¾¤çš„æŸä¸€å°æœºå™¨ä¸­ï¼ˆå°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œå¯¹åº”è¿™å°Solrçš„ä¸€ä¸ªCoreã€‚</li>
  <li>Leader: èµ¢å¾—é€‰ä¸¾çš„Shard replicationã€‚æ¯ä¸ªShardæœ‰å¤šä¸ªReplicationï¼Œè¿™å‡ ä¸ªReplicationéœ€è¦é€‰ä¸¾æ¥ç¡®å®šä¸€ä¸ªLeaderã€‚é€‰ä¸¾å¯ä»¥å‘ç”Ÿåœ¨ä»»ä½•æ—¶é—´ï¼Œä½†æ˜¯é€šå¸¸ä»–ä»¬ä»…åœ¨æŸä¸ªSolrå®ä¾‹å‘ç”Ÿæ•…éšœæ—¶æ‰ä¼šè§¦å‘ã€‚å½“ç´¢å¼•documentsæ—¶ï¼ŒSolrCloudä¼šä¼ é€’å®ƒä»¬åˆ°æ­¤Shardå¯¹åº”çš„leaderï¼Œleaderå†åˆ†å‘å®ƒä»¬åˆ°å…¨éƒ¨Shardçš„replicationã€‚</li>
  <li>Master&amp;Slaveï¼šMaster æ˜¯ master-slave ç»“æ„ä¸­çš„ä¸»ç»“ç‚¹ï¼ˆé€šå¸¸è¯´ä¸»æœåŠ¡å™¨ï¼‰ï¼ŒSlave æ˜¯ master -slave ç»“æ„ ä¸­çš„ä»ç»“ç‚¹ï¼ˆé€šå¸¸è¯´ä»æœåŠ¡å™¨æˆ–å¤‡æœåŠ¡å™¨ï¼‰ã€‚åŒä¸€ä¸ª Shard ä¸‹ master å’Œ slave å­˜å‚¨çš„æ•°æ®æ˜¯ ä¸€è‡´çš„ï¼Œè¿™æ˜¯ä¸ºäº†è¾¾åˆ°é«˜å¯ç”¨ç›®çš„ã€‚</li>
</ul>

<h3 id="13-solrcloud-çš„æ­å»º">1.3 SolrCloud çš„æ­å»º</h3>

<h4 id="131-éœ€è¦å®ç°çš„solr-é›†ç¾¤ç»“æ„">1.3.1 éœ€è¦å®ç°çš„solr é›†ç¾¤ç»“æ„</h4>

<p><img src="/img/images/Full-text_Search/solr/01/02-solré›†ç¾¤æ¶æ„.png" /></p>

<p>Zookeeper ä½œä¸ºé›†ç¾¤çš„ç®¡ç†å·¥å…·ã€‚ä¸»è¦èµ·åˆ°ï¼šé›†ç¾¤ç®¡ç†ï¼šå®¹é”™ã€è´Ÿè½½å‡è¡¡ã€‚é…ç½®æ–‡ä»¶çš„é›†ä¸­ç®¡ç†å’Œé›†ç¾¤çš„å…¥å£ã€‚è¦å®ç° Zookeeper é«˜å¯ç”¨ï¼Œéœ€è¦æ­å»ºé›†ç¾¤ï¼Œå»ºè®®æ˜¯å¥‡æ•°èŠ‚ç‚¹ã€‚éœ€è¦ä¸‰ä¸ª ZookeeperæœåŠ¡å™¨ã€‚</p>

<p>æ­å»º solré›†ç¾¤éœ€è¦ä¸ƒå°æœåŠ¡å™¨ï¼šä¸‰ä¸ªzookeepèŠ‚ç‚¹å’Œå››ä¸ªtomcaté˜¶æ®µã€‚</p>

<h4 id="132-zookeeper-é›†ç¾¤çš„æ­å»º">1.3.2 Zookeeper é›†ç¾¤çš„æ­å»º</h4>

<ol>
  <li>
    <p>Zookeeperéœ€è¦å®‰è£… JDK ç¯å¢ƒ</p>
  </li>
  <li>
    <p>æŠŠ Zookeeper çš„å‹ç¼©åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹ç¼©</p>
  </li>
  <li>
    <p>æŠŠzookeepå¤åˆ¶ä¸‰åˆ†</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /home/silhouette
<span class="nv">$ </span><span class="nb">mkdir </span>solr-cloud
<span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-r</span> zookeeper-3.4.5 /home/silhouette/solr-cloud/zookeeper01
<span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-r</span> zookeeper-3.4.5 /home/silhouette/solr-cloud/zookeeper02
<span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-r</span> zookeeper-3.4.5 /home/silhouette/solr-cloud/zookeeper03
</code></pre></div>    </div>
  </li>
  <li>
    <p>åœ¨æ¯ä¸ªzookeeper ç›®å½•ä¸‹åˆ›å»ºdataç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª myid æ–‡ä»¶ï¼Œå†…å®¹å°±æ˜¯æ¯ä¸ªå®ä¾‹çš„idã€‚ä¾‹å¦‚ 1ã€2ã€3â€¦.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir</span> /home/silhouette/solr-cloud/zookeeper01/data
<span class="nv">$ </span><span class="nb">echo </span>1 <span class="o">&gt;&gt;</span> /home/silhouette/solr-cloud/zookeeper01/data/myid
<span class="nv">$ </span><span class="nb">mkdir</span> /home/silhouette/solr-cloud/zookeeper02/data
<span class="nv">$ </span><span class="nb">echo </span>2 <span class="o">&gt;&gt;</span> /home/silhouette/solr-cloud/zookeeper02/data/myid
<span class="nv">$ </span><span class="nb">mkdir</span> /home/silhouette/solr-cloud/zookeeper03/data
<span class="nv">$ </span><span class="nb">echo </span>3 <span class="o">&gt;&gt;</span> /home/silhouette/solr-cloud/zookeeper03/data/myid
</code></pre></div>    </div>
  </li>
  <li>
    <p>ä¿®æ”¹æ¯ä¸ªzookeeper çš„é…ç½®æ–‡ä»¶ã€‚</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># æŠŠ conf ç›®å½•ä¸‹çš„ zoo_sample.cfg æ–‡ä»¶æ”¹åä¸º zoo.cfg</span>
<span class="nv">$ </span> <span class="nb">cp</span> /home/silhouette/solr-cloud/zookeeper01/conf/zoo_sample.cfg /home/silhouette/solr-cloud/zookeeper01/conf/zoo.cfg
<span class="nv">$ </span> <span class="nb">cp</span> /home/silhouette/solr-cloud/zookeeper02/conf/zoo_sample.cfg /home/silhouette/solr-cloud/zookeeper02/conf/zoo.cfg
<span class="nv">$ </span> <span class="nb">cp</span> /home/silhouette/solr-cloud/zookeeper03/conf/zoo_sample.cfg /home/silhouette/solr-cloud/zookeeper03/conf/zoo.cfg
<span class="c">## ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š</span>
<span class="c"># 1.ä¿®æ”¹ä¿å­˜æ•°æ®çš„ç›®å½•</span>
<span class="nv">dataDir</span><span class="o">=</span>/home/silhouette/solr-cloud/zookeeper01/data
<span class="c"># 2.ä¿®æ”¹å®¢æˆ·ç«¯è¿æ¥zookeeperçš„ç«¯å£ä¿è¯æ¯ä¸ªå®ä¾‹éƒ½ä¸å†²çª</span>
<span class="nv">clientPort</span><span class="o">=</span>2181
<span class="c"># 3.é›†ç¾¤ä¸­èŠ‚ç‚¹åˆ—è¡¨ã€‚1ã€2ã€3è¡¨ç¤ºèŠ‚ç‚¹IDï¼ŒIPåçš„ç¬¬ä¸€ä¸ªç«¯å£ä¸ºzookeeperä¸­çš„å†…å®¹éƒ¨é€šä¿¡ç«¯å£ï¼Œç¬¬äºŒä¸ªä½æŠ•ç¥¨ç«¯å£ï¼Œæ¯ä¸ªç«¯å£éƒ½ä¸èƒ½é‡å¤</span>
server.1<span class="o">=</span>192.168.0.108:2001:3001
server.2<span class="o">=</span>192.168.0.108:2002:3002
server.3<span class="o">=</span>192.168.0.108:2003:3003
</code></pre></div>    </div>
  </li>
  <li>
    <p>å¯åŠ¨æ¯ä¸ªzookeeperå®ä¾‹</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /home/silhouette/solr-cloud
<span class="nv">$ </span>vim start-zookeeper-all.sh
<span class="c"># æ·»åŠ æ‰¹å¤„ç†æŒ‡ä»¤</span>
<span class="nb">cd </span>zookeeper01/bin
./zkServer.sh start
<span class="nb">cd</span> ../../
<span class="nb">cd </span>zookeeper02/bin
./zkServer.sh start
<span class="nb">cd</span> ../../
<span class="nb">cd </span>zookeeper03/bin
./zkServer.sh start
<span class="nb">cd</span> ../../
</code></pre></div>    </div>
  </li>
  <li>
    <p>ä¿®æ”¹æ‰¹å¤„ç†æ–‡ä»¶æƒé™</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">chmod </span>u+x start-zookeeper-all.sh 
</code></pre></div>    </div>
  </li>
  <li>
    <p>å¯åŠ¨zookeeperå¹¶æŸ¥çœ‹ zookeeper çš„çŠ¶æ€</p>

    <p><img src="/img/images/Full-text_Search/solr/01/03-zookeeperé›†ç¾¤.png" /></p>
  </li>
</ol>

<h4 id="133-solré›†ç¾¤çš„æ­å»º">1.3.3 Solré›†ç¾¤çš„æ­å»º</h4>

<ol>
  <li>
    <p>åˆ›å»ºå››ä¸ªtomcatå®ä¾‹ã€‚æ¯ä¸ªtomcatè¿è¡Œåœ¨ä¸åŒçš„ç«¯å£ã€‚</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-r</span> /home/silhouette/apache-tomcat-8.5.38 /home/silhouette/solr-cloud/tomcat01
<span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-r</span> /home/silhouette/apache-tomcat-8.5.38 /home/silhouette/solr-cloud/tomcat02
<span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-r</span> /home/silhouette/apache-tomcat-8.5.38 /home/silhouette/solr-cloud/tomcat03
<span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-r</span> /home/silhouette/apache-tomcat-8.5.38 /home/silhouette/solr-cloud/tomcat04
<span class="c"># ä¿®æ”¹tomcatç«¯å£å·ï¼š8180ã€8280ã€8380ã€8480</span>
<span class="nv">$ </span>vim /home/silhouette/solr-cloud/tomcat01/conf/server.xml
</code></pre></div>    </div>
  </li>
  <li>
    <p>éƒ¨ç½² solr çš„ war åŒ…ã€‚æŠŠå•æœºç‰ˆçš„solr å¤åˆ¶åˆ°é›†ç¾¤çš„tomcatä¸­</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> <span class="nb">cp</span> <span class="nt">-r</span> /home/silhouette/apache-tomcat-8.5.38/webapps/solr tomcat01/webapps/solr
<span class="nv">$ </span> <span class="nb">cp</span> <span class="nt">-r</span> /home/silhouette/apache-tomcat-8.5.38/webapps/solr tomcat02/webapps/solr
<span class="nv">$ </span> <span class="nb">cp</span> <span class="nt">-r</span> /home/silhouette/apache-tomcat-8.5.38/webapps/solr tomcat03/webapps/solr
<span class="nv">$ </span> <span class="nb">cp</span> <span class="nt">-r</span> /home/silhouette/apache-tomcat-8.5.38/webapps/solr tomcat04/webapps/solr
</code></pre></div>    </div>
  </li>
  <li>
    <p>ä¸ºæ¯ä¸ª solr å®ä¾‹åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„solrhomeã€‚</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> <span class="nb">cp</span> <span class="nt">-r</span> /home/silhouette/solr-index solrhome01
<span class="nv">$ </span> <span class="nb">cp</span> <span class="nt">-r</span> /home/silhouette/solr-index solrhome02
<span class="nv">$ </span> <span class="nb">cp</span> <span class="nt">-r</span> /home/silhouette/solr-index solrhome03
<span class="nv">$ </span> <span class="nb">cp</span> <span class="nt">-r</span> /home/silhouette/solr-index solrhome04
</code></pre></div>    </div>
  </li>
  <li>
    <p>ä¿®æ”¹solr çš„web.xmlæ–‡ä»¶ï¼Œå°†solrhome å…³è”èµ·æ¥</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> vim tomcat01/webapps/solr/WEB-INF/web.xml 
<span class="c">## å°†solrhome å…³è”èµ·æ¥</span>
 &lt;env-entry&gt;
   &lt;env-entry-name&gt;solr/home&lt;/env-entry-name&gt;
   &lt;env-entry-value&gt;/home/silhouette/solr-cloud/solrhome01/solr&lt;/env-entry-value&gt;
   &lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;
 &lt;/env-entry&gt;
<span class="c">#å°†å…¶ä»–çš„tomcatä¹Ÿå°†solrhome è¿›è¡Œå…³è”</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>é…ç½® solrCloud ç›¸å…³çš„é…ç½®</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># æ¯ä¸ª solrhome ä¸‹éƒ½æœ‰ä¸€ä¸ª solr.xmlï¼ŒæŠŠå…¶ä¸­çš„ ip åŠç«¯å£å·é…ç½®å¥½ã€‚æ³¨æ„ï¼šæ­¤å¤„çš„ç«¯å£å·æ˜¯tomcatçš„å¯åŠ¨ç«¯å£å·</span>
<span class="nv">$ </span>vim solrhome01/solr/solr.xml
<span class="c"># ä¿®æ”¹å†…å®¹å¦‚ä¸‹</span>
&lt;solrcloud&gt;
    &lt;str <span class="nv">name</span><span class="o">=</span><span class="s2">"host"</span><span class="o">&gt;</span>192.168.0.108&lt;/str&gt;
    &lt;int <span class="nv">name</span><span class="o">=</span><span class="s2">"hostPort"</span><span class="o">&gt;</span>8180&lt;/int&gt;
    &lt;str <span class="nv">name</span><span class="o">=</span><span class="s2">"hostContext"</span><span class="o">&gt;</span><span class="k">${</span><span class="nv">hostContext</span>:solr<span class="k">}</span>&lt;/str&gt;
    &lt;int <span class="nv">name</span><span class="o">=</span><span class="s2">"zkClientTimeout"</span><span class="o">&gt;</span><span class="k">${</span><span class="nv">zkClientTimeout</span>:30000<span class="k">}</span>&lt;/int&gt;
    &lt;bool <span class="nv">name</span><span class="o">=</span><span class="s2">"genericCoreNodeNames"</span><span class="o">&gt;</span><span class="k">${</span><span class="nv">genericCoreNodeNames</span>:true<span class="k">}</span>&lt;/bool&gt;
&lt;/solrcloud&gt;
<span class="c">#å°†å…¶ä»–çš„solrhome åšç›¸ä¼¼é…ç½®</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>è®©zookeeper ç»Ÿä¸€ç®¡ç†é…ç½®æ–‡ä»¶ã€‚éœ€è¦æŠŠ solrhome/solr/collection1/conf ç›®å½•ä¸Šä¼ åˆ° zookeeperã€‚ä¸Šä¼ ä»»æ„ solrhome ä¸­çš„é…ç½®æ–‡ä»¶å³å¯ã€‚</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#  Solræä¾›çš„è®¿é—®Zookeeperçš„è„šæœ¬æ–‡ä»¶ :</span>
<span class="c">#			/home/silhouette/solr-4.10.2/example/scripts/cloud-scripts/zkcli.sh  </span>
<span class="c">#  æŒ‡å®šZookeeper:  </span>
<span class="c">#			-zkhost 192.168.0.109:2181,192.168.0.112:2181,192.168.0.114:2181  </span>
<span class="c">#   -cmd upconfigï¼š æŒ‡å®šæ“ä½œçš„å‘½ä»¤ã€‚è¿™é‡Œæ˜¯ä¸Šä¼ é…ç½®</span>
<span class="c">#  æŒ‡å®šè¦ä¸Šä¼ çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œæˆ‘ä»¬ä¸Šä¼ Solrçš„æ ·ä¾‹ä¸­çš„é…ç½®</span>
<span class="c">#  		confdir /home/silhouette/solr-index/collection1/conf</span>
<span class="c">#   -confname solrconf ï¼šæŒ‡å®šæ³¨å†Œåˆ°Zookeeperä¸­åé…ç½®æ–‡ä»¶ç›®å½•åç§°</span>
<span class="nv">$ </span>sh /home/silhouette/solr-4.10.2/example/scripts/cloud-scripts/zkcli.sh <span class="nt">-zkhost</span> 192.168.0.108:2181,192.168.0.108:2182,192.168.0.108:2183 <span class="nt">-cmd</span> upconfig <span class="nt">-confdir</span> /home/silhouette/solr-cloud/solrhome01/solr/collection1/conf <span class="nt">-confname</span> solrconf
</code></pre></div>    </div>
  </li>
  <li>
    <p>ä¿®æ”¹ tomcat/bin ç›®å½•ä¸‹çš„ catalina.sh æ–‡ä»¶ï¼Œå…³è” solr å’Œ zookeeperã€‚</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim tomcat01/bin/catalina.sh
<span class="c">## æŠŠæ­¤é…ç½®æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­</span>
<span class="nv">JAVA_OPTS</span><span class="o">=</span><span class="s2">"-DzkHost=192.168.11.192:2181,192.168.11.192:2182,192.168.11.192:2183"</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>å¯åŠ¨æ¯ä¸ª tomcat å®ä¾‹ã€‚è¦ä¿è¯ zookeeper é›†ç¾¤æ˜¯å¯åŠ¨çŠ¶æ€ã€‚</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim start-tomcat-all.sh
<span class="c"># ç¼–å†™æ‰¹å¤„ç†æ–‡ä»¶å¯åŠ¨ tomcat</span>
<span class="nb">cd </span>tomcat01/bin
./startup.sh
<span class="nb">cd</span> ../../
<span class="nb">cd </span>tomcat02/bin
./startup.sh
<span class="nb">cd</span> ../../
<span class="nb">cd </span>tomcat03/bin
./startup.sh
<span class="nb">cd</span> ../../
<span class="nb">cd </span>tomcat04/bin
./startup.sh
<span class="nb">cd</span> ../../
</code></pre></div>    </div>
  </li>
  <li>
    <p>ä¿®æ”¹æƒé™å¹¶å¯åŠ¨tomcatè„šæœ¬</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> <span class="nb">chmod </span>u+x start-tomcat-all.sh   
<span class="nv">$ </span>./start-tomcat-all.sh 
</code></pre></div>    </div>
  </li>
  <li>
    <p>è®¿é—®é›†ç¾¤</p>

    <p><img src="/img/images/Full-text_Search/solr/01/04-solrCloud.png" /></p>
  </li>
  <li>
    <p>åˆ›å»ºæ–°çš„ Collection è¿›è¡Œåˆ†ç‰‡å¤„ç†ã€‚</p>

    <pre><code class="language-txt">http://192.168.0.108:8180/solr/admin/colections?action=CREATE&amp;name=collection2&amp;numShards=2&amp;replicationFactor=2
</code></pre>

    <ul>
      <li>
        <p>è¯·æ±‚è¿”å›ç»“æœ</p>

        <p><img src="/img/images/Full-text_Search/solr/01/05-åˆ†ç‰‡å¤„ç†.png" /></p>
      </li>
      <li>
        <p>æ•ˆæœå›¾</p>

        <p><img src="/img/images/Full-text_Search/solr/01/06-æ•ˆæœå›¾.png" /></p>
      </li>
    </ul>
  </li>
  <li>
    <p>åˆ é™¤ä¸ç”¨çš„ Collectionã€‚</p>

    <pre><code class="language-txt">http://192.168.0.108:8180/solr/admin/collections?action=DELETE&amp;name=collection1
</code></pre>

    <ul>
      <li>
        <p>è¯·æ±‚è¿”å›ç»“æœ</p>

        <p><img src="/img/images/Full-text_Search/solr/01/07-åˆ é™¤collection.png" /></p>
      </li>
    </ul>
  </li>
</ol>

<h3 id="14-é€šè¿‡ç®¡ç†ç•Œé¢æŸ¥çœ‹å’Œæ“ä½œsolrcloud">1..4 é€šè¿‡ç®¡ç†ç•Œé¢æŸ¥çœ‹å’Œæ“ä½œSolrCloud</h3>

<ul>
  <li>
    <p>SolrCloudçš„æ“ä½œå‘½ä»¤</p>

    <ul>
      <li>Solré‡‡ç”¨çš„æ˜¯ç±»ä¼¼WebServiceçš„APIæ¥å£ï¼Œé‡‡ç”¨Httpæ–¹å¼è¿›è¡Œè®¿é—®ï¼Œå› æ­¤ï¼Œå…¶æ“ä½œå‘½ä»¤éƒ½æ˜¯ä¸€äº›URLè”æ¥åŠå¯¹åº”å‚æ•°</li>
    </ul>

    <ol>
      <li>
        <p>åˆ›å»ºcoreå‘½ä»¤(åœ¨é¡µé¢çš„Urlä¸­æ‰§è¡Œ)</p>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#å‚æ•°è¯´æ˜ï¼š</span>
<span class="c">#    nameï¼šæŒ‡æ˜collectionåç§°</span>
<span class="c">#    numShardsï¼šæŒ‡æ˜åˆ†ç‰‡æ•°</span>
<span class="c">#    replicationFactorï¼šæŒ‡æ˜å‰¯æœ¬æ•°</span>
<span class="c">#    maxShardsPerNodeï¼š æ¯ä¸ªèŠ‚ç‚¹æœ€å¤§åˆ†ç‰‡æ•°ï¼ˆé»˜è®¤ä¸º1ï¼‰</span>
<span class="c">#    property.schemaï¼šæŒ‡å®šä½¿ç”¨çš„schema.xmlï¼Œè¿™ä¸ªæ–‡ä»¶å¿…é¡»åœ¨zookeeperä¸Šã€‚</span>
<span class="c">#    property.configï¼šæŒ‡å®šä½¿ç”¨çš„solrconfig.xmlï¼Œè¿™ä¸ªæ–‡ä»¶å¿…é¡»åœ¨zookeeperä¸Šã€‚</span>
http://192.168.0.109:8080/solr/admin/collections?action<span class="o">=</span>CREATE&amp;name<span class="o">=</span>myCollection2&amp;numShards<span class="o">=</span>2&amp;
<span class="nv">replicationFactor</span><span class="o">=</span>2&amp;maxShardsPerNode<span class="o">=</span>8&amp;property.schema<span class="o">=</span>schema.xml&amp;property.config<span class="o">=</span>solrconfig.xml
</code></pre></div>        </div>
      </li>
      <li>
        <p>åˆ é™¤Collectionå‘½ä»¤</p>

        <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://192.168.0.108:8180/solr/admin/collections?action=DELETE&amp;name=collection1
</code></pre></div>        </div>
      </li>
      <li>
        <p>æŸ¥è¯¢æ‰€æœ‰çš„Collection</p>

        <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code> http://192.168.0.108:8180/solr/admin/collections?action=LIST
</code></pre></div>        </div>
      </li>
      <li>
        <p>æ˜¾ç¤ºé›†ç¾¤çš„çŠ¶æ€</p>

        <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://192.168.0.108:8180/solr/admin/collections?action=CLUSTERSTATUS
</code></pre></div>        </div>
      </li>
      <li>
        <p>åˆ†è£‚shard</p>

        <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://192.168.0.108:8180/solr/admin/collections?action=SPLITSHARD&amp;collection=myCollection2
&amp;shard=shard2
</code></pre></div>        </div>
      </li>
      <li>
        <p>åˆ é™¤shard</p>

        <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://192.168.0.108:1080/solr/admin/collections?action=DELETESHARD&amp;collection=myCollection2
&amp;shard=shard2
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
  <li>
    <p>SolrCloudæµ‹è¯•</p>

    <ul>
      <li>
        <p>åˆ›å»ºç´¢å¼•ï¼šåœ¨ä¸€å°Solrä¸Šåˆ›å»ºçš„ç´¢å¼•ï¼Œä»å…¶å®ƒsolræœåŠ¡ä¸Šå¯ä»¥æŸ¥è¯¢åˆ°</p>

        <p><img src="/img/images/Full-text_Search/solr/00/09-solrCloudåˆ›å»ºç´¢å¼•.png" /></p>
      </li>
      <li>
        <p>æŸ¥è¯¢ç´¢å¼•ï¼šä»ä»»æ„ä¸€å°Solrä¸ŠæŸ¥è¯¢ç´¢å¼•ï¼Œé€‰æ‹©ä»»æ„çš„ä¸€ä¸ªåˆ†ç‰‡ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªå®Œæ•´çš„ç»“æœ</p>

        <p><img src="/img/images/Full-text_Search/solr/00/10-solrCloudæŸ¥è¯¢ç´¢å¼•.png" /></p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="15-ä½¿ç”¨solrjè®¿é—®solrcloud">1.5 ä½¿ç”¨SolrJè®¿é—®SolrCloud</h3>

<p>ä¸å•æœºSolrç›¸æ¯”ï¼ŒAPIä»…ä»…æ˜¯åœ¨åˆ›å»ºSolrServeræ—¶å‘ç”Ÿäº†æ”¹å˜ï¼Œå…¶å®ƒæ²¡æœ‰å˜åŒ–ã€‚å•æœºé‡‡ç”¨çš„æ˜¯ï¼šHttpSolrServerï¼ŒSolrCloudé‡‡ç”¨çš„æ˜¯ï¼šCloudSolrServerã€‚</p>

<ul>
  <li>
    <p>Mavençš„ä¾èµ–</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.apache.solr<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>solr-solrj<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>4.10.2<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="c">&lt;!-- Solråº•å±‚ä¼šä½¿ç”¨åˆ°slf4jæ—¥å¿—ç³»ç»Ÿ --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.7.22<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>commons-logging<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>commons-logging<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
  	<span class="c">&lt;!-- Junitå•å…ƒæµ‹è¯• --&gt;</span>
  	<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>æ·»åŠ æˆ–ä¿®æ”¹æ•°æ®</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testWrite</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
		<span class="c1">// åˆ›å»ºSolrServer</span>
		<span class="nc">CloudSolrServer</span> <span class="n">server</span> <span class="o">=</span> 
      					<span class="k">new</span> <span class="nf">CloudSolrServer</span><span class="o">(</span><span class="s">"192.168.0.109:2181,192.168.0.112:2181,192.168.0.114:2181"</span><span class="o">);</span>
		<span class="c1">// æŒ‡å®šè¦è®¿é—®çš„Collectionåç§°</span>
		<span class="n">server</span><span class="o">.</span><span class="na">setDefaultCollection</span><span class="o">(</span><span class="s">"collection1"</span><span class="o">);</span>
  		
		<span class="c1">// åˆ›å»ºDocumentå¯¹è±¡</span>
		<span class="nc">SolrInputDocument</span> <span class="n">document</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SolrInputDocument</span><span class="o">();</span>
		<span class="c1">// æ·»åŠ å­—æ®µ</span>
		<span class="n">document</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
		<span class="n">document</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="s">"solrcloudå†™å…¥çš„æ•°æ®"</span><span class="o">);</span>
  		
		<span class="c1">// æ·»åŠ Documentåˆ°Server</span>
		<span class="n">server</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">document</span><span class="o">);</span>
		<span class="c1">// æäº¤</span>
		<span class="n">server</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>åˆ é™¤æ•°æ®</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDelete</span><span class="o">()</span><span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
    <span class="c1">// åˆ›å»ºSolrServer</span>
    <span class="nc">CloudSolrServer</span> <span class="n">server</span> <span class="o">=</span> 
      	<span class="k">new</span> <span class="nf">CloudSolrServer</span><span class="o">(</span><span class="s">"192.168.0.109:2181,192.168.0.112:2181,192.168.0.114:2181"</span><span class="o">);</span>
    <span class="c1">// æŒ‡å®šè¦è®¿é—®çš„Collectionåç§°</span>
    <span class="n">server</span><span class="o">.</span><span class="na">setDefaultCollection</span><span class="o">(</span><span class="s">"collection1"</span><span class="o">);</span>
    <span class="c1">// æ ¹æ®IDåˆ é™¤</span>
    <span class="n">server</span><span class="o">.</span><span class="na">deleteById</span><span class="o">(</span><span class="s">"1"</span><span class="o">);</span>
    <span class="c1">// æäº¤</span>
    <span class="n">server</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>æŸ¥è¯¢æ•°æ®</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSearch</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// åˆ›å»ºSolrServer</span>
    <span class="nc">CloudSolrServer</span> <span class="n">server</span> <span class="o">=</span> 
      	<span class="k">new</span> <span class="nf">CloudSolrServer</span><span class="o">(</span><span class="s">"192.168.0.109:2181,192.168.0.112:2181,192.168.0.114:2181"</span><span class="o">);</span>
    <span class="c1">// æŒ‡å®šè¦è®¿é—®çš„Collectionåç§°</span>
    <span class="n">server</span><span class="o">.</span><span class="na">setDefaultCollection</span><span class="o">(</span><span class="s">"collection1"</span><span class="o">);</span>
  
    <span class="c1">// æŸ¥æ‰¾æ•°æ®</span>
    <span class="nc">QueryResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="k">new</span> <span class="nc">SolrQuery</span><span class="o">(</span><span class="s">"title:solrcloud"</span><span class="o">));</span>
  
    <span class="c1">// ä»¥documentå½¢å¼è§£ææ•°æ®</span>
    <span class="nc">SolrDocumentList</span> <span class="n">documentList</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getResults</span><span class="o">();</span>
    <span class="c1">// éå†</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">SolrDocument</span> <span class="n">solrDocument</span> <span class="o">:</span> <span class="n">documentList</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">solrDocument</span><span class="o">.</span><span class="na">getFieldValue</span><span class="o">(</span><span class="s">"id"</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">solrDocument</span><span class="o">.</span><span class="na">getFieldValue</span><span class="o">(</span><span class="s">"title"</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="16-spring-æ•´åˆ-solrä¸solrcloud">1.6 Spring æ•´åˆ Solrä¸SolrCloud</h4>

<ul>
  <li>
    <p>é…ç½®æ–‡ä»¶ï¼šapplicationContext-solr.xml</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
	<span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span> <span class="na">xmlns:p=</span><span class="s">"http://www.springframework.org/schema/p"</span>
	<span class="na">xmlns:aop=</span><span class="s">"http://www.springframework.org/schema/aop"</span> <span class="na">xmlns:tx=</span><span class="s">"http://www.springframework.org/schema/tx"</span>
	<span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xmlns:dubbo=</span><span class="s">"http://code.alibabatech.com/schema/dubbo"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-4.2.xsd
http://www.springframework.org/schema/context
http://www.springframework.org/schema/context/spring-context-4.2.xsd
http://www.springframework.org/schema/aop
http://www.springframework.org/schema/aop/spring-aop-4.2.xsd
http://www.springframework.org/schema/tx
http://www.springframework.org/schema/tx/spring-tx-4.2.xsd
http://code.alibabatech.com/schema/dubbo
http://code.alibabatech.com/schema/dubbo/dubbo.xsd
http://www.springframework.org/schema/util
http://www.springframework.org/schema/util/spring-util-4.2.xsd"</span><span class="nt">&gt;</span>
	<span class="c">&lt;!-- é…ç½®ä¸€ä¸ªé“¾æ¥å•æœºç‰ˆçš„solrServer --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"solrServer"</span> <span class="na">class=</span><span class="s">"org.apache.solr.client.solrj.impl.HttpSolrServer"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"baseURL"</span> <span class="na">value=</span><span class="s">"http://192.168.0.108:8080/solr/"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
  	
	<span class="c">&lt;!-- é…ç½®é›†ç¾¤ç‰ˆçš„solrServer --&gt;</span>
	<span class="c">&lt;!-- &lt;bean id="cloudSolrServer" class="org.apache.solr.client.solrj.impl.CloudSolrServer"&gt;
		&lt;constructor-arg name="zkHost" value="192.168.0.108:2181,192.168.0.108:2182,192.168.0.108:2183"/&gt;
		é…ç½®é»˜è®¤çš„collection
		&lt;property name="defaultCollection" value="collection2"/&gt;
	&lt;/bean&gt; --&gt;</span>
  
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>æµ‹è¯•ä½¿ç”¨</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nd">@Autowired</span>
<span class="kd">private</span> <span class="nc">SolrServer</span> <span class="n">solrServer</span><span class="o">;</span>
<span class="nd">@Autowired</span>
<span class="kd">private</span> <span class="nc">CloudSolrServer</span> <span class="n">cloudSolrServer</span><span class="o">;</span>
  
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">BuyResult</span> <span class="nf">importItemIndex</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="c1">// ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®åˆ—è¡¨</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SearchItem</span><span class="o">&gt;</span> <span class="n">searchItemList</span> <span class="o">=</span> <span class="n">searchItemMapper</span><span class="o">.</span><span class="na">getSearchItemList</span><span class="o">();</span>
        <span class="c1">// å°†æ•°æ®å¯¼å…¥ç´¢å¼•åº“</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">SearchItem</span> <span class="n">searchItem</span> <span class="o">:</span> <span class="n">searchItemList</span><span class="o">)</span> <span class="o">{</span>
          <span class="c1">// åˆ›å»ºæ–‡æ¡£å¯¹è±¡</span>
          <span class="nc">SolrInputDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SolrInputDocument</span><span class="o">();</span>
          <span class="c1">// è®¾ç½®åŸŸ</span>
          <span class="n">doc</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">searchItem</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
          <span class="n">doc</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="s">"item_title"</span><span class="o">,</span> <span class="n">searchItem</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
          <span class="n">doc</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="s">"item_price"</span><span class="o">,</span> <span class="n">searchItem</span><span class="o">.</span><span class="na">getPrice</span><span class="o">());</span>
          <span class="n">doc</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="s">"item_image"</span><span class="o">,</span> <span class="n">searchItem</span><span class="o">.</span><span class="na">getImage</span><span class="o">());</span>
          <span class="n">doc</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="s">"item_sell_point"</span><span class="o">,</span> <span class="n">searchItem</span><span class="o">.</span><span class="na">getSell_point</span><span class="o">());</span>
          <span class="n">doc</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="s">"item_category_name"</span><span class="o">,</span> <span class="n">searchItem</span><span class="o">.</span><span class="na">getCategory_name</span><span class="o">());</span>
          <span class="c1">// å°†æ–‡æ¡£åŠ å…¥ç´¢å¼•åº“</span>
          <span class="n">solrServer</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">doc</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="c1">// æäº¤</span>
        <span class="n">solrServer</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
  
        <span class="k">return</span> <span class="nc">BuyResult</span><span class="o">.</span><span class="na">ok</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="k">return</span> <span class="nc">BuyResult</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="s">" å¯¼å…¥ç´¢å¼•åº“å¤±è´¥"</span> <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>
:ET